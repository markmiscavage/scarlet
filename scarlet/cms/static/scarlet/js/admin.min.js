/**
 * @license RequireJS text 2.0.3 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/*! jQuery UI - v1.9.2 - 2012-11-26
* http://jqueryui.com
* Includes: jquery.ui.core.js, jquery.ui.widget.js, jquery.ui.mouse.js, jquery.ui.sortable.js
* Copyright (c) 2012 jQuery Foundation and other contributors Licensed MIT */

/*
Copyright 2012 Igor Vaynberg

Version: @@ver@@ Timestamp: @@timestamp@@

This software is licensed under the Apache License, Version 2.0 (the "Apache License") or the GNU
General Public License version 2 (the "GPL License"). You may choose either license to govern your
use of this software only upon the condition that you accept all of the terms of either the Apache
License or the GPL License.

You may obtain a copy of the Apache License and the GPL License at:

    http://www.apache.org/licenses/LICENSE-2.0
    http://www.gnu.org/licenses/gpl-2.0.html

Unless required by applicable law or agreed to in writing, software distributed under the
Apache License or the GPL Licesnse is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
CONDITIONS OF ANY KIND, either express or implied. See the Apache License and the GPL License for
the specific language governing permissions and limitations under the Apache License and the GPL License.
*/

/*!
 * pickadate.js v1.3 - 26 November, 2012
 * By Amsul (http://amsul.ca)
 * Hosted on https://github.com/amsul/pickadate.js
 * Licensed under MIT ("expat" flavour) license.
 */

/*
 wysihtml5 v0.4.0pre
 https://github.com/xing/wysihtml5

 Author: Christopher Blum (https://github.com/tiff)

 Copyright (C) 2012 XING AG
 Licensed under the MIT license (MIT)

 Rangy, a cross-browser JavaScript range and selection library
 http://code.google.com/p/rangy/

 Copyright 2011, Tim Down
 Licensed under the MIT license.
 Version: 1.2.2
 Build date: 13 November 2011
*/

define("rosy/utils/Utils",[],function(){function e(s){var o,u,a,f,l,c,h,p,d;typeof s!="object"&&!n(s)&&(s={}),p=t(arguments[1])?1:2,o=arguments[1]===!0;for(d=arguments.length;p<d;p++)if((u=arguments[p])!=null)for(a in u){f=s[a],l=u[a];if(s===l)continue;o&&l&&(i(l)||(c=r(l)))?(c?(c=!1,h=f&&r(f)?f:[]):h=f&&i(f)?f:{},s[a]=e(h,o,l)):l!==undefined&&(s[a]=l)}return s}function t(e){var t={"function":!0,object:!0,unknown:!0};return e?!!t[typeof e]:!1}function n(e){return typeof e=="function"}function i(e){var n=Object.prototype.hasOwnProperty;if(!e||!t(e)||e.nodeType||e===window)return!1;try{if(e.constructor&&!n.call(e,"constructor")&&!n.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(r){return!1}var i;for(i in e);return i===undefined||n.call(e,i)}var r=Array.isArray||function(e){return e&&e.toString?e.toString()=="[object Array]":!1};return{extend:e,isArray:r,isFunction:n,isObject:t,isPlainObject:i}}),define("rosy/polyfills/function-bind",[],function(){return Function.prototype.bind||(Function.prototype.bind=function(e){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r?this:e||window,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i}),Function.prototype.bind}),define("rosy/base/AbstractClass",["../utils/Utils","../polyfills/function-bind"],function(e){var t=function(e,t){return function(){var n,r=this.sup||null;return this.sup=t,n=e.apply(this,arguments),this.sup=r,n}},n=/xyz/.test(function(){var e;e=!0})?/\bthis\.sup\b/:/.*/;return function(){require.onResourceLoad=function(e,t,n){var r=e.require(t.id);r&&r._isRosyClass&&(r._moduleID=r.prototype._moduleID=t.id)};var r=function(){},i=function(){};return i.extend=function(s){function a(t){var n,r;this.vars&&typeof t=="object"&&(this.vars=e.extend({},this.vars,t));if(this.opts){this.opts=e.extend({},this.opts);if(this.opts.autoProxy===!0)for(r in this)typeof this[r]=="function"&&(this[r]=this[r].bind(this))}return n=this.__init||this.init||this.prototype.constructor,n.apply(this,arguments)}r.prototype=this.prototype;var o,u=e.extend(new r,s);for(o in s)o!=="static"&&typeof s[o]=="function"&&typeof this.prototype[o]=="function"&&n.test(s[o])?u[o]=t(s[o],this.prototype[o]):typeof s[o]=="object"&&(s[o]instanceof Array?u[o]=s[o].concat():s[o]!==null&&(o==="vars"||o==="opts"?u[o]=e.extend({},!0,this.prototype[o],s[o]):o==="static"?u[o]=e.extend({},this.prototype[o],s[o]):u[o]=e.extend({},s[o])));return u.extend=i.extend.bind(a),a.prototype=u,e.extend(a,this,u["static"]),a._isRosyClass=!0,a.prototype.constructor=a,typeof a.prototype.setup=="function"&&a.prototype.setup.call(a),a},i}()}),define("rosy/polyfills/array-indexof",[],function(){return Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){if(!this.length||!(this instanceof Array)||arguments.length<1)return-1;t=t||0;if(t>=this.length)return-1;while(t<this.length){if(this[t]===e)return t;t+=1}return-1}),Array.prototype.indexOf}),define("rosy/base/NotificationManager",["../utils/Utils","../polyfills/array-indexof"],function(e){function i(e){n.push(e),s(e)}function s(e){var t=e.name;if(r[t]){var n=r[t].slice(0),i=n.length;while(e.pointer<i){if(e.status!==1)return;n[e.pointer].apply(null,[].concat(e,e.args)),e.pointer++}n=null,e.status===1&&!e.callback&&e.cancel()}}var t=function(e,t,n){return this.name=e,this.args=t,this.data=t&&t.length===1?t[0]:null,this.callback=n,this};t.prototype.data={},t.prototype.name="",t.prototype.dispatcher=null,t.prototype.status=0,t.prototype.pointer=0,t.prototype.callback=null,t.prototype.hold=function(){this.status=2},t.prototype.release=function(){this.status=1,o.releaseNotification(this)},t.prototype.cancel=function(){this.data={},this.name="",this.status=0,this.pointer=0,this.dispatcher=null,this.callback=null,o.cancelNotification(this)},t.prototype.dispatch=function(e){this.status=1,this.pointer=0,this.dispatcher=e,o.publishNotification(this)},t.prototype.respond=function(){this.callback&&(this.callback.apply(this.dispatcher,arguments),this.cancel())};var n=[],r={},o={};return o.subscribe=function(e,t,n){n=isNaN(n)?-1:n,r[e]=r[e]||[],n<=-1||n>=r[e].length?r[e].push(t):r[e].splice(n,0,t)},o.unsubscribe=function(e,t){var n=r[e].indexOf(t);n>-1&&r[e].splice(n,1)},o.publish=function(){var n,r=Array.prototype.slice.call(arguments),s=r[0],o=r[r.length-1],u=r[r.length-2];u=e.isFunction(u)?u:null,r=r.slice(1,u?r.length-2:r.length-1),n=new t(s,r,u),n.status=1,n.pointer=0,n.dispatcher=o,i(n)},o.releaseNotification=function(e){e.status=1,n.indexOf(e)>-1&&s(e)},o.cancelNotification=function(e){n.splice(n.indexOf(e),1),e=null},o}),define("rosy/base/Class",["./AbstractClass","./NotificationManager","../polyfills/function-bind","../polyfills/array-indexof"],function(e,t){return e.extend({opts:{autoProxy:!0},init:function(){},subscribe:function(e,n,r){this._interestHandlers=this._interestHandlers||{},n&&!this._interestHandlers[e]&&(n=n,t.subscribe(e,n,r),this._interestHandlers[e]=n)},unsubscribe:function(e){if(!e)return this.unsubscribeAll();if(this._interestHandlers&&this._interestHandlers[e]){var n=this._interestHandlers[e];this._interestHandlers[e]=null,delete this._interestHandlers[e],t.unsubscribe(e,n)}},unsubscribeAll:function(){for(var e in this._interestHandlers)this._interestHandlers.hasOwnProperty(e)&&this.unsubscribe(e);this._interestHandlers=[]},publish:function(){var e=Array.prototype.slice.call(arguments);t.publish.apply(t,[].concat(e,this))},proxy:function(e){return e?e.bind(this):e},setTimeout:function(e,t){return window.setTimeout(this.proxy(e),t)},setInterval:function(e,t){return window.setInterval(this.proxy(e),t)},on:function(e,t){var n=this["on_"+e]=this["on_"+e]||[];return n.push(t),!0},off:function(e,t){var n=this["on_"+e],r;if(n){if(!t)return this["on_"+e]=[],!0;r=n.indexOf(t);while(r>-1)n.splice(r,1),r=n.indexOf(t);return!0}},trigger:function(){var e,t,n,r,i=Array.prototype.slice.call(arguments),s=i.splice(0,1)[0].split(":");while(s.length){t=s.join(":"),e=this["on_"+t];if(e&&e.length){i=[].concat(t,this,i||[]);for(n=0,r=e.length;n<r;n++)e[n].apply(null,i)}s.pop()}},destroy:function(){var e;for(e in this)e.indexOf("on_")>=0&&this.off(e.replace("on_"));this.unsubscribe()}})}),define("text",["module"],function(e){var t,n,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],i=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,s=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,o=typeof location!="undefined"&&location.href,u=o&&location.protocol&&location.protocol.replace(/\:/,""),a=o&&location.hostname,f=o&&(location.port||undefined),l=[],c=e.config&&e.config()||{};t={version:"2.0.3",strip:function(e){if(e){e=e.replace(i,"");var t=e.match(s);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:c.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=r[t];try{e=new ActiveXObject(n)}catch(i){}if(e){r=[n];break}}return e},parseName:function(e){var t=!1,n=e.indexOf("."),r=e.substring(0,n),i=e.substring(n+1,e.length);return n=i.indexOf("!"),n!==-1&&(t=i.substring(n+1,i.length),t=t==="strip",i=i.substring(0,n)),{moduleName:r,ext:i,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,c.isBuild&&(l[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}c.isBuild=i.isBuild;var s=t.parseName(e),l=s.moduleName+"."+s.ext,h=n.toUrl(l),p=c.useXhr||t.useXhr;!o||p(h,u,a,f)?t.get(h,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([l],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(l.hasOwnProperty(n)){var s=t.jsEscape(l[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.moduleName+"."+o.ext,a=r.toUrl(o.moduleName+"."+o.ext)+".js";t.load(u,r,function(n){var r=function(e){return i(a,e)};r.asModule=function(e,t){return i.asModule(e,a,t)},t.write(e,u,r,s)},s)}};if(c.env==="node"||!c.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node)n=require.nodeRequire("fs"),t.get=function(e,t){var r=n.readFileSync(e,"utf8");r.indexOf("ï»¿")===0&&(r=r.substring(1)),t(r)};else if(c.env==="xhr"||!c.env&&t.createXhr())t.get=function(e,n,r){var i=t.createXhr();i.open("GET",e,!0),c.onXhr&&c.onXhr(i,e),i.onreadystatechange=function(t){var s,o;i.readyState===4&&(s=i.status,s>399&&s<600?(o=new Error(e+" HTTP status: "+s),o.xhr=i,r(o)):n(i.responseText))},i.send(null)};else if(c.env==="rhino"||!c.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};return t}),define("$plugin",["module","text"],function(module,text){var prefix="libs/plugins/jquery/jquery.";return{load:function(name,req,load,config){req(["$"],function($){config.isBuild?load(""):req(["text!"+prefix+name+".js"],function(val){var contents="define('"+module.id+"!"+name+"', ['$'], function ($) {\nvar jQuery = $;\n"+val+";\nreturn $;\n});\n";eval(contents),req([module.id+"!"+name],function(e){load(e)})})})},loadFromFileSystem:function(e,t){var n=nodeRequire("fs"),r=require.toUrl(prefix+t)+".js",i=n.readFileSync(r).toString();return i="define('"+e+"!"+t+"', ['$'], function ($) {\nvar jQuery = $;\n"+i+";\nreturn $;\n});\n",i},write:function(e,t,n,r){n(this.loadFromFileSystem(e,t))}}}),define("$plugin!ui",["$"],function(e){var t=e;return function(e,t){function i(t,n){var r,i,o,u=t.nodeName.toLowerCase();return"area"===u?(r=t.parentNode,i=r.name,!t.href||!i||r.nodeName.toLowerCase()!=="map"?!1:(o=e("img[usemap=#"+i+"]")[0],!!o&&s(o))):(/input|select|textarea|button|object/.test(u)?!t.disabled:"a"===u?t.href||n:n)&&s(t)}function s(t){return e.expr.filters.visible(t)&&!e(t).parents().andSelf().filter(function(){return e.css(this,"visibility")==="hidden"}).length}var n=0,r=/^ui-id-\d+$/;e.ui=e.ui||{};if(e.ui.version)return;e.extend(e.ui,{version:"1.9.2",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({_focus:e.fn.focus,focus:function(t,n){return typeof t=="number"?this.each(function(){var r=this;setTimeout(function(){e(r).focus(),n&&n.call(r)},t)}):this._focus.apply(this,arguments)},scrollParent:function(){var t;return e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?t=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):t=this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length){var r=e(this[0]),i,s;while(r.length&&r[0]!==document){i=r.css("position");if(i==="absolute"||i==="relative"||i==="fixed"){s=parseInt(r.css("zIndex"),10);if(!isNaN(s)&&s!==0)return s}r=r.parent()}}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++n)})},removeUniqueId:function(){return this.each(function(){r.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,r){return!!e.data(t,r[3])},focusable:function(t){return i(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var n=e.attr(t,"tabindex"),r=isNaN(n);return(r||n>=0)&&i(t,!r)}}),e(function(){var t=document.body,n=t.appendChild(n=document.createElement("div"));n.offsetHeight,e.extend(n.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),e.support.minHeight=n.offsetHeight===100,e.support.selectstart="onselectstart"in n,t.removeChild(n).style.display="none"}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(n,r){function u(t,n,r,s){return e.each(i,function(){n-=parseFloat(e.css(t,"padding"+this))||0,r&&(n-=parseFloat(e.css(t,"border"+this+"Width"))||0),s&&(n-=parseFloat(e.css(t,"margin"+this))||0)}),n}var i=r==="Width"?["Left","Right"]:["Top","Bottom"],s=r.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+r]=function(n){return n===t?o["inner"+r].call(this):this.each(function(){e(this).css(s,u(this,n)+"px")})},e.fn["outer"+r]=function(t,n){return typeof t!="number"?o["outer"+r].call(this,t):this.each(function(){e(this).css(s,u(this,t,!0,n)+"px")})}}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(n){return arguments.length?t.call(this,e.camelCase(n)):t.call(this)}}(e.fn.removeData)),function(){var t=/msie ([\w.]+)/.exec(navigator.userAgent.toLowerCase())||[];e.ui.ie=t.length?!0:!1,e.ui.ie6=parseFloat(t[1],10)===6}(),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,n,r){var i,s=e.ui[t].prototype;for(i in r)s.plugins[i]=s.plugins[i]||[],s.plugins[i].push([n,r[i]])},call:function(e,t,n){var r,i=e.plugins[t];if(!i||!e.element[0].parentNode||e.element[0].parentNode.nodeType===11)return;for(r=0;r<i.length;r++)e.options[i[r][0]]&&i[r][1].apply(e.element,n)}},contains:e.contains,hasScroll:function(t,n){if(e(t).css("overflow")==="hidden")return!1;var r=n&&n==="left"?"scrollLeft":"scrollTop",i=!1;return t[r]>0?!0:(t[r]=1,i=t[r]>0,t[r]=0,i)},isOverAxis:function(e,t,n){return e>t&&e<t+n},isOver:function(t,n,r,i,s,o){return e.ui.isOverAxis(t,r,s)&&e.ui.isOverAxis(n,i,o)}})}(t),function(e,t){var n=0,r=Array.prototype.slice,i=e.cleanData;e.cleanData=function(t){for(var n=0,r;(r=t[n])!=null;n++)try{e(r).triggerHandler("remove")}catch(s){}i(t)},e.widget=function(t,n,r){var i,s,o,u,a=t.split(".")[0];t=t.split(".")[1],i=a+"-"+t,r||(r=n,n=e.Widget),e.expr[":"][i.toLowerCase()]=function(t){return!!e.data(t,i)},e[a]=e[a]||{},s=e[a][t],o=e[a][t]=function(e,t){if(!this._createWidget)return new o(e,t);arguments.length&&this._createWidget(e,t)},e.extend(o,s,{version:r.version,_proto:e.extend({},r),_childConstructors:[]}),u=new n,u.options=e.widget.extend({},u.options),e.each(r,function(t,i){e.isFunction(i)&&(r[t]=function(){var e=function(){return n.prototype[t].apply(this,arguments)},r=function(e){return n.prototype[t].apply(this,e)};return function(){var t=this._super,n=this._superApply,s;return this._super=e,this._superApply=r,s=i.apply(this,arguments),this._super=t,this._superApply=n,s}}())}),o.prototype=e.widget.extend(u,{widgetEventPrefix:s?u.widgetEventPrefix:t},r,{constructor:o,namespace:a,widgetName:t,widgetBaseClass:i,widgetFullName:i}),s?(e.each(s._childConstructors,function(t,n){var r=n.prototype;e.widget(r.namespace+"."+r.widgetName,o,n._proto)}),delete s._childConstructors):n._childConstructors.push(o),e.widget.bridge(t,o)},e.widget.extend=function(n){var i=r.call(arguments,1),s=0,o=i.length,u,a;for(;s<o;s++)for(u in i[s])a=i[s][u],i[s].hasOwnProperty(u)&&a!==t&&(e.isPlainObject(a)?n[u]=e.isPlainObject(n[u])?e.widget.extend({},n[u],a):e.widget.extend({},a):n[u]=a);return n},e.widget.bridge=function(n,i){var s=i.prototype.widgetFullName||n;e.fn[n]=function(o){var u=typeof o=="string",a=r.call(arguments,1),f=this;return o=!u&&a.length?e.widget.extend.apply(null,[o].concat(a)):o,u?this.each(function(){var r,i=e.data(this,s);if(!i)return e.error("cannot call methods on "+n+" prior to initialization; "+"attempted to call method '"+o+"'");if(!e.isFunction(i[o])||o.charAt(0)==="_")return e.error("no such method '"+o+"' for "+n+" widget instance");r=i[o].apply(i,a);if(r!==i&&r!==t)return f=r&&r.jquery?f.pushStack(r.get()):r,!1}):this.each(function(){var t=e.data(this,s);t?t.option(o||{})._init():e.data(this,s,new i(o,this))}),f}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,r){r=e(r||this.defaultElement||this)[0],this.element=e(r),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),r!==this&&(e.data(r,this.widgetName,this),e.data(r,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===r&&this.destroy()}}),this.document=e(r.style?r.ownerDocument:r.document||r),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(n,r){var i=n,s,o,u;if(arguments.length===0)return e.widget.extend({},this.options);if(typeof n=="string"){i={},s=n.split("."),n=s.shift();if(s.length){o=i[n]=e.widget.extend({},this.options[n]);for(u=0;u<s.length-1;u++)o[s[u]]=o[s[u]]||{},o=o[s[u]];n=s.pop();if(r===t)return o[n]===t?null:o[n];o[n]=r}else{if(r===t)return this.options[n]===t?null:this.options[n];i[n]=r}}return this._setOptions(i),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,e==="disabled"&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,n,r){var i,s=this;typeof t!="boolean"&&(r=n,n=t,t=!1),r?(n=i=e(n),this.bindings=this.bindings.add(n)):(r=n,n=this.element,i=this.widget()),e.each(r,function(r,o){function u(){if(!t&&(s.options.disabled===!0||e(this).hasClass("ui-state-disabled")))return;return(typeof o=="string"?s[o]:o).apply(s,arguments)}typeof o!="string"&&(u.guid=o.guid=o.guid||u.guid||e.guid++);var a=r.match(/^(\w+)\s*(.*)$/),f=a[1]+s.eventNamespace,l=a[2];l?i.delegate(l,f,u):n.bind(f,u)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return(typeof e=="string"?r[e]:e).apply(r,arguments)}var r=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,r){var i,s,o=this.options[t];r=r||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],s=n.originalEvent;if(s)for(i in s)i in n||(n[i]=s[i]);return this.element.trigger(n,r),!(e.isFunction(o)&&o.apply(this.element[0],[n].concat(r))===!1||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(r,i,s){typeof i=="string"&&(i={effect:i});var o,u=i?i===!0||typeof i=="number"?n:i.effect||n:t;i=i||{},typeof i=="number"&&(i={duration:i}),o=!e.isEmptyObject(i),i.complete=s,i.delay&&r.delay(i.delay),o&&e.effects&&(e.effects.effect[u]||e.uiBackCompat!==!1&&e.effects[u])?r[t](i):u!==t&&r[u]?r[u](i.duration,i.easing,s):r.queue(function(n){e(this)[t](),s&&s.call(r[0]),n()})}}),e.uiBackCompat!==!1&&(e.Widget.prototype._getCreateOptions=function(){return e.metadata&&e.metadata.get(this.element[0])[this.widgetName]})}(t),function(e,t){var n=!1;e(document).mouseup(function(e){n=!1}),e.widget("ui.mouse",{version:"1.9.2",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(n){if(!0===e.data(n.target,t.widgetName+".preventClickEvent"))return e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(n)return;this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var r=this,i=t.which===1,s=typeof this.options.cancel=="string"&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;if(!i||s||!this._mouseCapture(t))return!0;this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){r.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)){this._mouseStarted=this._mouseStart(t)!==!1;if(!this._mouseStarted)return t.preventDefault(),!0}return!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return r._mouseMove(e)},this._mouseUpDelegate=function(e){return r._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),n=!0,!0},_mouseMove:function(t){return!e.ui.ie||document.documentMode>=9||!!t.button?this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted):this._mouseUp(t)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(e){return this.mouseDelayMet},_mouseStart:function(e){},_mouseDrag:function(e){},_mouseStop:function(e){},_mouseCapture:function(e){return!0}})}(t),function(e,t){e.widget("ui.sortable",e.ui.mouse,{version:"1.9.2",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?e.axis==="x"||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_setOption:function(t,n){t==="disabled"?(this.options[t]=n,this.widget().toggleClass("ui-sortable-disabled",!!n)):e.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,n){var r=this;if(this.reverting)return!1;if(this.options.disabled||this.options.type=="static")return!1;this._refreshItems(t);var i=null,s=e(t.target).parents().each(function(){if(e.data(this,r.widgetName+"-item")==r)return i=e(this),!1});e.data(t.target,r.widgetName+"-item")==r&&(i=e(t.target));if(!i)return!1;if(this.options.handle&&!n){var o=!1;e(this.options.handle,i).find("*").andSelf().each(function(){this==t.target&&(o=!0)});if(!o)return!1}return this.currentItem=i,this._removeCurrentsFromItems(),!0},_mouseStart:function(t,n,r){var i=this.options;this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!=this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),i.containment&&this._setContainment(),i.cursor&&(e("body").css("cursor")&&(this._storedCursor=e("body").css("cursor")),e("body").css("cursor",i.cursor)),i.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",i.opacity)),i.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",i.zIndex)),this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions();if(!r)for(var s=this.containers.length-1;s>=0;s--)this.containers[s]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs);if(this.options.scroll){var n=this.options,r=!1;this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<n.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+n.scrollSpeed:t.pageY-this.overflowOffset.top<n.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-n.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<n.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+n.scrollSpeed:t.pageX-this.overflowOffset.left<n.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-n.scrollSpeed)):(t.pageY-e(document).scrollTop()<n.scrollSensitivity?r=e(document).scrollTop(e(document).scrollTop()-n.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<n.scrollSensitivity&&(r=e(document).scrollTop(e(document).scrollTop()+n.scrollSpeed)),t.pageX-e(document).scrollLeft()<n.scrollSensitivity?r=e(document).scrollLeft(e(document).scrollLeft()-n.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<n.scrollSensitivity&&(r=e(document).scrollLeft(e(document).scrollLeft()+n.scrollSpeed))),r!==!1&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)}this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";for(var i=this.items.length-1;i>=0;i--){var s=this.items[i],o=s.item[0],u=this._intersectsWithPointer(s);if(!u)continue;if(s.instance!==this.currentContainer)continue;if(o!=this.currentItem[0]&&this.placeholder[u==1?"next":"prev"]()[0]!=o&&!e.contains(this.placeholder[0],o)&&(this.options.type=="semi-dynamic"?!e.contains(this.element[0],o):!0)){this.direction=u==1?"down":"up";if(this.options.tolerance!="pointer"&&!this._intersectsWithSides(s))break;this._rearrange(t,s),this._trigger("change",t,this._uiHash());break}}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,n){if(!t)return;e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t);if(this.options.revert){var r=this,i=this.placeholder.offset();this.reverting=!0,e(this.helper).animate({left:i.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:i.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){r._clear(t)})}else this._clear(t,n);return!1},cancel:function(){if(this.dragging){this._mouseUp({target:null}),this.options.helper=="original"?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.options.helper!="original"&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},e(n).each(function(){var n=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[-=_](.+)/);n&&r.push((t.key||n[1]+"[]")+"="+(t.key&&t.expression?n[1]:n[2]))}),!r.length&&t.key&&r.push(t.key+"="),r.join("&")},toArray:function(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},n.each(function(){r.push(e(t.item||this).attr(t.attribute||"id")||"")}),r},_intersectsWith:function(e){var t=this.positionAbs.left,n=t+this.helperProportions.width,r=this.positionAbs.top,i=r+this.helperProportions.height,s=e.left,o=s+e.width,u=e.top,a=u+e.height,f=this.offset.click.top,l=this.offset.click.left,c=r+f>u&&r+f<a&&t+l>s&&t+l<o;return this.options.tolerance=="pointer"||this.options.forcePointerForContainers||this.options.tolerance!="pointer"&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?c:s<t+this.helperProportions.width/2&&n-this.helperProportions.width/2<o&&u<r+this.helperProportions.height/2&&i-this.helperProportions.height/2<a},_intersectsWithPointer:function(t){var n=this.options.axis==="x"||e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),r=this.options.axis==="y"||e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),i=n&&r,s=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return i?this.floating?o&&o=="right"||s=="down"?2:1:s&&(s=="down"?2:1):!1},_intersectsWithSides:function(t){var n=e.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),r=e.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),i=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();return this.floating&&s?s=="right"&&r||s=="left"&&!r:i&&(i=="down"&&n||i=="up"&&!n)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return e!=0&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return e!=0&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor==String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){var n=[],r=[],i=this._connectWith();if(i&&t)for(var s=i.length-1;s>=0;s--){var o=e(i[s]);for(var u=o.length-1;u>=0;u--){var a=e.data(o[u],this.widgetName);a&&a!=this&&!a.options.disabled&&r.push([e.isFunction(a.options.items)?a.options.items.call(a.element):e(a.options.items,a.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),a])}}r.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(var s=r.length-1;s>=0;s--)r[s][0].each(function(){n.push(this)});return e(n)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var n=0;n<t.length;n++)if(t[n]==e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var n=this.items,r=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],i=this._connectWith();if(i&&this.ready)for(var s=i.length-1;s>=0;s--){var o=e(i[s]);for(var u=o.length-1;u>=0;u--){var a=e.data(o[u],this.widgetName);a&&a!=this&&!a.options.disabled&&(r.push([e.isFunction(a.options.items)?a.options.items.call(a.element[0],t,{item:this.currentItem}):e(a.options.items,a.element),a]),this.containers.push(a))}}for(var s=r.length-1;s>=0;s--){var f=r[s][1],l=r[s][0];for(var u=0,c=l.length;u<c;u++){var h=e(l[u]);h.data(this.widgetName+"-item",f),n.push({item:h,instance:f,width:0,height:0,left:0,top:0})}}},refreshPositions:function(t){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());for(var n=this.items.length-1;n>=0;n--){var r=this.items[n];if(r.instance!=this.currentContainer&&this.currentContainer&&r.item[0]!=this.currentItem[0])continue;var i=this.options.toleranceElement?e(this.options.toleranceElement,r.item):r.item;t||(r.width=i.outerWidth(),r.height=i.outerHeight());var s=i.offset();r.left=s.left,r.top=s.top}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(var n=this.containers.length-1;n>=0;n--){var s=this.containers[n].element.offset();this.containers[n].containerCache.left=s.left,this.containers[n].containerCache.top=s.top,this.containers[n].containerCache.width=this.containers[n].element.outerWidth(),this.containers[n].containerCache.height=this.containers[n].element.outerHeight()}return this},_createPlaceholder:function(t){t=t||this;var n=t.options;if(!n.placeholder||n.placeholder.constructor==String){var r=n.placeholder;n.placeholder={element:function(){var n=e(document.createElement(t.currentItem[0].nodeName)).addClass(r||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];return r||(n.style.visibility="hidden"),n},update:function(e,i){if(r&&!n.forcePlaceholderSize)return;i.height()||i.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),i.width()||i.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10))}}}t.placeholder=e(n.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),n.placeholder.update(t,t.placeholder)},_contactContainers:function(t){var n=null,r=null;for(var i=this.containers.length-1;i>=0;i--){if(e.contains(this.currentItem[0],this.containers[i].element[0]))continue;if(this._intersectsWith(this.containers[i].containerCache)){if(n&&e.contains(this.containers[i].element[0],n.element[0]))continue;n=this.containers[i],r=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",t,this._uiHash(this)),this.containers[i].containerCache.over=0)}if(!n)return;if(this.containers.length===1)this.containers[r]._trigger("over",t,this._uiHash(this)),this.containers[r].containerCache.over=1;else{var s=1e4,o=null,u=this.containers[r].floating?"left":"top",a=this.containers[r].floating?"width":"height",f=this.positionAbs[u]+this.offset.click[u];for(var l=this.items.length-1;l>=0;l--){if(!e.contains(this.containers[r].element[0],this.items[l].item[0]))continue;if(this.items[l].item[0]==this.currentItem[0])continue;var c=this.items[l].item.offset()[u],h=!1;Math.abs(c-f)>Math.abs(c+this.items[l][a]-f)&&(h=!0,c+=this.items[l][a]),Math.abs(c-f)<s&&(s=Math.abs(c-f),o=this.items[l],this.direction=h?"up":"down")}if(!o&&!this.options.dropOnEmpty)return;this.currentContainer=this.containers[r],o?this._rearrange(t,o,null,!0):this._rearrange(t,null,this.containers[r].element,!0),this._trigger("change",t,this._uiHash()),this.containers[r]._trigger("change",t,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[r]._trigger("over",t,this._uiHash(this)),this.containers[r].containerCache.over=1}},_createHelper:function(t){var n=this.options,r=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t,this.currentItem])):n.helper=="clone"?this.currentItem.clone():this.currentItem;return r.parents("body").length||e(n.appendTo!="parent"?n.appendTo:this.currentItem[0].parentNode)[0].appendChild(r[0]),r[0]==this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(r[0].style.width==""||n.forceHelperSize)&&r.width(this.currentItem.width()),(r[0].style.height==""||n.forceHelperSize)&&r.height(this.currentItem.height()),r},_adjustOffsetFromHelper:function(t){typeof t=="string"&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&e.ui.ie)t={top:0,left:0};return{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;t.containment=="parent"&&(t.containment=this.helper[0].parentNode);if(t.containment=="document"||t.containment=="window")this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e(t.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(e(t.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(t.containment)){var n=e(t.containment)[0],r=e(t.containment).offset(),i=e(n).css("overflow")!="hidden";this.containment=[r.left+(parseInt(e(n).css("borderLeftWidth"),10)||0)+(parseInt(e(n).css("paddingLeft"),10)||0)-this.margins.left,r.top+(parseInt(e(n).css("borderTopWidth"),10)||0)+(parseInt(e(n).css("paddingTop"),10)||0)-this.margins.top,r.left+(i?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(e(n).css("borderLeftWidth"),10)||0)-(parseInt(e(n).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,r.top+(i?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(e(n).css("borderTopWidth"),10)||0)-(parseInt(e(n).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(t,n){n||(n=this.position);var r=t=="absolute"?1:-1,i=this.options,s=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(s[0].tagName);return{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():o?0:s.scrollTop())*r,left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():o?0:s.scrollLeft())*r}},_generatePosition:function(t){var n=this.options,r=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(r[0].tagName);this.cssPosition=="relative"&&(this.scrollParent[0]==document||this.scrollParent[0]==this.offsetParent[0])&&(this.offset.relative=this._getRelativeOffset());var s=t.pageX,o=t.pageY;if(this.originalPosition){this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(s=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(s=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top));if(n.grid){var u=this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1];o=this.containment?u-this.offset.click.top<this.containment[1]||u-this.offset.click.top>this.containment[3]?u-this.offset.click.top<this.containment[1]?u+n.grid[1]:u-n.grid[1]:u:u;var a=this.originalPageX+Math.round((s-this.originalPageX)/n.grid[0])*n.grid[0];s=this.containment?a-this.offset.click.left<this.containment[0]||a-this.offset.click.left>this.containment[2]?a-this.offset.click.left<this.containment[0]?a+n.grid[0]:a-n.grid[0]:a:a}}return{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():i?0:r.scrollTop()),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():i?0:r.scrollLeft())}},_rearrange:function(e,t,n,r){n?n[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],this.direction=="down"?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var i=this.counter;this._delay(function(){i==this.counter&&this.refreshPositions(!r)})},_clear:function(t,n){this.reverting=!1;var r=[];!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null;if(this.helper[0]==this.currentItem[0]){for(var i in this._storedCSS)if(this._storedCSS[i]=="auto"||this._storedCSS[i]=="static")this._storedCSS[i]="";this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!n&&r.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),(this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!n&&r.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(n||(r.push(function(e){this._trigger("remove",e,this._uiHash())}),r.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),r.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer))));for(var i=this.containers.length-1;i>=0;i--)n||r.push(function(e){return function(t){e._trigger("deactivate",t,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over&&(r.push(function(e){return function(t){e._trigger("out",t,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over=0);this._storedCursor&&e("body").css("cursor",this._storedCursor),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex",this._storedZIndex=="auto"?"":this._storedZIndex),this.dragging=!1;if(this.cancelHelperRemoval){if(!n){this._trigger("beforeStop",t,this._uiHash());for(var i=0;i<r.length;i++)r[i].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!1}n||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!=this.currentItem[0]&&this.helper.remove(),this.helper=null;if(!n){for(var i=0;i<r.length;i++)r[i].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var n=t||this;return{helper:n.helper,placeholder:n.placeholder||e([]),position:n.position,originalPosition:n.originalPosition,offset:n.positionAbs,item:n.currentItem,sender:t?t.element:null}}})}(t),e}),define("rosy/base/DOMClass",["../base/Class","$"],function(e,t){function n(e,t,n){var r,i,s,o,u,a;for(r in n)for(i=0,s=n[r].length;i<s;i++){if(!n[r])break;o=n[r][i];if(!o)break;for(u in e)a=e[u],a&&a.guid&&typeof a=="function"&&a.guid===o.handler.guid&&t.off(r,a)}}function r(e,i){if(!i)return;var s,o,u;for(s in i){o=i[s];if(o instanceof t){var a,f,l;for(a=0,f=o.length;a<f;a++)l=o[a],u=t._data(l,"events"),u&&n(e,o.eq(a),u)}else t.isPlainObject(o)&&r(e,o)}}return e.extend({preventDefault:function(e){e.preventDefault()},proxy:function(e){return t.proxy(e,this)},destroy:function(){this.unbindEvents(),this.sup()},unbindEvents:function(){for(var e in this)t.isPlainObject(this[e])&&r(this,this[e])}})}),define("admin/views/Page",["rosy/base/DOMClass","$"],function(e,t){var n=t("body");return e.extend({$content:"",init:function(){this.sup(),this.$content=t("#main")},transitionIn:function(){this.$content.animate({opacity:1},500,this.transitionInComplete)},transitionOut:function(){this.$content.animate({opacity:0},500,this.transitionOutComplete)},destroy:function(){this.$content=null}})}),define("$plugin!select2",["$"],function(e){var t=e;return function(e){typeof e.fn.each2=="undefined"&&e.fn.extend({each2:function(t){var n=e([0]),r=-1,i=this.length;while(++r<i&&(n.context=n[0]=this[r])&&t.call(n[0],r,n)!==!1);return this}})}(t),function(e,t){function l(e,t){var n=0,r=t.length,i;if(typeof e=="undefined")return-1;if(e.constructor===String){for(;n<r;n+=1)if(e.localeCompare(t[n])===0)return n}else for(;n<r;n+=1){i=t[n];if(i.constructor===String){if(i.localeCompare(e)===0)return n}else if(i===e)return n}return-1}function c(e,n){return e===n?!0:e===t||n===t?!1:e===null||n===null?!1:e.constructor===String?e.localeCompare(n)===0:n.constructor===String?n.localeCompare(e)===0:!1}function h(t,n){var r,i,s;if(t===null||t.length<1)return[];r=t.split(n);for(i=0,s=r.length;i<s;i+=1)r[i]=e.trim(r[i]);return r}function p(e){return e.outerWidth(!1)-e.width()}function d(n){var r="keyup-change-value";n.bind("keydown",function(){e.data(n,r)===t&&e.data(n,r,n.val())}),n.bind("keyup",function(){var i=e.data(n,r);i!==t&&n.val()!==i&&(e.removeData(n,r),n.trigger("keyup-change"))})}function v(n){n.bind("mousemove",function(n){var r=a;(r===t||r.x!==n.pageX||r.y!==n.pageY)&&e(n.target).trigger("mousemove-filtered",n)})}function m(e,n,r){r=r||t;var i;return function(){var t=arguments;window.clearTimeout(i),i=window.setTimeout(function(){n.apply(r,t)},e)}}function g(e){var t=!1,n;return function(){return t===!1&&(n=e(),t=!0),n}}function y(e,t){var n=m(e,function(e){t.trigger("scroll-debounced",e)});t.bind("scroll",function(e){l(e.target,t.get())>=0&&n(e)})}function b(e){e.preventDefault(),e.stopPropagation()}function w(e){e.preventDefault(),e.stopImmediatePropagation()}function E(t){if(!u){var n=t[0].currentStyle||window.getComputedStyle(t[0],null);u=e("<div></div>").css({position:"absolute",left:"-10000px",top:"-10000px",display:"none",fontSize:n.fontSize,fontFamily:n.fontFamily,fontStyle:n.fontStyle,fontWeight:n.fontWeight,letterSpacing:n.letterSpacing,textTransform:n.textTransform,whiteSpace:"nowrap"}),e("body").append(u)}return u.text(t.val()),u.width()}function S(e,t,n){var r=e.toUpperCase().indexOf(t.toUpperCase()),i=t.length;if(r<0){n.push(e);return}n.push(e.substring(0,r)),n.push("<span class='select2-match'>"),n.push(e.substring(r,r+i)),n.push("</span>"),n.push(e.substring(r+i,e.length))}function x(t){var n,r=0,i=null,s=t.quietMillis||100;return function(o){window.clearTimeout(n),n=window.setTimeout(function(){r+=1;var n=r,s=t.data,u=t.transport||e.ajax,a=t.traditional||!1,f=t.type||"GET";s=s.call(this,o.term,o.page,o.context),null!==i&&i.abort(),i=u.call(null,{url:t.url,dataType:t.dataType,data:s,type:f,traditional:a,success:function(e){if(n<r)return;var i=t.results(e,o.page);o.callback(i)}})},s)}}function T(t){var n=t,r,i=function(e){return""+e.text};return e.isArray(n)||(i=n.text,e.isFunction(i)||(r=n.text,i=function(e){return e[r]}),n=n.results),function(t){var r=t.term,s={results:[]},o;if(r===""){t.callback({results:n});return}o=function(n,s){var u,a;n=n[0];if(n.children){u={};for(a in n)n.hasOwnProperty(a)&&(u[a]=n[a]);u.children=[],e(n.children).each2(function(e,t){o(t,u.children)}),(u.children.length||t.matcher(r,i(u)))&&s.push(u)}else t.matcher(r,i(n))&&s.push(n)},e(n).each2(function(e,t){o(t,s.results)}),t.callback(s)}}function N(n){return e.isFunction(n)?n:function(r){var i=r.term,s={results:[]};e(n).each(function(){var e=this.text!==t,n=e?this.text:this;(i===""||r.matcher(i,n))&&s.results.push(e?this:{id:this,text:this})}),r.callback(s)}}function C(t,n){if(e.isFunction(t))return!0;if(!t)return!1;throw new Error("formatterName must be a function or a falsy value")}function k(t){return e.isFunction(t)?t():t}function L(t){var n=0;return e.each(t,function(e,t){t.children?n+=L(t.children):n++}),n}function A(e,n,r,i){var s=e,o=!1,u,a,f,l,h;if(!i.createSearchChoice||!i.tokenSeparators||i.tokenSeparators.length<1)return t;for(;;){a=-1;for(f=0,l=i.tokenSeparators.length;f<l;f++){h=i.tokenSeparators[f],a=e.indexOf(h);if(a>=0)break}if(a<0)break;u=e.substring(0,a),e=e.substring(a+h.length);if(u.length>0){u=i.createSearchChoice(u,n);if(u!==t&&u!==null&&i.id(u)!==t&&i.id(u)!==null){o=!1;for(f=0,l=n.length;f<l;f++)if(c(i.id(u),i.id(n[f]))){o=!0;break}o||r(u)}}}if(s.localeCompare(e)!=0)return e}function O(t,n){var r=function(){};return r.prototype=new t,r.prototype.constructor=r,r.prototype.parent=t.prototype,r.prototype=e.extend(r.prototype,n),r}if(window.Select2!==t)return;var n,r,i,s,o,u,a,f;n={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(e){e=e.which?e.which:e;switch(e){case n.LEFT:case n.RIGHT:case n.UP:case n.DOWN:return!0}return!1},isControl:function(e){var t=e.which;switch(t){case n.SHIFT:case n.CTRL:case n.ALT:return!0}return e.metaKey?!0:!1},isFunctionKey:function(e){return e=e.which?e.which:e,e>=112&&e<=123}},f=e(document),o=function(){var e=1;return function(){return e++}}(),f.bind("mousemove",function(e){a={x:e.pageX,y:e.pageY}}),f.ready(function(){f.bind("mousedown touchend",function(n){var r=e(n.target).closest("div.select2-container").get(0),i;r?f.find("div.select2-container-active").each(function(){this!==r&&e(this).data("select2").blur()}):(r=e(n.target).closest("div.select2-drop").get(0),f.find("div.select2-drop-active").each(function(){this!==r&&e(this).data("select2").blur()})),r=e(n.target),i=r.attr("for"),"LABEL"===n.target.tagName&&i&&i.length>0&&(i=i.replace(/([\[\].])/g,"\\$1"),r=e("#"+i),r=r.data("select2"),r!==t&&(r.focus(),n.preventDefault()))})}),r=O(Object,{bind:function(e){var t=this;return function(){e.apply(t,arguments)}},init:function(n){var r,i,s=".select2-results";this.opts=n=this.prepareOpts(n),this.id=n.id,n.element.data("select2")!==t&&n.element.data("select2")!==null&&this.destroy(),this.enabled=!0,this.container=this.createContainer(),this.containerId="s2id_"+(n.element.attr("id")||"autogen"+o()),this.containerSelector="#"+this.containerId.replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1"),this.container.attr("id",this.containerId),this.body=g(function(){return n.element.closest("body")}),n.element.attr("class")!==t&&this.container.addClass(n.element.attr("class").replace(/validate\[[\S ]+] ?/,"")),this.container.css(k(n.containerCss)),this.container.addClass(k(n.containerCssClass)),this.opts.element.data("select2",this).hide().before(this.container),this.container.data("select2",this),this.dropdown=this.container.find(".select2-drop"),this.dropdown.addClass(k(n.dropdownCssClass)),this.dropdown.data("select2",this),this.results=r=this.container.find(s),this.search=i=this.container.find("input.select2-input"),i.attr("tabIndex",this.opts.element.attr("tabIndex")),this.resultsPage=0,this.context=null,this.initContainer(),this.initContainerWidth(),v(this.results),this.dropdown.delegate(s,"mousemove-filtered",this.bind(this.highlightUnderEvent)),y(80,this.results),this.dropdown.delegate(s,"scroll-debounced",this.bind(this.loadMoreIfNeeded)),e.fn.mousewheel&&r.mousewheel(function(e,t,n,i){var s=r.scrollTop(),o;i>0&&s-i<=0?(r.scrollTop(0),b(e)):i<0&&r.get(0).scrollHeight-r.scrollTop()+i<=r.height()&&(r.scrollTop(r.get(0).scrollHeight-r.height()),b(e))}),d(i),i.bind("keyup-change",this.bind(this.updateResults)),i.bind("focus",function(){i.addClass("select2-focused"),i.val()===" "&&i.val("")}),i.bind("blur",function(){i.removeClass("select2-focused")}),this.dropdown.delegate(s,"mouseup",this.bind(function(t){e(t.target).closest(".select2-result-selectable:not(.select2-disabled)").length>0?(this.highlightUnderEvent(t),this.selectHighlighted(t)):this.focusSearch(),b(t)})),this.dropdown.bind("click mouseup mousedown",function(e){e.stopPropagation()}),e.isFunction(this.opts.initSelection)&&(this.initSelection(),this.monitorSource()),(n.element.is(":disabled")||n.element.is("[readonly='readonly']"))&&this.disable()},destroy:function(){var e=this.opts.element.data("select2");e!==t&&(e.container.remove(),e.dropdown.remove(),e.opts.element.removeData("select2").unbind(".select2").show())},prepareOpts:function(n){var r,i,s,o;r=n.element,r.get(0).tagName.toLowerCase()==="select"&&(this.select=i=n.element),i&&e.each(["id","multiple","ajax","query","createSearchChoice","initSelection","data","tags"],function(){if(this in n)throw new Error("Option '"+this+"' is not allowed for Select2 when attached to a <select> element.")}),n=e.extend({},{populateResults:function(r,i,s){var o,u,a,f,l=this.opts.id,c=this;o=function(r,i,u){var a,f,h,p,d,v,m,g,y;for(a=0,f=r.length;a<f;a+=1)h=r[a],p=l(h)!==t,d=h.children&&h.children.length>0,v=e("<li></li>"),v.addClass("select2-results-dept-"+u),v.addClass("select2-result"),v.addClass(p?"select2-result-selectable":"select2-result-unselectable"),d&&v.addClass("select2-result-with-children"),v.addClass(c.opts.formatResultCssClass(h)),m=e("<div></div>"),m.addClass("select2-result-label"),y=n.formatResult(h,m,s),y!==t&&m.html(c.opts.escapeMarkup(y)),v.append(m),d&&(g=e("<ul></ul>"),g.addClass("select2-result-sub"),o(h.children,g,u+1),v.append(g)),v.data("select2-data",h),i.append(v)},o(i,r,0)}},e.fn.select2.defaults,n),typeof n.id!="function"&&(s=n.id,n.id=function(e){return e[s]}),i?(n.query=this.bind(function(n){var i={results:[],more:!1},s=n.term,o,u,a;a=function(e,t){var r;e.is("option")?n.matcher(s,e.text(),e)&&t.push({id:e.attr("value"),text:e.text(),element:e.get(),css:e.attr("class")}):e.is("optgroup")&&(r={text:e.attr("label"),children:[],element:e.get(),css:e.attr("class")},e.children().each2(function(e,t){a(t,r.children)}),r.children.length>0&&t.push(r))},o=r.children(),this.getPlaceholder()!==t&&o.length>0&&(u=o[0],e(u).text()===""&&(o=o.not(u))),o.each2(function(e,t){a(t,i.results)}),n.callback(i)}),n.id=function(e){return e.id},n.formatResultCssClass=function(e){return e.css}):"query"in n||("ajax"in n?(o=n.element.data("ajax-url"),o&&o.length>0&&(n.ajax.url=o),n.query=x(n.ajax)):"data"in n?n.query=T(n.data):"tags"in n&&(n.query=N(n.tags),n.createSearchChoice=function(e){return{id:e,text:e}},n.initSelection=function(t,r){var i=[];e(h(t.val(),n.separator)).each(function(){var t=this,r=this,s=n.tags;e.isFunction(s)&&(s=s()),e(s).each(function(){if(c(this.id,t))return r=this.text,!1}),i.push({id:t,text:r})}),r(i)}));if(typeof n.query!="function")throw"query function not defined for Select2 "+n.element.attr("id");return n},monitorSource:function(){this.opts.element.bind("change.select2",this.bind(function(e){this.opts.element.data("select2-change-triggered")!==!0&&this.initSelection()}))},triggerChange:function(t){t=t||{},t=e.extend({},t,{type:"change",val:this.val()}),this.opts.element.data("select2-change-triggered",!0),this.opts.element.trigger(t),this.opts.element.data("select2-change-triggered",!1),this.opts.element.click(),this.opts.blurOnChange&&this.opts.element.blur()},enable:function(){if(this.enabled)return;this.enabled=!0,this.container.removeClass("select2-container-disabled"),this.opts.element.removeAttr("disabled")},disable:function(){if(!this.enabled)return;this.close(),this.enabled=!1,this.container.addClass("select2-container-disabled"),this.opts.element.attr("disabled","disabled")},opened:function(){return this.container.hasClass("select2-dropdown-open")},positionDropdown:function(){var t=this.container.offset(),n=this.container.outerHeight(!1),r=this.container.outerWidth(!1),i=this.dropdown.outerHeight(!1),s=e(window).scrollTop()+document.documentElement.clientHeight,o=t.top+n,u=t.left,a=o+i<=s,f=t.top-i>=this.body().scrollTop(),l=this.dropdown.hasClass("select2-drop-above"),c,h,p;this.body().css("position")!=="static"&&(c=this.body().offset(),o-=c.top,u-=c.left),l?(h=!0,!f&&a&&(h=!1)):(h=!1,!a&&f&&(h=!0)),h?(o=t.top-i,this.container.addClass("select2-drop-above"),this.dropdown.addClass("select2-drop-above")):(this.container.removeClass("select2-drop-above"),this.dropdown.removeClass("select2-drop-above")),p=e.extend({top:o,left:u,width:r},k(this.opts.dropdownCss)),this.dropdown.css(p)},shouldOpen:function(){var t;return this.opened()?!1:(t=e.Event("open"),this.opts.element.trigger(t),!t.isDefaultPrevented())},clearDropdownAlignmentPreference:function(){this.container.removeClass("select2-drop-above"),this.dropdown.removeClass("select2-drop-above")},open:function(){return this.shouldOpen()?(window.setTimeout(this.bind(this.opening),1),!0):!1},opening:function(){var t=this.containerId,n=this.containerSelector,r="scroll."+t,i="resize."+t;this.container.parents().each(function(){e(this).bind(r,function(){var t=e(n);t.length==0&&e(this).unbind(r),t.select2("close")})}),window.setTimeout(function(){e(window).bind(i,function(){var t=e(n);t.length==0&&e(window).unbind(i),t.select2("close")})},10),this.clearDropdownAlignmentPreference(),this.search.val()===" "&&this.search.val(""),this.container.addClass("select2-dropdown-open").addClass("select2-container-active"),this.updateResults(!0),this.dropdown[0]!==this.body().children().last()[0]&&this.dropdown.detach().appendTo(this.body()),this.dropdown.show(),this.positionDropdown(),this.dropdown.addClass("select2-drop-active"),this.ensureHighlightVisible(),this.focusSearch()},close:function(){if(!this.opened())return;var t=this;this.container.parents().each(function(){e(this).unbind("scroll."+t.containerId)}),e(window).unbind("resize."+this.containerId),this.clearDropdownAlignmentPreference(),this.dropdown.hide(),this.container.removeClass("select2-dropdown-open").removeClass("select2-container-active"),this.results.empty(),this.clearSearch(),this.opts.element.trigger(e.Event("close"))},clearSearch:function(){},ensureHighlightVisible:function(){var t=this.results,n,r,i,s,o,u,a;r=this.highlight();if(r<0)return;if(r==0){t.scrollTop(0);return}n=t.find(".select2-result-selectable"),i=e(n[r]),s=i.offset().top+i.outerHeight(!0),r===n.length-1&&(a=t.find("li.select2-more-results"),a.length>0&&(s=a.offset().top+a.outerHeight(!0))),o=t.offset().top+t.outerHeight(!0),s>o&&t.scrollTop(t.scrollTop()+(s-o)),u=i.offset().top-t.offset().top,u<0&&i.css("display")!="none"&&t.scrollTop(t.scrollTop()+u)},moveHighlight:function(t){var n=this.results.find(".select2-result-selectable"),r=this.highlight();while(r>-1&&r<n.length){r+=t;var i=e(n[r]);if(i.hasClass("select2-result-selectable")&&!i.hasClass("select2-disabled")){this.highlight(r);break}}},highlight:function(t){var n=this.results.find(".select2-result-selectable").not(".select2-disabled");if(arguments.length===0)return l(n.filter(".select2-highlighted")[0],n.get());t>=n.length&&(t=n.length-1),t<0&&(t=0),n.removeClass("select2-highlighted"),e(n[t]).addClass("select2-highlighted"),this.ensureHighlightVisible()},countSelectableResults:function(){return this.results.find(".select2-result-selectable").not(".select2-disabled").length},highlightUnderEvent:function(t){var n=e(t.target).closest(".select2-result-selectable");if(n.length>0&&!n.is(".select2-highlighted")){var r=this.results.find(".select2-result-selectable");this.highlight(r.index(n))}else n.length==0&&this.results.find(".select2-highlighted").removeClass("select2-highlighted")},loadMoreIfNeeded:function(){var e=this.results,t=e.find("li.select2-more-results"),n,r=-1,i=this.resultsPage+1,s=this,o=this.search.val(),u=this.context;if(t.length===0)return;n=t.offset().top-e.offset().top-e.height(),n<=0&&(t.addClass("select2-active"),this.opts.query({term:o,page:i,context:u,matcher:this.opts.matcher,callback:this.bind(function(n){if(!s.opened())return;s.opts.populateResults.call(this,e,n.results,{term:o,page:i,context:u}),n.more===!0?(t.detach().appendTo(e).text(s.opts.formatLoadMore(i+1)),window.setTimeout(function(){s.loadMoreIfNeeded()},10)):t.remove(),s.positionDropdown(),s.resultsPage=i})}))},tokenize:function(){},updateResults:function(n){function f(){i.scrollTop(0),r.removeClass("select2-active"),u.positionDropdown()}function l(e){i.html(u.opts.escapeMarkup(e)),f()}var r=this.search,i=this.results,s=this.opts,o,u=this,a;if(n!==!0&&(this.showSearchInput===!1||!this.opened()))return;r.addClass("select2-active");if(s.maximumSelectionSize>=1){o=this.data();if(e.isArray(o)&&o.length>=s.maximumSelectionSize&&C(s.formatSelectionTooBig,"formatSelectionTooBig")){l("<li class='select2-selection-limit'>"+s.formatSelectionTooBig(s.maximumSelectionSize)+"</li>");return}}if(r.val().length<s.minimumInputLength){C(s.formatInputTooShort,"formatInputTooShort")?l("<li class='select2-no-results'>"+s.formatInputTooShort(r.val(),s.minimumInputLength)+"</li>"):l("");return}s.formatSearching()&&l("<li class='select2-searching'>"+s.formatSearching()+"</li>"),a=this.tokenize(),a!=t&&a!=null&&r.val(a),this.resultsPage=1,s.query({term:r.val(),page:this.resultsPage,context:null,matcher:s.matcher,callback:this.bind(function(o){var a;if(!this.opened())return;this.context=o.context===t?null:o.context,this.opts.createSearchChoice&&r.val()!==""&&(a=this.opts.createSearchChoice.call(null,r.val(),o.results),a!==t&&a!==null&&u.id(a)!==t&&u.id(a)!==null&&e(o.results).filter(function(){return c(u.id(this),u.id(a))}).length===0&&o.results.unshift(a));if(o.results.length===0&&C(s.formatNoMatches,"formatNoMatches")){l("<li class='select2-no-results'>"+s.formatNoMatches(r.val())+"</li>");return}i.empty(),u.opts.populateResults.call(this,i,o.results,{term:r.val(),page:this.resultsPage,context:null}),o.more===!0&&C(s.formatLoadMore,"formatLoadMore")&&(i.append("<li class='select2-more-results'>"+u.opts.escapeMarkup(s.formatLoadMore(this.resultsPage))+"</li>"),window.setTimeout(function(){u.loadMoreIfNeeded()},10)),this.postprocessResults(o,n),f()})})},cancel:function(){this.close()},blur:function(){this.close(),this.container.removeClass("select2-container-active"),this.dropdown.removeClass("select2-drop-active"),this.search[0]===document.activeElement&&this.search.blur(),this.clearSearch(),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus"),this.opts.element.triggerHandler("blur")},focusSearch:function(){this.search.show(),this.search.focus(),window.setTimeout(this.bind(function(){this.search.show(),this.search.focus(),this.search.val(this.search.val())}),10)},selectHighlighted:function(){var e=this.highlight(),t=this.results.find(".select2-highlighted").not(".select2-disabled"),n=t.closest(".select2-result-selectable").data("select2-data");n&&(t.addClass("select2-disabled"),this.highlight(e),this.onSelect(n))},getPlaceholder:function(){return this.opts.element.attr("placeholder")||this.opts.element.attr("data-placeholder")||this.opts.element.data("placeholder")||this.opts.placeholder},initContainerWidth:function(){function n(){var n,r,i,s,o;if(this.opts.width==="off")return null;if(this.opts.width==="element")return this.opts.element.outerWidth(!1)===0?"auto":this.opts.element.outerWidth(!1)+"px";if(this.opts.width==="copy"||this.opts.width==="resolve"){n=this.opts.element.attr("style");if(n!==t){r=n.split(";");for(s=0,o=r.length;s<o;s+=1){i=r[s].replace(/\s/g,"").match(/width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/);if(i!==null&&i.length>=1)return i[1]}}return this.opts.width==="resolve"?(n=this.opts.element.css("width"),n.indexOf("%")>0?n:this.opts.element.outerWidth(!1)===0?"auto":this.opts.element.outerWidth(!1)+"px"):null}return e.isFunction(this.opts.width)?this.opts.width():this.opts.width}var r=n.call(this);r!==null&&this.container.attr("style","width: "+r)}}),i=O(r,{createContainer:function(){var t=e("<div></div>",{"class":"select2-container"}).html(["    <a href='javascript:void(0)' onclick='return false;' class='select2-choice'>","   <span></span><abbr class='select2-search-choice-close' style='display:none;'></abbr>","   <div><b></b></div>","</a>","    <div class='select2-drop select2-offscreen'>","   <div class='select2-search'>","       <input type='text' autocomplete='off' class='select2-input'/>","   </div>","   <ul class='select2-results'>","   </ul>","</div>"].join(""));return t},opening:function(){this.search.show(),this.parent.opening.apply(this,arguments),this.dropdown.removeClass("select2-offscreen")},close:function(){if(!this.opened())return;this.parent.close.apply(this,arguments),this.dropdown.removeAttr("style").addClass("select2-offscreen").insertAfter(this.selection).show()},focus:function(){this.close(),this.selection.focus()},isFocused:function(){return this.selection[0]===document.activeElement},cancel:function(){this.parent.cancel.apply(this,arguments),this.selection.focus()},initContainer:function(){var e,t=this.container,r=this.dropdown,i=!1;this.selection=e=t.find(".select2-choice"),this.search.bind("keydown",this.bind(function(e){if(!this.enabled)return;if(e.which===n.PAGE_UP||e.which===n.PAGE_DOWN){b(e);return}if(this.opened())switch(e.which){case n.UP:case n.DOWN:this.moveHighlight(e.which===n.UP?-1:1),b(e);return;case n.TAB:case n.ENTER:this.selectHighlighted(),b(e);return;case n.ESC:this.cancel(e),b(e);return}else{if(e.which===n.TAB||n.isControl(e)||n.isFunctionKey(e)||e.which===n.ESC)return;if(this.opts.openOnEnter===!1&&e.which===n.ENTER)return;this.open();if(e.which===n.ENTER)return}})),this.search.bind("focus",this.bind(function(){this.selection.attr("tabIndex","-1")})),this.search.bind("blur",this.bind(function(){this.opened()||this.container.removeClass("select2-container-active"),window.setTimeout(this.bind(function(){var e=this.opts.element.attr("tabIndex");e?this.selection.attr("tabIndex",e):this.selection.removeAttr("tabIndex")}),10)})),e.delegate("abbr","mousedown",this.bind(function(e){if(!this.enabled)return;this.clear(),w(e),this.close(),this.triggerChange(),this.selection.focus()})),e.bind("mousedown",this.bind(function(e){i=!0,this.opened()?(this.close(),this.selection.focus()):this.enabled&&this.open(),i=!1})),r.bind("mousedown",this.bind(function(){this.search.focus()})),e.bind("focus",this.bind(function(){this.container.addClass("select2-container-active"),this.search.attr("tabIndex","-1")})),e.bind("blur",this.bind(function(){this.opened()||this.container.removeClass("select2-container-active"),window.setTimeout(this.bind(function(){this.search.attr("tabIndex",this.opts.element.attr("tabIndex"))}),10)})),e.bind("keydown",this.bind(function(e){if(!this.enabled)return;if(e.which==n.DOWN||e.which==n.UP||e.which==n.ENTER&&this.opts.openOnEnter){this.open(),b(e);return}if(e.which==n.DELETE||e.which==n.BACKSPACE){this.opts.allowClear&&this.clear(),b(e);return}})),e.bind("keypress",this.bind(function(e){var t=String.fromCharCode(e.which);this.search.val(t),this.open()})),this.setPlaceholder(),this.search.bind("focus",this.bind(function(){this.container.addClass("select2-container-active")}))},clear:function(){this.opts.element.val(""),this.selection.find("span").empty(),this.selection.removeData("select2-data"),this.setPlaceholder()},initSelection:function(){var e;if(this.opts.element.val()===""&&this.opts.element.text()==="")this.close(),this.setPlaceholder();else{var n=this;this.opts.initSelection.call(null,this.opts.element,function(e){e!==t&&e!==null&&(n.updateSelection(e),n.close(),n.setPlaceholder())})}},prepareOpts:function(){var t=this.parent.prepareOpts.apply(this,arguments);return t.element.get(0).tagName.toLowerCase()==="select"&&(t.initSelection=function(t,n){var r=t.find(":selected");e.isFunction(n)&&n({id:r.attr("value"),text:r.text(),element:r})}),t},setPlaceholder:function(){var e=this.getPlaceholder();if(this.opts.element.val()===""&&e!==t){if(this.select&&this.select.find("option:first").text()!=="")return;this.selection.find("span").html(this.opts.escapeMarkup(e)),this.selection.addClass("select2-default"),this.selection.find("abbr").hide()}},postprocessResults:function(t,n){var r=0,i=this,s=!0;this.results.find(".select2-result-selectable").each2(function(e,t){if(c(i.id(t.data("select2-data")),i.opts.element.val()))return r=e,!1}),this.highlight(r),n===!0&&(s=this.showSearchInput=L(t.results)>=this.opts.minimumResultsForSearch,this.dropdown.find(".select2-search")[s?"removeClass":"addClass"]("select2-search-hidden"),e(this.dropdown,this.container)[s?"addClass":"removeClass"]("select2-with-searchbox"))},onSelect:function(e){var t=this.opts.element.val();this.opts.element.val(this.id(e)),this.updateSelection(e),this.close(),this.selection.focus(),c(t,this.id(e))||this.triggerChange()},updateSelection:function(e){var n=this.selection.find("span"),r;this.selection.data("select2-data",e),n.empty(),r=this.opts.formatSelection(e,n),r!==t&&n.append(this.opts.escapeMarkup(r)),this.selection.removeClass("select2-default"),this.opts.allowClear&&this.getPlaceholder()!==t&&this.selection.find("abbr").show()},val:function(){var e,n=null,r=this;if(arguments.length===0)return this.opts.element.val();e=arguments[0];if(this.select)this.select.val(e).find(":selected").each2(function(e,t){return n={id:t.attr("value"),text:t.text()},!1}),this.updateSelection(n),this.setPlaceholder();else{if(this.opts.initSelection===t)throw new Error("cannot call val() if initSelection() is not defined");if(!e){this.clear();return}this.opts.element.val(e),this.opts.initSelection(this.opts.element,function(e){r.opts.element.val(e?r.id(e):""),r.updateSelection(e),r.setPlaceholder()})}},clearSearch:function(){this.search.val("")},data:function(e){var n;if(arguments.length===0)return n=this.selection.data("select2-data"),n==t&&(n=null),n;!e||e===""?this.clear():(this.opts.element.val(e?this.id(e):""),this.updateSelection(e))}}),s=O(r,{createContainer:function(){var t=e("<div></div>",{"class":"select2-container select2-container-multi"}).html(["    <ul class='select2-choices'>","  <li class='select2-search-field'>","    <input type='text' autocomplete='off' class='select2-input'>","  </li>","</ul>","<div class='select2-drop select2-drop-multi' style='display:none;'>","   <ul class='select2-results'>","   </ul>","</div>"].join(""));return t},prepareOpts:function(){var t=this.parent.prepareOpts.apply(this,arguments);return t.element.get(0).tagName.toLowerCase()==="select"&&(t.initSelection=function(t,n){var r=[];t.find(":selected").each2(function(e,t){r.push({id:t.attr("value"),text:t.text(),element:t})}),e.isFunction(n)&&n(r)}),t},initContainer:function(){var t=".select2-choices",r;this.searchContainer=this.container.find(".select2-search-field"),this.selection=r=this.container.find(t),this.search.bind("keydown",this.bind(function(e){if(!this.enabled)return;if(e.which===n.BACKSPACE&&this.search.val()===""){this.close();var t,i=r.find(".select2-search-choice-focus");if(i.length>0){this.unselect(i.first()),this.search.width(10),b(e);return}t=r.find(".select2-search-choice:not(.select2-locked)"),t.length>0&&t.last().addClass("select2-search-choice-focus")}else r.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");if(this.opened())switch(e.which){case n.UP:case n.DOWN:this.moveHighlight(e.which===n.UP?-1:1),b(e);return;case n.ENTER:case n.TAB:this.selectHighlighted(),b(e);return;case n.ESC:this.cancel(e),b(e);return}if(e.which===n.TAB||n.isControl(e)||n.isFunctionKey(e)||e.which===n.BACKSPACE||e.which===n.ESC)return;if(this.opts.openOnEnter===!1&&e.which===n.ENTER)return;this.open(),(e.which===n.PAGE_UP||e.which===n.PAGE_DOWN)&&b(e)})),this.search.bind("keyup",this.bind(this.resizeSearch)),this.search.bind("blur",this.bind(function(e){this.container.removeClass("select2-container-active"),this.search.removeClass("select2-focused"),this.clearSearch(),e.stopImmediatePropagation()})),this.container.delegate(t,"mousedown",this.bind(function(t){if(!this.enabled)return;if(e(t.target).closest(".select2-search-choice").length>0)return;this.clearPlaceholder(),this.open(),this.focusSearch(),t.preventDefault()})),this.container.delegate(t,"focus",this.bind(function(){if(!this.enabled)return;this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"),this.clearPlaceholder()})),this.clearSearch()},enable:function(){if(this.enabled)return;this.parent.enable.apply(this,arguments),this.search.removeAttr("disabled")},disable:function(){if(!this.enabled)return;this.parent.disable.apply(this,arguments),this.search.attr("disabled",!0)},initSelection:function(){var e;this.opts.element.val()===""&&this.opts.element.text()===""&&(this.updateSelection([]),this.close(),this.clearSearch());if(this.select||this.opts.element.val()!==""){var n=this;this.opts.initSelection.call(null,this.opts.element,function(e){e!==t&&e!==null&&(n.updateSelection(e),n.close(),n.clearSearch())})}},clearSearch:function(){var e=this.getPlaceholder();e!==t&&this.getVal().length===0&&this.search.hasClass("select2-focused")===!1?(this.search.val(e).addClass("select2-default"),this.resizeSearch()):this.search.val(" ").width(10)},clearPlaceholder:function(){this.search.hasClass("select2-default")?this.search.val("").removeClass("select2-default"):this.search.val()===" "&&this.search.val("")},opening:function(){this.parent.opening.apply(this,arguments),this.clearPlaceholder(),this.resizeSearch(),this.focusSearch()},close:function(){if(!this.opened())return;this.parent.close.apply(this,arguments)},focus:function(){this.close(),this.search.focus()},isFocused:function(){return this.search.hasClass("select2-focused")},updateSelection:function(t){var n=[],r=[],i=this;e(t).each(function(){l(i.id(this),n)<0&&(n.push(i.id(this)),r.push(this))}),t=r,this.selection.find(".select2-search-choice").remove(),e(t).each(function(){i.addSelectedChoice(this)}),i.postprocessResults()},tokenize:function(){var e=this.search.val();e=this.opts.tokenizer(e,this.data(),this.bind(this.onSelect),this.opts),e!=null&&e!=t&&(this.search.val(e),e.length>0&&this.open())},onSelect:function(e){this.addSelectedChoice(e),(this.select||!this.opts.closeOnSelect)&&this.postprocessResults(),this.opts.closeOnSelect?(this.close(),this.search.width(10)):this.countSelectableResults()>0?(this.search.width(10),this.resizeSearch(),this.positionDropdown()):this.close(),this.triggerChange({added:e}),this.focusSearch()},cancel:function(){this.close(),this.focusSearch()},addSelectedChoice:function(n){var r=!n.locked,i=e("<li class='select2-search-choice'>    <div></div>    <a href='#' onclick='return false;' class='select2-search-choice-close' tabindex='-1'></a></li>"),s=e("<li class='select2-search-choice select2-locked'><div></div></li>"),o=r?i:s,u=this.id(n),a=this.getVal(),f;f=this.opts.formatSelection(n,o.find("div")),f!=t&&o.find("div").replaceWith("<div>"+this.opts.escapeMarkup(f)+"</div>"),r&&o.find(".select2-search-choice-close").bind("mousedown",b).bind("click dblclick",this.bind(function(t){if(!this.enabled)return;e(t.target).closest(".select2-search-choice").fadeOut("fast",this.bind(function(){this.unselect(e(t.target)),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus"),this.close(),this.focusSearch()})).dequeue(),b(t)})).bind("focus",this.bind(function(){if(!this.enabled)return;this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active")})),o.data("select2-data",n),o.insertBefore(this.searchContainer),a.push(u),this.setVal(a)},unselect:function(e){var t=this.getVal(),n,r;e=e.closest(".select2-search-choice");if(e.length===0)throw"Invalid argument: "+e+". Must be .select2-search-choice";n=e.data("select2-data"),r=l(this.id(n),t),r>=0&&(t.splice(r,1),this.setVal(t),this.select&&this.postprocessResults()),e.remove(),this.triggerChange({removed:n})},postprocessResults:function(){var e=this.getVal(),t=this.results.find(".select2-result-selectable"),n=this.results.find(".select2-result-with-children"),r=this;t.each2(function(t,n){var i=r.id(n.data("select2-data"));l(i,e)>=0?n.addClass("select2-disabled").removeClass("select2-result-selectable"):n.removeClass("select2-disabled").addClass("select2-result-selectable")}),n.each2(function(e,t){!t.is(".select2-result-selectable")&&t.find(".select2-result-selectable").length==0?t.addClass("select2-disabled"):t.removeClass("select2-disabled")}),this.highlight()==-1&&t.each2(function(e,t){if(!t.hasClass("select2-disabled")&&t.hasClass("select2-result-selectable"))return r.highlight(0),!1})},resizeSearch:function(){var e,t,n,r,i,s=p(this.search);e=E(this.search)+10,t=this.search.offset().left,n=this.selection.width(),r=this.selection.offset().left,i=n-(t-r)-s,i<e&&(i=n-s),i<40&&(i=n-s),this.search.width(i)},getVal:function(){var e;return this.select?(e=this.select.val(),e===null?[]:e):(e=this.opts.element.val(),h(e,this.opts.separator))},setVal:function(t){var n;this.select?this.select.val(t):(n=[],e(t).each(function(){l(this,n)<0&&n.push(this)}),this.opts.element.val(n.length===0?"":n.join(this.opts.separator)))},val:function(){var n,r=[],i=this;if(arguments.length===0)return this.getVal();n=arguments[0];if(!n){this.opts.element.val(""),this.updateSelection([]),this.clearSearch();return}this.setVal(n);if(this.select)this.select.find(":selected").each(function(){r.push({id:e(this).attr("value"),text:e(this).text()})}),this.updateSelection(r);else{if(this.opts.initSelection===t)throw new Error("val() cannot be called if initSelection() is not defined");this.opts.initSelection(this.opts.element,function(t){var n=e(t).map(i.id);i.setVal(n),i.updateSelection(t),i.clearSearch()})}this.clearSearch()},onSortStart:function(){if(this.select)throw new Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.");this.search.width(0),this.searchContainer.hide()},onSortEnd:function(){var t=[],n=this;this.searchContainer.show(),this.searchContainer.appendTo(this.searchContainer.parent()),this.resizeSearch(),this.selection.find(".select2-search-choice").each(function(){t.push(n.opts.id(e(this).data("select2-data")))}),this.setVal(t),this.triggerChange()},data:function(t){var n=this,r;if(arguments.length===0)return this.selection.find(".select2-search-choice").map(function(){return e(this).data("select2-data")}).get();t||(t=[]),r=e.map(t,function(e){return n.opts.id(e)}),this.setVal(r),this.updateSelection(t),this.clearSearch()}}),e.fn.select2=function(){var n=Array.prototype.slice.call(arguments,0),r,o,u,a,f=["val","destroy","opened","open","close","focus","isFocused","container","onSortStart","onSortEnd","enable","disable","positionDropdown","data"];return this.each(function(){if(n.length===0||typeof n[0]=="object")r=n.length===0?{}:e.extend({},n[0]),r.element=e(this),r.element.get(0).tagName.toLowerCase()==="select"?a=r.element.attr("multiple"):(a=r.multiple||!1,"tags"in r&&(r.multiple=a=!0)),o=a?new s:new i,o.init(r);else{if(typeof n[0]!="string")throw"Invalid arguments to select2 plugin: "+n;if(l(n[0],f)<0)throw"Unknown method: "+n[0];u=t,o=e(this).data("select2");if(o===t)return;n[0]==="container"?u=o.container:u=o[n[0]].apply(o,n.slice(1));if(u!==t)return!1}}),u===t?this:u},e.fn.select2.defaults={width:"copy",closeOnSelect:!0,openOnEnter:!0,containerCss:{},dropdownCss:{},containerCssClass:"",dropdownCssClass:"",formatResult:function(e,t,n){var r=[];return S(e.text,n.term,r),r.join("")},formatSelection:function(e,n){return e?e.text:t},formatResultCssClass:function(e){return t},formatNoMatches:function(){return"No matches found"},formatInputTooShort:function(e,t){var n=t-e.length;return"Please enter "+n+" more character"+(n==1?"":"s")},formatSelectionTooBig:function(e){return"You can only select "+e+" item"+(e==1?"":"s")},formatLoadMore:function(e){return"Loading more results..."},formatSearching:function(){return"Searching..."},minimumResultsForSearch:0,minimumInputLength:0,maximumSelectionSize:0,id:function(e){return e.id},matcher:function(e,t){return t.toUpperCase().indexOf(e.toUpperCase())>=0},separator:",",tokenSeparators:[],tokenizer:A,escapeMarkup:function(e){return e&&typeof e=="string"?e.replace(/&/g,"&amp;"):e},blurOnChange:!1},window.Select2={query:{ajax:x,local:T,tags:N},util:{debounce:m,markMatch:S},"class":{"abstract":r,single:i,multi:s}}}(t),e}),define("$plugin!pickadate",["$"],function(e){var t=e;return function(e,t,n,r){var i=7,s=6,o=s*i,u="div",a="tr",f="/",l="pickadate__",c=e(t),h=Array.isArray||function(e){return{}.toString.call(e)=="[object Array]"},p=function(e,t,n){if(typeof e=="function")return e.apply(t,n)},d=function(e){return(e<10?"0":"")+e},v=function(e,t,n,r,i){return t=h(t)?t.join(""):t,r=r?" data-"+r.name+'="'+r.value+'"':"",n=n?' class="'+n+'"':"",i=i?" "+i:"","<"+e+r+n+i+">"+t+"</"+e+">"},m=function(e,t,n,r,i){var s="";return e.map(function(n,o){o=r?r+o:o;var u=(p(i,e,[o])||"")+"value="+o+(t==o?" selected":"");s+=v("option",n,null,null,u)}),v("select",s,n)},g=function(e){var t;return h(e)?t=new Date(e[0],e[1],e[2]):e===!0?(t=new Date,t.setHours(0,0,0,0)):isNaN(e)||(t=new Date(e)),{YEAR:t.getFullYear(),MONTH:t.getMonth(),DATE:t.getDate(),DAY:t.getDay(),TIME:t.getTime()}},y=function(t,r){function P(){var e=function(e){if(e&&A.YEAR>=L.YEAR&&A.MONTH>=L.MONTH||!e&&A.YEAR<=C.YEAR&&A.MONTH<=C.MONTH)return"";var t="month_"+(e?"next":"prev");return v(u,r[t],w[t],{name:"nav",value:e||-1})};return e()+e(1)}function H(){var e=r.show_months_full?r.months_full:r.months_short;return r.month_selector?m(e,A.MONTH,w.month_selector,0,function(e){return G(e,A.YEAR,"disabled ")||""}):v(u,e[A.MONTH],w.month)}function B(){var e=A.YEAR,t=r.year_selector;if(t){t=t===!0?5:~~(t/2);var n=[],i=e-t,s=I(i,C.YEAR),o=e+t+(s-i),a=I(o,L.YEAR,1);t=o-a,t&&(s=I(i-t,C.YEAR));for(var f=0;f<=a-s;f+=1)n.push(s+f);return m(n,e,w.year_selector,s)}return v(u,e,w.year)}function j(){var e,t,n,r=[],s="",l=q(A.YEAR,A.MONTH),c=R(A.DATE,A.DAY),h=function(e,t){var n=!1,r=[w.calendar_date,t?w.day_infocus:w.day_outfocus];if(e.TIME<C.TIME||e.TIME>L.TIME||O&&O.filter(M,e).length)n=!0,r.push(w.day_disabled);return e.TIME==T.TIME&&r.push(w.day_today),e.TIME==N.TIME&&r.push(w.day_selected),[r.join(" "),{name:n?"disabled":"date",value:[e.YEAR,e.MONTH+1,e.DATE,e.DAY,e.TIME].join(f)}]};for(var p=0;p<o;p+=1)t=p-c,e=g([A.YEAR,A.MONTH,t]),n=h(e,t>0&&t<=l),r.push(v("td",v(u,e.DATE,n[0],n[1]))),p%i+1==i&&(s+=v(a,r.splice(0,i)));return v("tbody",s,w.calendar_body)}function F(){return v(u,v(u,v(u,P(),w.month_nav)+v(u,H(),w.month_box)+v(u,B(),w.year_box)+v("table",[_,j()],w.calendar),w.calendar_box),w.calendar_wrap)}function I(e,t,n){return n&&e<t||!n&&e>t?e:t}function q(e,t){var n=t>6?!0:!1;return t==1?e%400!==0&&e%100===0||e%4!==0?28:29:t%2?n?31:30:n?30:31}function R(e,t){var n=e%i,s=t-n+(r.first_day?-1:0);return t>=n?s:i+s}function U(){return T||(T=g(!0))}function z(){return N||(N=function(e){return isNaN(e)?T:g(e)}(Date.parse(E.value)))}function W(e,t){var n=K(w.day_selected);return N=h(e)?{YEAR:+e[0],MONTH:+e[1]-1,DATE:+e[2],DAY:+e[3],TIME:+e[4]}:e,t&&N.MONTH==A.MONTH?(n.removeClass(w.day_selected),t.addClass(w.day_selected)):(A=N,Y()),E.value=J(),S&&(S.value=J(r.format_submit)),p(r.onSelect,y),l}function X(){return A||(A=z())}function V(e,t){return A=g([t,e,1])}function $(e,t){return e===!0?T:h(e)?(--e[1],g(e)):t&&e>0||!t&&e<0?g([T.YEAR,T.MONTH,T.DATE+e]):(e=t?Infinity:-Infinity,{YEAR:e,MONTH:e,TIME:e})}function J(e){return x.toArray(e||r.format).map(function(e){return p(x[e])||e}).join("")}function K(e){return s.find("."+e)}function Q(e,t){return t=t||A.YEAR,e=G(e,t,C.MONTH,L.MONTH)||e,V(e,t),Y(),l}function G(e,t,n,r){if(t<=C.YEAR&&e<C.MONTH)return n;if(t>=L.YEAR&&e>L.MONTH)return r||n}function Y(){s.html(F()),Z()}function Z(){K(w.month_selector).on({change:function(){Q(+this.value)}}),K(w.year_selector).on({change:function(){Q(A.MONTH,+this.value)}})}function et(){return l.isOpen?l:(l.isOpen=!0,t.addClass(w.input_focus),s.addClass(w.picker_open),c.on("click.P"+l.id,function(e){l.isOpen&&E!=e.target&&tt()}),p(r.onOpen,y),l)}function tt(){return l.isOpen=!1,t.removeClass(w.input_focus),s.removeClass(w.picker_open),c.off("click.P"+l.id),p(r.onClose,y),l}function nt(n){var r=e(n.target),i=r.data();n.stopPropagation();if(i.date){W(i.date.split(f),r),tt();return}i.nav&&Q(A.MONTH+i.nav),t.focus()}var s,l={id:~~(Math.random()*1e9)},y={open:function(){return et(),this},close:function(){return tt(),this},show:function(e,t){return Q(--e,t),this},getDate:function(){return S?S.value:E.value},setDate:function(e,t,n){return W(g([e,--t,n])),this}},w=r.klass,E=function(e){return e.nodeName!="INPUT"?r.format_submit=r.format_submit||"yyyy-mm-dd":(e.autofocus=e==n.activeElement,e.type="text",e.readOnly=!0),e}(t[0]),S=function(t){return t?S=e("<input type=hidden name="+E.name+r.hidden_suffix+">").val(E.value?J(t):"")[0]:null}(r.format_submit),x={d:function(){return N.DATE},dd:function(){return d(N.DATE)},ddd:function(){return r.weekdays_short[N.DAY]},dddd:function(){return r.weekdays_full[N.DAY]},m:function(){return N.MONTH+1},mm:function(){return d(N.MONTH+1)},mmm:function(){return r.months_short[N.MONTH]},mmmm:function(){return r.months_full[N.MONTH]},yy:function(){return N.YEAR.toString().substr(2,2)},yyyy:function(){return N.YEAR},toArray:function(e){return e.split(/(?=\b)(d{1,4}|m{1,4}|y{4}|yy)+(\b)/g)}},T=U(),N=z(),C=$(r.date_min),L=$(r.date_max,1),A=X(),O=function(e){if(h(e))return e[0]===!0&&(l.disabled=e.shift()),e.map(function(e){return isNaN(e)?(--e[1],g(e)):(l.disabledDays=!0,--e+r.first_day)})}(r.dates_disabled),M=function(){var e=function(e){return this.TIME==e.TIME||l.disabledDays&&O.indexOf(this.DAY)>-1};return l.disabled?function(t,n,r){return r.map(e,this).indexOf(!0)<0}:e}(),_=function(e){return r.first_day&&e.push(e.splice(0,1)[0]),v("thead",v(a,e.map(function(e){return v("th",e,w.weekdays)})))}((r.show_weekdays_short?r.weekdays_short:r.weekdays_full).slice(0)),D=function(){s=e(v(u,F(),w.picker_holder)).on({click:nt}),t.on({keydown:function(e){e.keyCode==9&&tt()},focusin:function(){et()}}).after([s,S]),Z(),E.autofocus&&et(),p(r.onStart,y)}();return y};y.defaults={months_full:["January","February","March","April","May","June","July","August","September","October","November","December"],months_short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdays_full:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdays_short:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month_prev:"&#9664;",month_next:"&#9654;",show_months_full:!0,show_weekdays_short:!0,format:"d mmmm, yyyy",format_submit:!1,hidden_suffix:"_submit",first_day:0,month_selector:!1,year_selector:!1,date_min:!1,date_max:!1,dates_disabled:!1,disable_picker:!1,onOpen:null,onClose:null,onSelect:null,onStart:null,klass:{input_focus:l+"input--focused",picker_holder:l+"holder",picker_open:l+"holder--opened",calendar_wrap:l+"calendar--wrap",calendar_box:l+"calendar--box",calendar:l+"calendar",calendar_body:l+"calendar--body",calendar_date:l+"calendar--date",year:l+"year",year_box:l+"year--box",year_selector:l+"year--selector",month:l+"month",month_box:l+"month--box",month_selector:l+"month--selector",month_nav:l+"month--nav",month_prev:l+"month--prev",month_next:l+"month--next",week:l+"week",weekdays:l+"weekday",day_disabled:l+"day--disabled",day_selected:l+"day--selected",day_today:l+"day--today",day_infocus:l+"day--infocus",day_outfocus:l+"day--outfocus",box_months:l+"holder--months",box_years:l+"holder--years",box_weekdays:l+"holder--weekdays"}},e.fn.pickadate=function(t){var n="pickadate";return t=e.extend(!0,{},y.defaults,t),t.disable_picker?this:this.each(function(){var r=e(this);r.data(n)||r.data(n,new y(r,t))})}}(t,window,document),e}),define("admin/modules/WidgetEvents",[],function(){var e="admin/modules/widget-events/";return{RENDER:e+"render"}}),define("admin/modules/WindowPopup",["require","exports","module","rosy/base/DOMClass","$"],function(e,t,n){var r=e("rosy/base/DOMClass"),i=e("$"),s=0,o=r.extend({init:function(e){},request:function(e,t,n){var r="windowpopupguid"+ ++s,i;window[r]=function(e){n(e),i.close(),window[r]=null,delete window[r]},i=window.open(e,r,t)},respond:function(e){var t=window.name;window.opener&&window.opener[t]&&typeof window.opener[t]=="function"&&window.opener[t](e)}});return new o}),define("admin/modules/AssetSelect",["rosy/base/DOMClass","$","$plugin!select2","./WidgetEvents","./WindowPopup"],function(e,t,n,r,i){return e.extend({dom:null,preview:null,input:null,count:0,popup:null,init:function(e){this.dom=e,this.input=e.find("input"),this.preview=e.find(".widget-asset-preview"),this._autoTag(),this._initSelect2()},_initSelect2:function(){this.input.select2({placeholder:"Choose an asset",allowClear:!0,initSelection:this.initSelection,formatSelection:this.formatSelection,formatResult:this.formatResult,ajax:{url:this.dom.data("api"),quietMillis:500,dataType:"json",data:this._ajaxData,results:this._ajaxResults}}),this.input.on("change",this.onChange),this._tag(),this.dom.on("click",".button",this._openPopup)},_openPopup:function(e){var n=t(e.currentTarget),r=n.attr("href"),s="menubar=no,location=no,resizable=no,scrollbars=yes,status=no,height=500,width=800";return i.request(r,s,this._gotDataFromPopup),!1},_gotDataFromPopup:function(e){this.input.select2("data",e)},_autoTag:function(){var e=[];t("[data-auto-tag]").each(function(n,r){var i=t(r).data("auto-tag");if(i){var s=i.toLowerCase().split(",");while(s.length){var o=s.shift();o.match(/[a-z0-9]/i)&&o.length>3&&e.push(o)}e=e.concat(s)}}),t("#auto_tags").val(e.join(",")),this._auto_tags=e},_tag:function(){if(!this.dom.find("a.button").length)return;var e=this.dom.find("a.button"),n=this._unparam(e[0].search),r=(t(this.dom).data("tags")||"").toLowerCase().split(",");r=r.concat(this._all_tags),n.tags=encodeURIComponent(r.join(",")),e[0].search=this._param(n)},_param:function(e){var t=[],n;for(n in e)t.push(n+"="+e[n]);return"?"+t.join("&")},_unparam:function(e){var t={},n=e.replace(/^\?/,"").split("&"),r=n.length,i=0,s;for(i;i<r;i++){if(!n[i])continue;s=n[i].split("="),t[s[0]]=s[1]}return t},_ajaxData:function(e,t,n){return{page:t,tag:e}},_ajaxResults:function(e,n,r){return t.each(e.results,function(e,t){t.text=t.user_filename}),{results:e.results,more:!!e.next}},onChange:function(){this.input.val()||this.preview.css("background-image","none")},initSelection:function(e,t){t({id:e.val(),text:this.dom.data("title")})},formatSelection:function(e,t){return e.thumbnail&&this.preview.css("background-image","url("+e.thumbnail+")"),e.url&&this.input.attr("data-src",e.url),e.text},formatResult:function(e,n,r){var i=t("<div>").addClass("select2-result-image-thumbnail");e.thumbnail&&i.css("background-image","url("+e.thumbnail+")"),n.addClass("select2-result-image"),n.append(e.text),n.append(i)}})}),define("admin/modules/ApiSelect",["rosy/base/DOMClass","$","$plugin!select2","./WindowPopup"],function(e,t,n,r){return e.extend({dom:null,input:null,label:null,toggle:null,select2:null,count:0,name:"title",names:[],param:null,params:[],init:function(e){this.dom=e,this.dom.on("click","[data-param]",this.clickParam),this.input=e.find("input"),this.label=t('label[for="'+this.input.attr("id")+'"]'),this.dom.data("add")&&this._initAdd(),this.names=[],this.params=[],this._initSelect2()},_initParams:function(){if(this.toggle||this.params.length<2)return;var e,n,r;this.toggle=t("<div>").addClass("toggle"),this.dom.append(this.toggle);for(n=0;n<this.params.length;n++)e=this.params[n],r=t("<div>").attr("data-param",e.id).text(e.name),r.addClass("toggle-button"),n===0&&r.addClass("first"),n===this.params.length-1&&r.addClass("last"),this.toggle.append(r),this.useParam(e.id)},useParam:function(e){this.dom.find("[data-param]").removeClass("active"),this.dom.find('[data-param="'+e+'"]').addClass("active"),this.param=e},clickParam:function(e){this.useParam(t(e.currentTarget).data("param"))},_showOrHideSearch:function(){this.param?this.select2.search.parent().css("display",""):this.select2.search.parent().css("display","none")},_initAdd:function(){var e=this.dom.data("add"),n=t("<a>").attr("href",e).addClass("button add-button").text("+");this.dom.prepend(n),this.dom.addClass("has-add-button"),n.on("click",this._openPopup)},_openPopup:function(e){var n=t(e.currentTarget),i=n.attr("href"),s="menubar=no,location=no,resizable=no,scrollbars=yes,status=no,height=500,width=800";return r.request(i,s,this._gotDataFromPopup),!1},_gotDataFromPopup:function(e){this.input.select2("data",e)},_initSelect2:function(){var e=this.label.text()||"one";e=e.replace(/[^a-z0-9]/i,"").toLowerCase(),this.input.select2({placeholder:"Select "+e,allowClear:!0,initSelection:this.initSelection,formatResult:this.formatResult,ajax:{url:this.dom.data("api"),quietMillis:400,dataType:"json",data:this._ajaxData,results:this._ajaxResults}}),this.select2=this.input.data().select2,this._showOrHideSearch()},formatResult:function(e,t,n){return e.text},initSelection:function(e,t){t({id:e.val(),text:this.dom.data("title")})},_ajaxData:function(e,t,n){var r={page:t};return this.param&&(r[this.param]=e),r},_ajaxResults:function(e,n,r){var i,s;this.names=[],this.params=[];for(i in e.params)this.param=this.param||i,this.params.push({id:i,name:e.params[i].label});for(s in e.fields)this.name=s,this.names.push(s);return this._initParams(),this._showOrHideSearch(),t.each(e.results,this.proxy(function(e,t){var n=[],r;for(r=0;r<this.names.length;r++)n.push(t[this.names[r]]);t.text=n.join(" - ")})),{results:e.results,more:!!e.next}}})}),define("admin/modules/Formset",["rosy/base/DOMClass","$","$plugin!select2","$plugin!ui","./WidgetEvents"],function(e,t,n,r,i){return e.extend({dom:null,forms:null,prefix:"",isDraggable:!1,init:function(e){this.dom=e,this.forms=e.find(".widget-formset-forms"),this.prefix=this.dom.data("prefix"),this.dom.on("click",".widget-formset-delete",this._delete),this.dom.on("click",".widget-formset-add",this._add),this._initSort()},_delete:function(e){var n=t(e.currentTarget),r=n.closest(".widget-formset-form");n.find("input").attr("checked",!0),r.addClass("was-deleted"),r.find(".widget-formset-order input").val(0),this._resort()},_count:function(){return this.dom.find(".widget-formset-form").length},_add:function(){var e=t("<div>").addClass("widget-formset-form added-with-js"),n=this.dom.find(".widget-formset-form-template").html();n=n.replace(/(__prefix__)/g,this._count()),e.html(n),this.forms.append(e),this.isDraggable&&e.addClass("draggable"),this.publish(i.RENDER,{dom:e}),this._resort()},_initSort:function(){this.forms.find(".widget-formset-order").length&&(this.forms.sortable({update:this._resort,change:this._resort}),this.dom.find(".widget-formset-form").addClass("draggable"),this.isDraggable=!0),this._resort()},_resort:function(){var e=0,n=this.dom.find(".widget-formset-form"),r=this.dom.find(".ui-sortable-helper"),i=this.dom.find(".ui-sortable-placeholder");n.each(function(n,r){r=t(r);if(r.is(".was-deleted, .ui-sortable-helper"))return;e%2?r.addClass("odd"):r.removeClass("odd"),r.find(".widget-formset-order input").val(e),e++}),i.hasClass("odd")?r.addClass("odd"):r.removeClass("odd"),this.dom.find("#id_"+this.prefix+"-TOTAL_FORMS").val(n.length)}})}),define("admin/modules/Tabs",["rosy/base/DOMClass","$"],function(e,t){return e.extend({dom:null,tabs:null,init:function(e){this.dom=e,this.data=this.dom.data(),this.bindTabEvents(),this.autoSelectFirstTab()},bindTabEvents:function(){this.$container=t(this.data.tabsContainer),this.$tabs=this.dom.find("[data-tabs-content]");if(!this.$container.length)return;this.$tabs.on("click",this.onTabClick)},unbindTabEvents:function(){this.$tabs&&this.$tabs.length&&this.$tabs.off()},onTabClick:function(e){e.preventDefault();var n=t(e.currentTarget);this.highlightTab(n),this.selectTab(n.data("tabsContent"))},highlightTab:function(e){this.$tabs.removeClass("active"),e.addClass("active")},selectTab:function(e){var t=this.$container.find(e);if(!t.length)return;this.hideTabContent(),t.show()},hideTabContent:function(){this.$container.children().hide()},autoSelectFirstTab:function(){var e=this.$tabs.eq(0);this.highlightTab(e),this.selectTab(e.data("tabsContent"))},destroy:function(){this.unbindTabEvents(),this.sup()}})}),define("admin/modules/Insert",["rosy/base/DOMClass","$","admin/modules/WindowPopup"],function(e,t,n){return e.extend({$dom:null,vars:{$inputs:null,$form:null,$node:!1,constrain:!1,size:{width:null,height:null}},init:function(){this.$dom=this.vars.$dom,this.vars.$inputs=this.$dom.find("[data-attribute]"),this.vars.$form=this.$dom.find("form"),this.bindInputs(),this.sup()},bindInputs:function(){this.vars.$inputs.on("keypress paste",this.onDelayInput),this.vars.$form.on("submit",this.onSubmit),this.vars.$form.find(".cancel").on("click",this.onCancel),this.$dom.find(".constrain").on("change",this.onConstrainChange)},unbindInputs:function(){this.vars.$inputs.off(),this.vars.$form.off(),this.vars.$form.find(".cancel").off(),this.$dom.find(".constrain").off()},onDelayInput:function(e){this.setTimeout(function(){this.onInput(e)})},onInput:function(e){throw"You must override the `onInput` method."},constrainProportion:function(e,t){t=parseInt(t,10);if(!this.vars.$node||isNaN(t))return;var n=e==="width"?"height":"width",r=this.vars.size[n],i=(t-this.vars.size[e])/this.vars.size[e]+1;this.vars.size[n]=Math.round(r*i),this.setAttribute(n,this.vars.size[n])},setAttribute:function(e,t){this.vars.$inputs.filter('[data-attribute="'+e+'"]').val(t),this.vars.$node.attr(e,t)},onConstrainChange:function(e){this.vars.constrain=!!t(e.currentTarget).is(":checked")},onSubmit:function(e){e.preventDefault(),n.respond(this.vars.$node)},onCancel:function(){window.close()},destroy:function(){this.unbindInputs(),this.sup()}})}),define("admin/modules/InsertVideo",["./Insert","$"],function(e,t){return e.extend({vars:{size:{width:560,height:315},providers:[{name:"youtube",regex:/(?:youtube(?:-nocookie)?\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/,embed:"http://www.youtube.com/embed/"},{name:"vimeo",regex:/(?:vimeo.com\/(.*))/,embed:"http://player.vimeo.com/video/"}]},onInput:function(e){var n=t(e.currentTarget),r=n.data("attribute"),i=t(e.currentTarget).val(),s=this.$dom.find(".video-preview"),o=s.find("iframe");r==="src"&&(i=this.validateVideo(i)),o.length?this.vars.$node=o:(o=t("<iframe />"),o.attr({frameborder:"0",allowfullscreen:""}),s.append(o),this.vars.$node=o,this.setAttribute("width",this.vars.size.width),this.setAttribute("height",this.vars.size.height));if(r==="width"||r==="height")i=i.replace("px",""),this.vars.constrain&&this.constrainProportion(r,i),this.vars.size[r]=i;this.vars.$node=o.attr(r,i)},validateVideo:function(e){var t=0,n,r=this.vars.providers,i;for(;t<r.length;t++){i=r[t],n=e.match(i.regex);if(n)return i.embed+n[1]}return e}})}),define("admin/modules/InsertImage",["./Insert","$"],function(e,t){return e.extend({bindInputs:function(){this.sup(),this.$dom.find('[data-respond="true"]').on("change",this.onInput)},onInput:function(e){var n=t(e.currentTarget),r=n.data("attribute"),i=t(e.currentTarget).val(),s=this.$dom.find(".image-preview"),o=s.find("img");n.attr("data-src")&&(s.empty(),o=s.find("img"),i=n.attr("data-src")),o.length?this.vars.$node=o:(o=t("<img />"),s.append(o),this.vars.$node=o,o.on("load",this.proxy(function(e){var t=o.width(),n=o.height();this.vars.size.width=t,this.vars.size.height=n,this.setAttribute("width",t),this.setAttribute("height",n)})));if(r==="width"||r==="height")i=i.replace("px",""),this.vars.constrain&&this.constrainProportion(r,i),this.vars.size[r]=i;this.vars.$node=o.attr(r,i)}})});var wysihtml5={version:"0.4.0pre",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"ï»¿",EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,DELETE_KEY:46};window.rangy=function(){function e(e,t){var n=typeof e[t];return n==f||n==a&&!!e[t]||"unknown"==n}function t(e,t){return typeof e[t]==a&&!!e[t]}function n(e,t){return typeof e[t]!=l}function r(e){return function(t,n){for(var r=n.length;r--;)if(!e(t,n[r]))return!1;return!0}}function i(e){return e&&v(e,d)&&g(e,p)}function s(e){window.alert("Rangy not supported in your browser. Reason: "+e),y.initialized=!0,y.supported=!1}function o(){if(!y.initialized){var n,r=!1,o=!1;e(document,"createRange")&&(n=document.createRange(),v(n,h)&&g(n,c)&&(r=!0),n.detach()),(n=t(document,"body")?document.body:document.getElementsByTagName("body")[0])&&e(n,"createTextRange")&&(n=n.createTextRange(),i(n)&&(o=!0)),!r&&!o&&s("Neither Range nor TextRange are implemented"),y.initialized=!0,y.features={implementsDomRange:r,implementsTextRange:o},r=w.concat(b),o=0;for(n=r.length;o<n;++o)try{r[o](y)}catch(u){t(window,"console")&&e(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",u)}}}function u(e){this.name=e,this.supported=this.initialized=!1}var a="object",f="function",l="undefined",c="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer START_TO_START START_TO_END END_TO_START END_TO_END".split(" "),h="setStart setStartBefore setStartAfter setEnd setEndBefore setEndAfter collapse selectNode selectNodeContents compareBoundaryPoints deleteContents extractContents cloneContents insertNode surroundContents cloneRange toString detach".split(" "),p="boundingHeight boundingLeft boundingTop boundingWidth htmlText text".split(" "),d="collapse compareEndPoints duplicate getBookmark moveToBookmark moveToElementText parentElement pasteHTML select setEndPoint getBoundingClientRect".split(" "),v=r(e),m=r(t),g=r(n),y={version:"1.2.2",initialized:!1,supported:!0,util:{isHostMethod:e,isHostObject:t,isHostProperty:n,areHostMethods:v,areHostObjects:m,areHostProperties:g,isTextRange:i},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};y.fail=s,y.warn=function(e){e="Rangy warning: "+e,y.config.alertOnWarn?window.alert(e):typeof window.console!=l&&typeof window.console.log!=l&&window.console.log(e)},{}.hasOwnProperty?y.util.extend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}:s("hasOwnProperty not supported");var b=[],w=[];y.init=o,y.addInitListener=function(e){y.initialized?e(y):b.push(e)};var E=[];y.addCreateMissingNativeApiListener=function(e){E.push(e)},y.createMissingNativeApi=function(e){e=e||window,o();for(var t=0,n=E.length;t<n;++t)E[t](e)},u.prototype.fail=function(e){throw this.initialized=!0,this.supported=!1,Error("Module '"+this.name+"' failed to load: "+e)},u.prototype.warn=function(e){y.warn("Module "+this.name+": "+e)},u.prototype.createError=function(e){return Error("Error in Rangy "+this.name+" module: "+e)},y.createModule=function(e,t){var n=new u(e);y.modules[e]=n,w.push(function(e){t(e,n),n.initialized=!0,n.supported=!0})},y.requireModules=function(e){for(var t=0,n=e.length,r,i;t<n;++t){i=e[t],r=y.modules[i];if(!r||!(r instanceof u))throw Error("Module '"+i+"' not found");if(!r.supported)throw Error("Module '"+i+"' not supported")}};var S=!1,m=function(){S||(S=!0,y.initialized||o())};if(typeof window==l)s("No window found");else{if(typeof document!=l)return e(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",m,!1),e(window,"addEventListener")?window.addEventListener("load",m,!1):e(window,"attachEvent")?window.attachEvent("onload",m):s("Window does not have required addEventListener or attachEvent method"),y;s("No document found")}}(),rangy.createModule("DomUtil",function(e,t){function n(e){for(var t=0;e=e.previousSibling;)t++;return t}function r(e,t){var n=[],r;for(r=e;r;r=r.parentNode)n.push(r);for(r=t;r;r=r.parentNode)if(v(n,r))return r;return null}function i(e,t,n){for(n=n?e:e.parentNode;n;){e=n.parentNode;if(e===t)return n;n=e}return null}function s(e){return e=e.nodeType,3==e||4==e||8==e}function o(e,t){var n=t.nextSibling,r=t.parentNode;return n?r.insertBefore(e,n):r.appendChild(e),e}function u(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=h)return e.ownerDocument;if(typeof e.document!=h)return e.document;if(e.parentNode)return u(e.parentNode);throw Error("getDocument: no document found for node")}function a(e){return e?s(e)?'"'+e.data+'"':1==e.nodeType?"<"+e.nodeName+(e.id?' id="'+e.id+'"':"")+">["+e.childNodes.length+"]":e.nodeName:"[No node]"}function f(e){this._next=this.root=e}function l(e,t){this.node=e,this.offset=t}function c(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var h="undefined",p=e.util;p.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),p.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var d=document.createElement("div");p.areHostMethods(d,["insertBefore","appendChild","cloneNode"])||t.fail("Incomplete Element implementation"),p.isHostProperty(d,"innerHTML")||t.fail("Element is missing innerHTML property"),d=document.createTextNode("test"),p.areHostMethods(d,["splitText","deleteData","insertData","appendData","cloneNode"])||t.fail("Incomplete Text Node implementation");var v=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1};f.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next,t;if(this._current){t=e.firstChild;if(!t)for(t=null;e!==this.root&&!(t=e.nextSibling);)e=e.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},l.prototype={equals:function(e){return this.node===e.node&this.offset==e.offset},inspect:function(){return"[DomPosition("+a(this.node)+":"+this.offset+")]"}},c.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},c.prototype.toString=function(){return this.message},e.dom={arrayContains:v,isHtmlNamespace:function(e){var t;return typeof e.namespaceURI==h||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t},parentElement:function(e){return e=e.parentNode,1==e.nodeType?e:null},getNodeIndex:n,getNodeLength:function(e){var t;return s(e)?e.length:(t=e.childNodes)?t.length:0},getCommonAncestor:r,isAncestorOf:function(e,t,n){for(t=n?t:t.parentNode;t;){if(t===e)return!0;t=t.parentNode}return!1},getClosestAncestorIn:i,isCharacterDataNode:s,insertAfter:o,splitDataNode:function(e,t){var n=e.cloneNode(!1);return n.deleteData(0,t),e.deleteData(t,e.length-t),o(n,e),n},getDocument:u,getWindow:function(e){e=u(e);if(typeof e.defaultView!=h)return e.defaultView;if(typeof e.parentWindow!=h)return e.parentWindow;throw Error("Cannot get a window object for node")},getIframeWindow:function(e){if(typeof e.contentWindow!=h)return e.contentWindow;if(typeof e.contentDocument!=h)return e.contentDocument.defaultView;throw Error("getIframeWindow: No Window object found for iframe element")},getIframeDocument:function(e){if(typeof e.contentDocument!=h)return e.contentDocument;if(typeof e.contentWindow!=h)return e.contentWindow.document;throw Error("getIframeWindow: No Document object found for iframe element")},getBody:function(e){return p.isHostObject(e,"body")?e.body:e.getElementsByTagName("body")[0]},getRootContainer:function(e){for(var t;t=e.parentNode;)e=t;return e},comparePoints:function(e,t,s,o){var u;if(e==s)return t===o?0:t<o?-1:1;if(u=i(s,e,!0))return t<=n(u)?-1:1;if(u=i(e,s,!0))return n(u)<o?-1:1;t=r(e,s),e=e===t?t:i(e,t,!0),s=s===t?t:i(s,t,!0);if(e===s)throw Error("comparePoints got to case 4 and childA and childB are the same!");for(t=t.firstChild;t;){if(t===e)return-1;if(t===s)return 1;t=t.nextSibling}throw Error("Should not be here!")},inspectNode:a,fragmentFromNodeChildren:function(e){for(var t=u(e).createDocumentFragment(),n;n=e.firstChild;)t.appendChild(n);return t},createIterator:function(e){return new f(e)},DomPosition:l},e.DOMException=c}),rangy.createModule("DomRange",function(e){function t(e,t){return 3!=e.nodeType&&(D.isAncestorOf(e,t.startContainer,!0)||D.isAncestorOf(e,t.endContainer,!0))}function n(e){return D.getDocument(e.startContainer)}function r(e,t,n){if(t=e._listeners[t])for(var r=0,i=t.length;r<i;++r)t[r].call(e,{target:e,args:n})}function i(e){return new P(e.parentNode,D.getNodeIndex(e))}function s(e){return new P(e.parentNode,D.getNodeIndex(e)+1)}function o(e,t,n){var r=11==e.nodeType?e.firstChild:e;return D.isCharacterDataNode(t)?n==t.length?D.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:D.splitDataNode(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),r}function u(e){for(var t,r,i=n(e.range).createDocumentFragment();r=e.next();){t=e.isPartiallySelectedSubtree(),r=r.cloneNode(!t),t&&(t=e.getSubtreeIterator(),r.appendChild(u(t)),t.detach(!0));if(10==r.nodeType)throw new H("HIERARCHY_REQUEST_ERR");i.appendChild(r)}return i}function a(e,t,n){for(var r,i,n=n||{stop:!1};r=e.next();)if(e.isPartiallySelectedSubtree()){if(!1===t(r)){n.stop=!0;break}if(r=e.getSubtreeIterator(),a(r,t,n),r.detach(!0),n.stop)break}else for(r=D.createIterator(r);i=r.next();)if(!1===t(i)){n.stop=!0;return}}function f(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),f(t),t.detach(!0)):e.remove()}function l(e){for(var t,r=n(e.range).createDocumentFragment(),i;t=e.next();){e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),i=e.getSubtreeIterator(),t.appendChild(l(i)),i.detach(!0)):e.remove();if(10==t.nodeType)throw new H("HIERARCHY_REQUEST_ERR");r.appendChild(t)}return r}function c(e,t,n){var r=!!t&&!!t.length,i,s=!!n;r&&(i=RegExp("^("+t.join("|")+")$"));var o=[];return a(new p(e,!1),function(e){(!r||i.test(e.nodeType))&&(!s||n(e))&&o.push(e)}),o}function h(e){return"["+("undefined"==typeof e.getName?"Range":e.getName())+"("+D.inspectNode(e.startContainer)+":"+e.startOffset+", "+D.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function p(e,t){this.range=e,this.clonePartiallySelectedTextNodes=t;if(!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&D.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===n&&!D.isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:D.getClosestAncestorIn(this.sc,n,!0),this._last=this.ec===n&&!D.isCharacterDataNode(this.ec)?this.ec.childNodes[this.eo-1]:D.getClosestAncestorIn(this.ec,n,!0))}}function d(e){this.code=this[e],this.codeName=e,this.message="RangeException: "+this.codeName}function v(e,t,n){this.nodes=c(e,t,n),this._next=this.nodes[0],this._position=0}function m(e){return function(t,n){for(var r,i=n?t:t.parentNode;i;){r=i.nodeType;if(D.arrayContains(e,r))return i;i=i.parentNode}return null}}function g(e,t){if(z(e,t))throw new d("INVALID_NODE_TYPE_ERR")}function y(e){if(!e.startContainer)throw new H("INVALID_STATE_ERR")}function b(e,t){if(!D.arrayContains(t,e.nodeType))throw new d("INVALID_NODE_TYPE_ERR")}function w(e,t){if(0>t||t>(D.isCharacterDataNode(e)?e.length:e.childNodes.length))throw new H("INDEX_SIZE_ERR")}function E(e,t){if(R(e,!0)!==R(t,!0))throw new H("WRONG_DOCUMENT_ERR")}function S(e){if(U(e,!0))throw new H("NO_MODIFICATION_ALLOWED_ERR")}function x(e,t){if(!e)throw new H(t)}function T(e){y(e);if(!D.arrayContains(j,e.startContainer.nodeType)&&!R(e.startContainer,!0)||!D.arrayContains(j,e.endContainer.nodeType)&&!R(e.endContainer,!0)||!(e.startOffset<=(D.isCharacterDataNode(e.startContainer)?e.startContainer.length:e.startContainer.childNodes.length))||!(e.endOffset<=(D.isCharacterDataNode(e.endContainer)?e.endContainer.length:e.endContainer.childNodes.length)))throw Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}function N(){}function C(e){e.START_TO_START=J,e.START_TO_END=K,e.END_TO_END=Q,e.END_TO_START=G,e.NODE_BEFORE=Y,e.NODE_AFTER=Z,e.NODE_BEFORE_AND_AFTER=et,e.NODE_INSIDE=tt}function k(e){C(e),C(e.prototype)}function L(e,t){return function(){T(this);var n=this.startContainer,r=this.startOffset,i=this.commonAncestorContainer,o=new p(this,!0);return n!==i&&(n=D.getClosestAncestorIn(n,i,!0),r=s(n),n=r.node,r=r.offset),a(o,S),o.reset(),i=e(o),o.detach(),t(this,n,r,n,r),i}}function A(n,r,o){function u(e,t){return function(n){y(this),b(n,B),b(q(n),j),n=(e?i:s)(n),(t?a:c)(this,n.node,n.offset)}}function a(e,t,n){var i=e.endContainer,s=e.endOffset;if(t!==e.startContainer||n!==e.startOffset){if(q(t)!=q(i)||1==D.comparePoints(t,n,i,s))i=t,s=n;r(e,t,n,i,s)}}function c(e,t,n){var i=e.startContainer,s=e.startOffset;if(t!==e.endContainer||n!==e.endOffset){if(q(t)!=q(i)||-1==D.comparePoints(t,n,i,s))i=t,s=n;r(e,i,s,t,n)}}n.prototype=new N,e.util.extend(n.prototype,{setStart:function(e,t){y(this),g(e,!0),w(e,t),a(this,e,t)},setEnd:function(e,t){y(this),g(e,!0),w(e,t),c(this,e,t)},setStartBefore:u(!0,!0),setStartAfter:u(!1,!0),setEndBefore:u(!0,!1),setEndAfter:u(!1,!1),collapse:function(e){T(this),e?r(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):r(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){y(this),g(e,!0),r(this,e,0,e,D.getNodeLength(e))},selectNode:function(e){y(this),g(e,!1),b(e,B);var t=i(e),e=s(e);r(this,t.node,t.offset,e.node,e.offset)},extractContents:L(l,r),deleteContents:L(f,r),canSurroundContents:function(){T(this),S(this.startContainer),S(this.endContainer);var e=new p(this,!0),n=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!n},detach:function(){o(this)},splitBoundaries:function(){T(this);var e=this.startContainer,t=this.startOffset,n=this.endContainer,i=this.endOffset,s=e===n;D.isCharacterDataNode(n)&&0<i&&i<n.length&&D.splitDataNode(n,i),D.isCharacterDataNode(e)&&0<t&&t<e.length&&(e=D.splitDataNode(e,t),s?(i-=t,n=e):n==e.parentNode&&i>=D.getNodeIndex(e)&&i++,t=0),r(this,e,t,n,i)},normalizeBoundaries:function(){T(this);var e=this.startContainer,t=this.startOffset,n=this.endContainer,i=this.endOffset,s=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(n=e,i=e.length,e.appendData(t.data),t.parentNode.removeChild(t))},o=function(r){var s=r.previousSibling;if(s&&s.nodeType==r.nodeType){e=r;var o=r.length;t=s.length,r.insertData(0,s.data),s.parentNode.removeChild(s),e==n?(i+=t,n=e):n==r.parentNode&&(s=D.getNodeIndex(r),i==s?(n=r,i=o):i>s&&i--)}},u=!0;D.isCharacterDataNode(n)?n.length==i&&s(n):(0<i&&(u=n.childNodes[i-1])&&D.isCharacterDataNode(u)&&s(u),u=!this.collapsed),u?D.isCharacterDataNode(e)?0==t&&o(e):t<e.childNodes.length&&(s=e.childNodes[t])&&D.isCharacterDataNode(s)&&o(s):(e=n,t=i),r(this,e,t,n,i)},collapseToPoint:function(e,t){y(this),g(e,!0),w(e,t),(e!==this.startContainer||t!==this.startOffset||e!==this.endContainer||t!==this.endOffset)&&r(this,e,t,e,t)}}),k(n)}function O(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:D.getCommonAncestor(e.startContainer,e.endContainer)}function M(e,t,n,i,s){var o=e.startContainer!==t||e.startOffset!==n,u=e.endContainer!==i||e.endOffset!==s;e.startContainer=t,e.startOffset=n,e.endContainer=i,e.endOffset=s,O(e),r(e,"boundarychange",{startMoved:o,endMoved:u})}function _(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this._listeners={boundarychange:[],detach:[]},O(this)}e.requireModules(["DomUtil"]);var D=e.dom,P=D.DomPosition,H=e.DOMException;p.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,D.isCharacterDataNode(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e=this._current,t,n;!D.isCharacterDataNode(e)||e!==this.sc&&e!==this.ec?e.parentNode&&e.parentNode.removeChild(e):(t=e===this.sc?this.so:0,n=e===this.ec?this.eo:e.length,t!=n&&e.deleteData(t,n-t))},isPartiallySelectedSubtree:function(){return t(this._current,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse();else{e=new _(n(this.range));var t=this._current,r=t,i=0,s=t,o=D.getNodeLength(t);D.isAncestorOf(t,this.sc,!0)&&(r=this.sc,i=this.so),D.isAncestorOf(t,this.ec,!0)&&(s=this.ec,o=this.eo),M(e,r,i,s,o)}return new p(e,this.clonePartiallySelectedTextNodes)},detach:function(e){e&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},d.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},d.prototype.toString=function(){return this.message},v.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){return this._current=this._next,this._next=this.nodes[++this._position],this._current},detach:function(){this._current=this._next=this.nodes=null}};var B=[1,3,4,5,7,8,10],j=[2,9,11],F=[1,3,4,5,7,8,10,11],I=[1,3,4,5,7,8],q=D.getRootContainer,R=m([9,11]),U=m([5,6,10,12]),z=m([6,10,12]),W=document.createElement("style"),X=!1;try{W.innerHTML="<b>x</b>",X=3==W.firstChild.nodeType}catch(V){}e.features.htmlParsingConforms=X;var $="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer".split(" "),J=0,K=1,Q=2,G=3,Y=0,Z=1,et=2,tt=3;N.prototype={attachListener:function(e,t){this._listeners[e].push(t)},compareBoundaryPoints:function(e,t){T(this),E(this.startContainer,t.startContainer);var n=e==G||e==J?"start":"end",r=e==K||e==J?"start":"end";return D.comparePoints(this[n+"Container"],this[n+"Offset"],t[r+"Container"],t[r+"Offset"])},insertNode:function(e){T(this),b(e,F),S(this.startContainer);if(D.isAncestorOf(e,this.startContainer,!0))throw new H("HIERARCHY_REQUEST_ERR");e=o(e,this.startContainer,this.startOffset),this.setStartBefore(e)},cloneContents:function(){T(this);var e,t;return this.collapsed?n(this).createDocumentFragment():this.startContainer===this.endContainer&&D.isCharacterDataNode(this.startContainer)?(e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=n(this).createDocumentFragment(),t.appendChild(e),t):(t=new p(this,!0),e=u(t),t.detach(),e)},canSurroundContents:function(){T(this),S(this.startContainer),S(this.endContainer);var e=new p(this,!0),n=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!n},surroundContents:function(e){b(e,I);if(!this.canSurroundContents())throw new d("BAD_BOUNDARYPOINTS_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);o(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){T(this);for(var e=new _(n(this)),t=$.length,r;t--;)r=$[t],e[r]=this[r];return e},toString:function(){T(this);var e=this.startContainer;if(e===this.endContainer&&D.isCharacterDataNode(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],e=new p(this,!0);return a(e,function(e){(3==e.nodeType||4==e.nodeType)&&t.push(e.data)}),e.detach(),t.join("")},compareNode:function(e){T(this);var t=e.parentNode,n=D.getNodeIndex(e);if(!t)throw new H("NOT_FOUND_ERR");return e=this.comparePoint(t,n),t=this.comparePoint(t,n+1),0>e?0<t?et:Y:0<t?Z:tt},comparePoint:function(e,t){return T(this),x(e,"HIERARCHY_REQUEST_ERR"),E(e,this.startContainer),0>D.comparePoints(e,t,this.startContainer,this.startOffset)?-1:0<D.comparePoints(e,t,this.endContainer,this.endOffset)?1:0},createContextualFragment:X?function(e){var t=this.startContainer,n=D.getDocument(t);if(!t)throw new H("INVALID_STATE_ERR");var r=null;return 1==t.nodeType?r=t:D.isCharacterDataNode(t)&&(r=D.parentElement(t)),r=null===r||"HTML"==r.nodeName&&D.isHtmlNamespace(D.getDocument(r).documentElement)&&D.isHtmlNamespace(r)?n.createElement("body"):r.cloneNode(!1),r.innerHTML=e,D.fragmentFromNodeChildren(r)}:function(e){y(this);var t=n(this).createElement("body");return t.innerHTML=e,D.fragmentFromNodeChildren(t)},toHtml:function(){T(this);var e=n(this).createElement("div");return e.appendChild(this.cloneContents()),e.innerHTML},intersectsNode:function(e,t){T(this),x(e,"NOT_FOUND_ERR");if(D.getDocument(e)!==n(this))return!1;var r=e.parentNode,i=D.getNodeIndex(e);x(r,"NOT_FOUND_ERR");var s=D.comparePoints(r,i,this.endContainer,this.endOffset),r=D.comparePoints(r,i+1,this.startContainer,this.startOffset);return t?0>=s&&0<=r:0>s&&0<r},isPointInRange:function(e,t){return T(this),x(e,"HIERARCHY_REQUEST_ERR"),E(e,this.startContainer),0<=D.comparePoints(e,t,this.startContainer,this.startOffset)&&0>=D.comparePoints(e,t,this.endContainer,this.endOffset)},intersectsRange:function(e,t){T(this);if(n(e)!=n(this))throw new H("WRONG_DOCUMENT_ERR");var r=D.comparePoints(this.startContainer,this.startOffset,e.endContainer,e.endOffset),i=D.comparePoints(this.endContainer,this.endOffset,e.startContainer,e.startOffset);return t?0>=r&&0<=i:0>r&&0<i},intersection:function(e){if(this.intersectsRange(e)){var t=D.comparePoints(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=D.comparePoints(this.endContainer,this.endOffset,e.endContainer,e.endOffset),r=this.cloneRange();return-1==t&&r.setStart(e.startContainer,e.startOffset),1==n&&r.setEnd(e.endContainer,e.endOffset),r}return null},union:function(e){if(this.intersectsRange(e,!0)){var t=this.cloneRange();return-1==D.comparePoints(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==D.comparePoints(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new d("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==tt},containsNodeContents:function(e){return 0<=this.comparePoint(e,0)&&0>=this.comparePoint(e,D.getNodeLength(e))},containsRange:function(e){return this.intersection(e).equals(e)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);return 0<n.length?(t.setStart(n[0],0),e=n.pop(),t.setEnd(e,e.length),e=this.containsRange(t),t.detach(),e):this.containsNodeContents(e)},createNodeIterator:function(e,t){return T(this),new v(this,e,t)},getNodes:function(e,t){return T(this),c(this,e,t)},getDocument:function(){return n(this)},collapseBefore:function(e){y(this),this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){y(this),this.setStartAfter(e),this.collapse(!0)},getName:function(){return"DomRange"},equals:function(e){return _.rangesEqual(this,e)},inspect:function(){return h(this)}},A(_,M,function(e){y(e),e.startContainer=e.startOffset=e.endContainer=e.endOffset=null,e.collapsed=e.commonAncestorContainer=null,r(e,"detach",null),e._listeners=null}),e.rangePrototype=N.prototype,_.rangeProperties=$,_.RangeIterator=p,_.copyComparisonConstants=k,_.createPrototypeRange=A,_.inspect=h,_.getRangeDocument=n,_.rangesEqual=function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset},e.DomRange=_,e.RangeException=d}),rangy.createModule("WrappedRange",function(e){function t(e,t,n,r){var o=e.duplicate();o.collapse(n);var u=o.parentElement();i.isAncestorOf(t,u,!0)||(u=t);if(!u.canHaveHTML)return new s(u.parentNode,i.getNodeIndex(u));var t=i.getDocument(u).createElement("span"),a,f=n?"StartToStart":"StartToEnd";do u.insertBefore(t,t.previousSibling),o.moveToElementText(t);while(0<(a=o.compareEndPoints(f,e))&&t.previousSibling);f=t.nextSibling;if(-1==a&&f&&i.isCharacterDataNode(f)){o.setEndPoint(n?"EndToStart":"EndToEnd",e);if(/[\r\n]/.test(f.data)){u=o.duplicate(),n=u.text.replace(/\r\n/g,"\r").length;for(n=u.moveStart("character",n);-1==u.compareEndPoints("StartToEnd",u);)n++,u.moveStart("character",1)}else n=o.text.length;u=new s(f,n)}else f=(r||!n)&&t.previousSibling,u=(n=(r||n)&&t.nextSibling)&&i.isCharacterDataNode(n)?new s(n,0):f&&i.isCharacterDataNode(f)?new s(f,f.length):new s(u,i.getNodeIndex(t));return t.parentNode.removeChild(t),u}function n(e,t){var n,r,s=e.offset,o=i.getDocument(e.node),u=o.body.createTextRange(),a=i.isCharacterDataNode(e.node);return a?(n=e.node,r=n.parentNode):(n=e.node.childNodes,n=s<n.length?n[s]:null,r=e.node),o=o.createElement("span"),o.innerHTML="&#feff;",n?r.insertBefore(o,n):r.appendChild(o),u.moveToElementText(o),u.collapse(!t),r.removeChild(o),a&&u[t?"moveStart":"moveEnd"]("character",s),u}e.requireModules(["DomUtil","DomRange"]);var r,i=e.dom,s=i.DomPosition,o=e.DomRange;if(e.features.implementsDomRange&&(!e.features.implementsTextRange||!e.config.preferTextRange)){var u=function(e){for(var t=f.length,n;t--;)n=f[t],e[n]=e.nativeRange[n]},a,f=o.rangeProperties,l;r=function(e){if(!e)throw Error("Range must be specified");this.nativeRange=e,u(this)},o.createPrototypeRange(r,function(e,t,n,r,i){var s=e.endContainer!==r||e.endOffset!=i;if(e.startContainer!==t||e.startOffset!=n||s)e.setEnd(r,i),e.setStart(t,n)},function(e){e.nativeRange.detach(),e.detached=!0;for(var t=f.length,n;t--;)n=f[t],e[n]=null}),a=r.prototype,a.selectNode=function(e){this.nativeRange.selectNode(e),u(this)},a.deleteContents=function(){this.nativeRange.deleteContents(),u(this)},a.extractContents=function(){var e=this.nativeRange.extractContents();return u(this),e},a.cloneContents=function(){return this.nativeRange.cloneContents()},a.surroundContents=function(e){this.nativeRange.surroundContents(e),u(this)},a.collapse=function(e){this.nativeRange.collapse(e),u(this)},a.cloneRange=function(){return new r(this.nativeRange.cloneRange())},a.refresh=function(){u(this)},a.toString=function(){return this.nativeRange.toString()};var c=document.createTextNode("test");i.getBody(document).appendChild(c);var h=document.createRange();h.setStart(c,0),h.setEnd(c,0);try{h.setStart(c,1),a.setStart=function(e,t){this.nativeRange.setStart(e,t),u(this)},a.setEnd=function(e,t){this.nativeRange.setEnd(e,t),u(this)},l=function(e){return function(t){this.nativeRange[e](t),u(this)}}}catch(p){a.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}u(this)},a.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}u(this)},l=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(r){this.nativeRange[t](n),this.nativeRange[e](n)}u(this)}}}a.setStartBefore=l("setStartBefore","setEndBefore"),a.setStartAfter=l("setStartAfter","setEndAfter"),a.setEndBefore=l("setEndBefore","setStartBefore"),a.setEndAfter=l("setEndAfter","setStartAfter"),h.selectNodeContents(c),a.selectNodeContents=h.startContainer==c&&h.endContainer==c&&0==h.startOffset&&h.endOffset==c.length?function(e){this.nativeRange.selectNodeContents(e),u(this)}:function(e){this.setStart(e,0),this.setEnd(e,o.getEndOffset(e))},h.selectNodeContents(c),h.setEnd(c,3),l=document.createRange(),l.selectNodeContents(c),l.setEnd(c,4),l.setStart(c,2),a.compareBoundaryPoints=-1==h.compareBoundaryPoints(h.START_TO_END,l)&1==h.compareBoundaryPoints(h.END_TO_START,l)?function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)},e.util.isHostMethod(h,"createContextualFragment")&&(a.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),i.getBody(document).removeChild(c),h.detach(),l.detach(),e.createNativeRange=function(e){return e=e||document,e.createRange()}}else e.features.implementsTextRange&&(r=function(e){this.textRange=e,this.refresh()},r.prototype=new o(document),r.prototype.refresh=function(){var e,n,r=this.textRange;e=r.parentElement();var s=r.duplicate();s.collapse(!0),n=s.parentElement(),s=r.duplicate(),s.collapse(!1),r=s.parentElement(),n=n==r?n:i.getCommonAncestor(n,r),n=n==e?n:i.getCommonAncestor(e,n),0==this.textRange.compareEndPoints("StartToEnd",this.textRange)?n=e=t(this.textRange,n,!0,!0):(e=t(this.textRange,n,!0,!1),n=t(this.textRange,n,!1,!1)),this.setStart(e.node,e.offset),this.setEnd(n.node,n.offset)},o.copyComparisonConstants(r),a=function(){return this}(),"undefined"==typeof a.Range&&(a.Range=r),e.createNativeRange=function(e){return e=e||document,e.body.createTextRange()});e.features.implementsTextRange&&(r.rangeToTextRange=function(e){if(e.collapsed)return n(new s(e.startContainer,e.startOffset),!0);var t=n(new s(e.startContainer,e.startOffset),!0),r=n(new s(e.endContainer,e.endOffset),!1),e=i.getDocument(e.startContainer).body.createTextRange();return e.setEndPoint("StartToStart",t),e.setEndPoint("EndToEnd",r),e}),r.prototype.getName=function(){return"WrappedRange"},e.WrappedRange=r,e.createRange=function(t){return t=t||document,new r(e.createNativeRange(t))},e.createRangyRange=function(e){return e=e||document,new o(e)},e.createIframeRange=function(t){return e.createRange(i.getIframeDocument(t))},e.createIframeRangyRange=function(t){return e.createRangyRange(i.getIframeDocument(t))},e.addCreateMissingNativeApiListener(function(t){t=t.document,"undefined"==typeof t.createRange&&(t.createRange=function(){return e.createRange(this)}),t=t=null})}),rangy.createModule("WrappedSelection",function(e,t){function n(e){return(e||window).getSelection()}function r(e){return(e||window).document.selection}function i(e,t,n){var r=n?"end":"start",n=n?"start":"end";e.anchorNode=t[r+"Container"],e.anchorOffset=t[r+"Offset"],e.focusNode=t[n+"Container"],e.focusOffset=t[n+"Offset"]}function s(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function o(t){var n;return t instanceof g?(n=t._selectionNativeRange,n||(n=e.createNativeRange(v.getDocument(t.startContainer)),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset),t._selectionNativeRange=n,t.attachListener("detach",function(){this._selectionNativeRange=null}))):t instanceof y?n=t.nativeRange:e.features.implementsDomRange&&t instanceof v.getWindow(t.startContainer).Range&&(n=t),n}function u(e){var t=e.getNodes(),n;e:if(!t.length||1!=t[0].nodeType)n=!1;else{n=1;for(var r=t.length;n<r;++n)if(!v.isAncestorOf(t[0],t[n])){n=!1;break e}n=!0}if(!n)throw Error("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return t[0]}function a(e,t){var n=new y(t);e._ranges=[n],i(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function f(t){t._ranges.length=0;if("None"==t.docSelection.type)s(t);else{var n=t.docSelection.createRange();if(n&&"undefined"!=typeof n.text)a(t,n);else{t.rangeCount=n.length;for(var r,o=v.getDocument(n.item(0)),u=0;u<t.rangeCount;++u)r=e.createRange(o),r.selectNode(n.item(u)),t._ranges.push(r);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,i(t,t._ranges[t.rangeCount-1],!1)}}}function l(e,t){for(var n=e.docSelection.createRange(),r=u(t),i=v.getDocument(n.item(0)),i=v.getBody(i).createControlRange(),s=0,o=n.length;s<o;++s)i.add(n.item(s));try{i.add(r)}catch(a){throw Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}i.select(),f(e)}function c(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function h(e,t){for(var n=v.getDocument(t[0].startContainer),n=v.getBody(n).createControlRange(),r=0,i;r<rangeCount;++r){i=u(t[r]);try{n.add(i)}catch(s){throw Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}n.select(),f(e)}function p(e,t){if(e.anchorNode&&v.getDocument(e.anchorNode)!==v.getDocument(t))throw new b("WRONG_DOCUMENT_ERR")}function d(e){var t=[],n=new w(e.anchorNode,e.anchorOffset),r=new w(e.focusNode,e.focusOffset),i="function"==typeof e.getName?e.getName():"Selection";if("undefined"!=typeof e.rangeCount)for(var s=0,o=e.rangeCount;s<o;++s)t[s]=g.inspect(e.getRangeAt(s));return"["+i+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+r.inspect()+"]"}e.requireModules(["DomUtil","DomRange","WrappedRange"]),e.config.checkSelectionRanges=!0;var v=e.dom,m=e.util,g=e.DomRange,y=e.WrappedRange,b=e.DOMException,w=v.DomPosition,E,S,x=e.util.isHostMethod(window,"getSelection"),T=e.util.isHostObject(document,"selection"),N=T&&(!x||e.config.preferTextRange);N?(E=r,e.isSelectionValid=function(e){var e=(e||window).document,t=e.selection;return"None"!=t.type||v.getDocument(t.createRange().parentElement())==e}):x?(E=n,e.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected."),e.getNativeSelection=E;var x=E(),C=e.createNativeRange(document),k=v.getBody(document),L=m.areHostObjects(x,m.areHostProperties(x,["anchorOffset","focusOffset"]));e.features.selectionHasAnchorAndFocus=L;var A=m.isHostMethod(x,"extend");e.features.selectionHasExtend=A;var O="number"==typeof x.rangeCount;e.features.selectionHasRangeCount=O;var M=!1,_=!0;if(m.areHostMethods(x,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof x.rangeCount&&e.features.implementsDomRange){var D=document.createElement("iframe");k.appendChild(D),_=v.getIframeDocument(D),_.open(),_.write("<html><head></head><body>12</body></html>"),_.close();var P=v.getIframeWindow(D).getSelection(),H=_.documentElement.lastChild.firstChild,B=_.createRange();B.setStart(H,1),B.collapse(!0),P.addRange(B),_=1==P.rangeCount,P.removeAllRanges();var j=B.cloneRange();B.setStart(H,0),j.setEnd(H,2),P.addRange(B),P.addRange(j),M=2==P.rangeCount,B.detach(),j.detach(),k.removeChild(D)}e.features.selectionSupportsMultipleRanges=M,e.features.collapsedNonEditableSelectionsSupported=_;var F=!1;k&&m.isHostMethod(k,"createControlRange")&&(k=k.createControlRange(),m.areHostProperties(k,["item","add"])&&(F=!0)),e.features.implementsControlRange=F,S=L?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var I;m.isHostMethod(x,"getRangeAt")?I=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:L&&(I=function(t){var n=v.getDocument(t.anchorNode),n=e.createRange(n);return n.setStart(t.anchorNode,t.anchorOffset),n.setEnd(t.focusNode,t.focusOffset),n.collapsed!==this.isCollapsed&&(n.setStart(t.focusNode,t.focusOffset),n.setEnd(t.anchorNode,t.anchorOffset)),n}),e.getSelection=function(e){var e=e||window,t=e._rangySelection,n=E(e),i=T?r(e):null;return t?(t.nativeSelection=n,t.docSelection=i,t.refresh(e)):(t=new c(n,i,e),e._rangySelection=t),t},e.getIframeSelection=function(t){return e.getSelection(v.getIframeWindow(t))},k=c.prototype;if(!N&&L&&m.areHostMethods(x,["removeAllRanges","addRange"])){k.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),s(this)};var q=function(t,n){var r=g.getRangeDocument(n),r=e.createRange(r);r.collapseToPoint(n.endContainer,n.endOffset),t.nativeSelection.addRange(o(r)),t.nativeSelection.extend(n.startContainer,n.startOffset),t.refresh()};k.addRange=O?function(t,n){if(F&&T&&"Control"==this.docSelection.type)l(this,t);else if(n&&A)q(this,t);else{var r;M?r=this.rangeCount:(this.removeAllRanges(),r=0),this.nativeSelection.addRange(o(t)),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==r+1?(e.config.checkSelectionRanges&&(r=I(this.nativeSelection,this.rangeCount-1))&&!g.rangesEqual(r,t)&&(t=new y(r)),this._ranges[this.rangeCount-1]=t,i(this,t,z(this.nativeSelection)),this.isCollapsed=S(this)):this.refresh()}}:function(e,t){t&&A?q(this,e):(this.nativeSelection.addRange(o(e)),this.refresh())},k.setRanges=function(e){if(F&&1<e.length)h(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;t<n;++t)this.addRange(e[t])}}}else{if(!(m.isHostMethod(x,"empty")&&m.isHostMethod(C,"select")&&F&&N))return t.fail("No means of selecting a Range or TextRange was found"),!1;k.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=v.getDocument(this.anchorNode);else if("Control"==this.docSelection.type){var t=this.docSelection.createRange();t.length&&(e=v.getDocument(t.item(0)).body.createTextRange())}e&&(e.body.createTextRange().select(),this.docSelection.empty())}}catch(n){}s(this)},k.addRange=function(e){"Control"==this.docSelection.type?l(this,e):(y.rangeToTextRange(e).select(),this._ranges[0]=e,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,i(this,e,!1))},k.setRanges=function(e){this.removeAllRanges();var t=e.length;1<t?h(this,e):t&&this.addRange(e[0])}}k.getRangeAt=function(e){if(0>e||e>=this.rangeCount)throw new b("INDEX_SIZE_ERR");return this._ranges[e]};var R;if(N)R=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=v.getBody(t.win.document).createTextRange(),n.collapse(!0)),"Control"==t.docSelection.type?f(t):n&&"undefined"!=typeof n.text?a(t,n):s(t)};else if(m.isHostMethod(x,"getRangeAt")&&"number"==typeof x.rangeCount)R=function(t){if(F&&T&&"Control"==t.docSelection.type)f(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var n=0,r=t.rangeCount;n<r;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));i(t,t._ranges[t.rangeCount-1],z(t.nativeSelection)),t.isCollapsed=S(t)}else s(t)};else{if(!L||"boolean"!=typeof x.isCollapsed||"boolean"!=typeof C.collapsed||!e.features.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;R=function(e){var t;t=e.nativeSelection,t.anchorNode?(t=I(t,0),e._ranges=[t],e.rangeCount=1,t=e.nativeSelection,e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset,e.isCollapsed=S(e)):s(e)}}k.refresh=function(e){var t=e?this._ranges.slice(0):null;R(this);if(e){e=t.length;if(e!=this._ranges.length)return!1;for(;e--;)if(!g.rangesEqual(t[e],this._ranges[e]))return!1;return!0}};var U=function(e,t){var n=e.getAllRanges(),r=!1;e.removeAllRanges();for(var i=0,o=n.length;i<o;++i)r||t!==n[i]?e.addRange(n[i]):r=!0;e.rangeCount||s(e)};k.removeRange=F?function(e){if("Control"==this.docSelection.type){for(var t=this.docSelection.createRange(),e=u(e),n=v.getDocument(t.item(0)),n=v.getBody(n).createControlRange(),r,i=!1,s=0,o=t.length;s<o;++s)r=t.item(s),r!==e||i?n.add(t.item(s)):i=!0;n.select(),f(this)}else U(this,e)}:function(e){U(this,e)};var z;!N&&L&&e.features.implementsDomRange?(z=function(e){var t=!1;return e.anchorNode&&(t=1==v.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t},k.isBackwards=function(){return z(this)}):z=k.isBackwards=function(){return!1},k.toString=function(){for(var e=[],t=0,n=this.rangeCount;t<n;++t)e[t]=""+this._ranges[t];return e.join("")},k.collapse=function(t,n){p(this,t);var r=e.createRange(v.getDocument(t));r.collapseToPoint(t,n),this.removeAllRanges(),this.addRange(r),this.isCollapsed=!0},k.collapseToStart=function(){if(!this.rangeCount)throw new b("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},k.collapseToEnd=function(){if(!this.rangeCount)throw new b("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},k.selectAllChildren=function(t){p(this,t);var n=e.createRange(v.getDocument(t));n.selectNodeContents(t),this.removeAllRanges(),this.addRange(n)},k.deleteFromDocument=function(){if(F&&T&&"Control"==this.docSelection.type){for(var e=this.docSelection.createRange(),t;e.length;)t=e.item(0),e.remove(t),t.parentNode.removeChild(t);this.refresh()}else if(this.rangeCount){e=this.getAllRanges(),this.removeAllRanges(),t=0;for(var n=e.length;t<n;++t)e[t].deleteContents();this.addRange(e[n-1])}},k.getAllRanges=function(){return this._ranges.slice(0)},k.setSingleRange=function(e){this.setRanges([e])},k.containsNode=function(e,t){for(var n=0,r=this._ranges.length;n<r;++n)if(this._ranges[n].containsNode(e,t))return!0;return!1},k.toHtml=function(){var e="";if(this.rangeCount){for(var e=g.getRangeDocument(this._ranges[0]).createElement("div"),t=0,n=this._ranges.length;t<n;++t)e.appendChild(this._ranges[t].cloneContents());e=e.innerHTML}return e},k.getName=function(){return"WrappedSelection"},k.inspect=function(){return d(this)},k.detach=function(){this.win=this.anchorNode=this.focusNode=this.win._rangySelection=null},c.inspect=d,e.Selection=c,e.selectionPrototype=k,e.addCreateMissingNativeApiListener(function(t){"undefined"==typeof t.getSelection&&(t.getSelection=function(){return e.getSelection(this)}),t=null})});var Base=function(){};Base.extend=function(e,t){var n=Base.prototype.extend;Base._prototyping=!0;var r=new this;n.call(r,e),r.base=function(){},delete Base._prototyping;var i=r.constructor,s=r.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==s)this._constructing=!0,i.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||n).call(arguments[0],r)};return s.ancestor=this,s.extend=this.extend,s.forEach=this.forEach,s.implement=this.implement,s.prototype=r,s.toString=this.toString,s.valueOf=function(e){return"object"==e?s:i.valueOf()},n.call(s,t),"function"==typeof s.init&&s.init(),s},Base.prototype={extend:function(e,t){if(1<arguments.length){var n=this[e];if(n&&"function"==typeof t&&(!n.valueOf||n.valueOf()!=t.valueOf())&&/\bbase\b/.test(t)){var r=t.valueOf(),t=function(){var e=this.base||Base.prototype.base;this.base=n;var t=r.apply(this,arguments);return this.base=e,t};t.valueOf=function(e){return"object"==e?t:r},t.toString=Base.toString}this[e]=t}else if(e){var i=Base.prototype.extend;!Base._prototyping&&"function"!=typeof this&&(i=this.extend||i);for(var s={toSource:null},o=["constructor","toString","valueOf"],u=Base._prototyping?0:1;a=o[u++];)e[a]!=s[a]&&i.call(this,a,e[a]);for(var a in e)s[a]||i.call(this,a,e[a])}return this}},Base=Base.extend({constructor:function(e){this.extend(e)}},{ancestor:Object,version:"1.1",forEach:function(e,t,n){for(var r in e)void 0===this.prototype[r]&&t.call(n,e[r],r,e)},implement:function(){for(var e=0;e<arguments.length;e++)"function"==typeof arguments[e]?arguments[e](this.prototype):this.prototype.extend(arguments[e]);return this},toString:function(){return String(this.valueOf())}}),wysihtml5.browser=function(){var e=navigator.userAgent,t=document.createElement("div"),n=-1!==e.indexOf("MSIE")&&-1===e.indexOf("Opera"),r=-1!==e.indexOf("Gecko")&&-1===e.indexOf("KHTML"),i=-1!==e.indexOf("AppleWebKit/"),s=-1!==e.indexOf("Chrome/"),o=-1!==e.indexOf("Opera/"),u={formatBlock:n,insertUnorderedList:n||i,insertOrderedList:n||i},a={insertHTML:r};return{USER_AGENT:e,supported:function(){var e=this.USER_AGENT.toLowerCase(),n="contentEditable"in t,r=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,i=document.querySelector&&document.querySelectorAll,e=this.isIos()&&5>+(/ipad|iphone|ipod/.test(e)&&e.match(/ os (\d+).+? like mac os x/)||[,0])[1]||this.isAndroid()&&4>+(e.match(/android (\d+)/)||[,0])[1]||-1!==e.indexOf("opera mobi")||-1!==e.indexOf("hpwos/");return n&&r&&i&&!e},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){return/ipad|iphone|ipod/i.test(this.USER_AGENT)},isAndroid:function(){return-1!==this.USER_AGENT.indexOf("Android")},supportsSandboxedIframes:function(){return n},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return!("querySelector"in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return n},hasCurrentStyleProperty:function(){return"currentStyle"in t},hasHistoryIssue:function(){return r},insertsLineBreaksOnReturn:function(){return r},supportsPlaceholderAttributeOn:function(e){return"placeholder"in e},supportsEvent:function(e){var n;return(n="on"+e in t)||(t.setAttribute("on"+e,"return;"),n="function"==typeof t["on"+e]),n},supportsEventsInIframeCorrectly:function(){return!o},supportsHTML5Tags:function(e){return e=e.createElement("div"),e.innerHTML="<article>foo</article>","<article>foo</article>"===e.innerHTML.toLowerCase()},supportsCommand:function(e,t){if(!u[t]){try{return e.queryCommandSupported(t)}catch(n){}try{return e.queryCommandEnabled(t)}catch(r){return!!a[t]}}return!1},doesAutoLinkingInContentEditable:function(){return n},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return r||o||i},supportsGetAttributeCorrectly:function(){return"1"!=document.createElement("td").getAttribute("rowspan")},canSelectImagesInContentEditable:function(){return r||n||o},autoScrollsToCaret:function(){return!i},autoClosesUnclosedTags:function(){var e=t.cloneNode(!1),n;return e.innerHTML="<p><div></div>",e=e.innerHTML.toLowerCase(),n="<p></p><div></div>"===e||"<p><div></div></p>"===e,this.autoClosesUnclosedTags=function(){return n},n},supportsNativeGetElementsByClassName:function(){return-1!==String(document.getElementsByClassName).indexOf("[native code]")},supportsSelectionModify:function(){return"getSelection"in window&&"modify"in window.getSelection()},needsSpaceAfterLineBreak:function(){return o},supportsSpeechApiOn:function(t){return 11<=(e.match(/Chrome\/(\d+)/)||[,0])[1]&&("onwebkitspeechchange"in t||"speech"in t)},crashesWhenDefineProperty:function(e){return n&&("XMLHttpRequest"===e||"XDomainRequest"===e)},doesAsyncFocus:function(){return n},hasProblemsSettingCaretAfterImg:function(){return n},hasUndoInContextMenu:function(){return r||s||o},hasInsertNodeIssue:function(){return o},hasIframeFocusIssue:function(){return n}}}(),wysihtml5.lang.array=function(e){return{contains:function(t){if(e.indexOf)return-1!==e.indexOf(t);for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return!0;return!1},without:function(t){for(var t=wysihtml5.lang.array(t),n=[],r=0,i=e.length;r<i;r++)t.contains(e[r])||n.push(e[r]);return n},get:function(){for(var t=0,n=e.length,r=[];t<n;t++)r.push(e[t]);return r}}},wysihtml5.lang.Dispatcher=Base.extend({on:function(e,t){return this.events=this.events||{},this.events[e]=this.events[e]||[],this.events[e].push(t),this},off:function(e,t){this.events=this.events||{};var n=0,r,i;if(e){r=this.events[e]||[];for(i=[];n<r.length;n++)r[n]!==t&&t&&i.push(r[n]);this.events[e]=i}else this.events={};return this},fire:function(e,t){this.events=this.events||{};for(var n=this.events[e]||[],r=0;r<n.length;r++)n[r].call(this,t);return this},observe:function(){return this.on.apply(this,arguments)},stopObserving:function(){return this.off.apply(this,arguments)}}),wysihtml5.lang.object=function(e){return{merge:function(t){for(var n in t)e[n]=t[n];return this},get:function(){return e},clone:function(){var t={},n;for(n in e)t[n]=e[n];return t},isArray:function(){return"[object Array]"===Object.prototype.toString.call(e)}}},function(){var e=/^\s+/,t=/\s+$/;wysihtml5.lang.string=function(n){return n=String(n),{trim:function(){return n.replace(e,"").replace(t,"")},interpolate:function(e){for(var t in e)n=this.replace("#{"+t+"}").by(e[t]);return n},replace:function(e){return{by:function(t){return n.split(e).join(t)}}}}}}(),function(e){function t(u){if(!n.contains(u.nodeName)){if(u.nodeType!==e.TEXT_NODE||!u.data.match(r)){l=e.lang.array(u.childNodes).get(),p=l.length;for(v=0;v<p;v++)t(l[v]);return u}var l=u.parentNode,p;p=l.ownerDocument;var v=p._wysihtml5_tempElement;v||(v=p._wysihtml5_tempElement=p.createElement("div")),p=v,p.innerHTML="<span></span>"+u.data.replace(r,function(e,t){var n=(t.match(i)||[])[1]||"",r=o[n],t=t.replace(i,"");t.split(r).length>t.split(n).length&&(t+=n,n="");var u=r=t;return t.length>s&&(u=u.substr(0,s)+"..."),"www."===r.substr(0,4)&&(r="http://"+r),'<a href="'+r+'">'+u+"</a>"+n});for(p.removeChild(p.firstChild);p.firstChild;)l.insertBefore(p.firstChild,u);l.removeChild(u)}}var n=e.lang.array("CODE PRE A SCRIPT HEAD TITLE STYLE".split(" ")),r=/((https?:\/\/|www\.)[^\s<]{3,})/gi,i=/([^\w\/\-](,?))$/i,s=100,o={")":"(","]":"[","}":"{"};e.dom.autoLink=function(e){var r;e:{r=e;for(var i;r.parentNode;){r=r.parentNode,i=r.nodeName;if(n.contains(i)){r=!0;break e}if("body"===i)break}r=!1}return r?e:(e===e.ownerDocument.documentElement&&(e=e.ownerDocument.body),t(e))},e.dom.autoLink.URL_REG_EXP=r}(wysihtml5),function(e){var t=e.dom;t.addClass=function(e,n){var r=e.classList;if(r)return r.add(n);t.hasClass(e,n)||(e.className+=" "+n)},t.removeClass=function(e,t){var n=e.classList;if(n)return n.remove(t);e.className=e.className.replace(RegExp("(^|\\s+)"+t+"(\\s+|$)")," ")},t.hasClass=function(e,t){var n=e.classList;return n?n.contains(t):(n=e.className,0<n.length&&(n==t||RegExp("(^|\\s)"+t+"(\\s|$)").test(n)))}}(wysihtml5),wysihtml5.dom.contains=function(){var e=document.documentElement;if(e.contains)return function(e,t){return t.nodeType!==wysihtml5.ELEMENT_NODE&&(t=t.parentNode),e!==t&&e.contains(t)};if(e.compareDocumentPosition)return function(e,t){return!!(e.compareDocumentPosition(t)&16)}}(),wysihtml5.dom.convertToList=function(){function e(e,t){var n=e.createElement("li");return t.appendChild(n),n}return function(t,n){if("UL"===t.nodeName||"OL"===t.nodeName||"MENU"===t.nodeName)return t;var r=t.ownerDocument,i=r.createElement(n),s=t.querySelectorAll("br"),o=s.length,u,a,f,l,c;for(c=0;c<o;c++)for(u=s[c];(a=u.parentNode)&&a!==t&&a.lastChild===u;){if("block"===wysihtml5.dom.getStyle("display").from(a)){a.removeChild(u);break}wysihtml5.dom.insert(u).after(u.parentNode)}s=wysihtml5.lang.array(t.childNodes).get(),o=s.length;for(c=0;c<o;c++)l=l||e(r,i),u=s[c],a="block"===wysihtml5.dom.getStyle("display").from(u),f="BR"===u.nodeName,a?(l=l.firstChild?e(r,i):l,l.appendChild(u),l=null):f?l=l.firstChild?null:l:l.appendChild(u);return 0===s.length&&e(r,i),t.parentNode.replaceChild(i,t),i}}(),wysihtml5.dom.copyAttributes=function(e){return{from:function(t){return{to:function(n){for(var r,i=0,s=e.length;i<s;i++)r=e[i],"undefined"!=typeof t[r]&&""!==t[r]&&(n[r]=t[r]);return{andTo:arguments.callee}}}}}},function(e){var t=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"];e.copyStyles=function(n){return{from:function(r){var i;e:{i=0;for(var s=t.length;i<s;i++)if("border-box"===e.getStyle(t[i]).from(r)){i=t[i];break e}i=void 0}i=i?parseInt(e.getStyle("width").from(r),10)<r.offsetWidth:!1,i&&(n=wysihtml5.lang.array(n).without(t));var o="";i=n.length;for(var s=0,u;s<i;s++)u=n[s],o+=u+":"+e.getStyle(u).from(r)+";";return{to:function(t){return e.setStyles(o).on(t),{andTo:arguments.callee}}}}}}}(wysihtml5.dom),function(e){e.dom.delegate=function(t,n,r,i){return e.dom.observe(t,r,function(r){for(var s=r.target,o=e.lang.array(t.querySelectorAll(n));s&&s!==t;){if(o.contains(s)){i.call(s,r);break}s=s.parentNode}})}}(wysihtml5),wysihtml5.dom.getAsDom=function(){var e="abbr article aside audio bdi canvas command datalist details figcaption figure footer header hgroup keygen mark meter nav output progress rp rt ruby svg section source summary time track video wbr".split(" ");return function(t,n){var n=n||document,r;if("object"==typeof t&&t.nodeType)r=n.createElement("div"),r.appendChild(t);else if(wysihtml5.browser.supportsHTML5Tags(n))r=n.createElement("div"),r.innerHTML=t;else{r=n;if(!r._wysihtml5_supportsHTML5Tags){for(var i=0,s=e.length;i<s;i++)r.createElement(e[i]);r._wysihtml5_supportsHTML5Tags=!0}r=n,i=r.createElement("div"),i.style.display="none",r.body.appendChild(i);try{i.innerHTML=t}catch(o){}r.body.removeChild(i),r=i}return r}}(),wysihtml5.dom.getParentElement=function(){function e(e,t){return!t||!t.length?!0:"string"==typeof t?e===t:wysihtml5.lang.array(t).contains(e)}return function(t,n,r){r=r||50;if(n.className||n.classRegExp){e:{for(var i=n.nodeName,s=n.className,n=n.classRegExp;r--&&t&&"BODY"!==t.nodeName;){var o;if(o=t.nodeType===wysihtml5.ELEMENT_NODE)if(o=e(t.nodeName,i)){o=s;var u=(t.className||"").match(n)||[];o=o?u[u.length-1]===o:!!u.length}if(o)break e;t=t.parentNode}t=null}return t}e:{i=n.nodeName;for(s=r;s--&&t&&"BODY"!==t.nodeName;){if(e(t.nodeName,i))break e;t=t.parentNode}t=null}return t}}(),wysihtml5.dom.getStyle=function(){var e={"float":"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},t=/\-[a-z]/g;return function(n){return{from:function(r){if(r.nodeType===wysihtml5.ELEMENT_NODE){var i=r.ownerDocument,s=e[n]||n.replace(t,function(e){return e.charAt(1).toUpperCase()}),o=r.style,u=r.currentStyle,f=o[s];if(f)return f;if(u)try{return u[s]}catch(l){}var s=i.defaultView||i.parentWindow,i=("height"===n||"width"===n)&&"TEXTAREA"===r.nodeName,h;if(s.getComputedStyle)return i&&(h=o.overflow,o.overflow="hidden"),r=s.getComputedStyle(r,null).getPropertyValue(n),i&&(o.overflow=h||""),r}}}}}(),wysihtml5.dom.hasElementWithTagName=function(){var e={},t=1;return function(n,r){var i=(n._wysihtml5_identifier||(n._wysihtml5_identifier=t++))+":"+r,s=e[i];return s||(s=e[i]=n.getElementsByTagName(r)),0<s.length}}(),function(e){var t={},n=1;e.dom.hasElementWithClassName=function(r,i){if(!e.browser.supportsNativeGetElementsByClassName())return!!r.querySelector("."+i);var s=(r._wysihtml5_identifier||(r._wysihtml5_identifier=n++))+":"+i,o=t[s];return o||(o=t[s]=r.getElementsByClassName(i)),0<o.length}}(wysihtml5),wysihtml5.dom.insert=function(e){return{after:function(t){t.parentNode.insertBefore(e,t.nextSibling)},before:function(t){t.parentNode.insertBefore(e,t)},into:function(t){t.appendChild(e)}}},wysihtml5.dom.insertCSS=function(e){return e=e.join("\n"),{into:function(t){var n=t.createElement("style");n.type="text/css",n.styleSheet?n.styleSheet.cssText=e:n.appendChild(t.createTextNode(e));var r=t.querySelector("head link");r?r.parentNode.insertBefore(n,r):(t=t.querySelector("head"))&&t.appendChild(n)}}},wysihtml5.dom.observe=function(e,t,n){for(var t="string"==typeof t?[t]:t,r,i,s=0,o=t.length;s<o;s++)i=t[s],e.addEventListener?e.addEventListener(i,n,!1):(r=function(t){"target"in t||(t.target=t.srcElement),t.preventDefault=t.preventDefault||function(){this.returnValue=!1},t.stopPropagation=t.stopPropagation||function(){this.cancelBubble=!0},n.call(e,t)},e.attachEvent("on"+i,r));return{stop:function(){for(var i,s=0,o=t.length;s<o;s++)i=t[s],e.removeEventListener?e.removeEventListener(i,n,!1):e.detachEvent("on"+i,r)}}},wysihtml5.dom.parse=function(){function e(t,i){var s=t.childNodes,o=s.length,u=n[t.nodeType],a=0,f,u=u&&u(t);if(!u)return null;for(a=0;a<o;a++)(f=e(s[a],i))&&u.appendChild(f);return i&&1>=u.childNodes.length&&u.nodeName.toLowerCase()===r&&!u.attributes.length?u.firstChild:u}function t(e,t){var t=t.toLowerCase(),n;if(n="IMG"==e.nodeName)if(n="src"==t){var r;e:{try{r=e.complete&&!e.mozMatchesSelector(":-moz-broken");break e}catch(i){if(e.complete&&"complete"===e.readyState){r=!0;break e}}r=void 0}n=!0===r}return n?e.src:u&&"outerHTML"in e?-1!=e.outerHTML.toLowerCase().indexOf(" "+t+"=")?e.getAttribute(t):null:e.getAttribute(t)}var n={1:function(e){var n,s,u=o.tags;s=e.nodeName.toLowerCase(),n=e.scopeName;if(e._wysihtml5)return null;e._wysihtml5=1;if("wysihtml5-temp"===e.className)return null;n&&"HTML"!=n&&(s=n+":"+s),"outerHTML"in e&&!wysihtml5.browser.autoClosesUnclosedTags()&&"P"===e.nodeName&&"</p>"!==e.outerHTML.slice(-4).toLowerCase()&&(s="div");if(s in u){n=u[s];if(!n||n.remove)return null;n="string"==typeof n?{rename_tag:n}:n}else{if(!e.firstChild)return null;n={rename_tag:r}}s=e.ownerDocument.createElement(n.rename_tag||s);var u={},a=n.set_class,f=n.add_class,l=n.set_attributes,c=n.check_attributes,h=o.classes,d=0,v=[];n=[];var m=[],g=[],b;l&&(u=wysihtml5.lang.object(l).clone());if(c)for(b in c)if(l=p[c[b]])l=l(t(e,b)),"string"==typeof l&&(u[b]=l);a&&v.push(a);if(f)for(b in f)if(l=y[f[b]])a=l(t(e,b)),"string"==typeof a&&v.push(a);h["_wysihtml5-temp-placeholder"]=1,(g=e.getAttribute("class"))&&(v=v.concat(g.split(i)));for(f=v.length;d<f;d++)e=v[d],h[e]&&n.push(e);for(h=n.length;h--;)e=n[h],wysihtml5.lang.array(m).contains(e)||m.unshift(e);m.length&&(u["class"]=m.join(" "));for(b in u)try{s.setAttribute(b,u[b])}catch(w){}return u.src&&("undefined"!=typeof u.width&&s.setAttribute("width",u.width),"undefined"!=typeof u.height&&s.setAttribute("height",u.height)),s},3:function(e){return e.ownerDocument.createTextNode(e.data)}},r="span",i=/\s+/,s={tags:{},classes:{}},o={},u=!wysihtml5.browser.supportsGetAttributeCorrectly(),a=/^https?:\/\//i,f=/^(\/|https?:\/\/)/i,l=/^(\/|https?:\/\/|mailto:)/i,c=/[^ a-z0-9_\-]/gi,h=/\D/g,p={url:function(e){return!e||!e.match(a)?null:e.replace(a,function(e){return e.toLowerCase()})},src:function(e){return!e||!e.match(f)?null:e.replace(f,function(e){return e.toLowerCase()})},href:function(e){return!e||!e.match(l)?null:e.replace(l,function(e){return e.toLowerCase()})},alt:function(e){return e?e.replace(c,""):""},numbers:function(e){return(e=(e||"").replace(h,""))||null}},d={left:"wysiwyg-float-left",right:"wysiwyg-float-right"},v={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"},m={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"},g={1:"wysiwyg-font-size-xx-small",2:"wysiwyg-font-size-small",3:"wysiwyg-font-size-medium",4:"wysiwyg-font-size-large",5:"wysiwyg-font-size-x-large",6:"wysiwyg-font-size-xx-large",7:"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"},y={align_img:function(e){return d[String(e).toLowerCase()]},align_text:function(e){return v[String(e).toLowerCase()]},clear_br:function(e){return m[String(e).toLowerCase()]},size_font:function(e){return g[String(e).charAt(0)]}};return function(t,n,r,i){wysihtml5.lang.object(o).merge(s).merge(n).get();for(var r=r||t.ownerDocument||document,n=r.createDocumentFragment(),u="string"==typeof t,t=u?wysihtml5.dom.getAsDom(t,r):t;t.firstChild;)r=t.firstChild,t.removeChild(r),(r=e(r,i))&&n.appendChild(r);return t.innerHTML="",t.appendChild(n),u?wysihtml5.quirks.getCorrectInnerHTML(t):t}}(),wysihtml5.dom.removeEmptyTextNodes=function(e){for(var t=wysihtml5.lang.array(e.childNodes).get(),n=t.length,r=0;r<n;r++)e=t[r],e.nodeType===wysihtml5.TEXT_NODE&&""===e.data&&e.parentNode.removeChild(e)},wysihtml5.dom.renameElement=function(e,t){for(var n=e.ownerDocument.createElement(t),r;r=e.firstChild;)n.appendChild(r);return wysihtml5.dom.copyAttributes(["align","className"]).from(e).to(n),e.parentNode.replaceChild(n,e),n},wysihtml5.dom.replaceWithChildNodes=function(e){if(e.parentNode)if(e.firstChild){for(var t=e.ownerDocument.createDocumentFragment();e.firstChild;)t.appendChild(e.firstChild);e.parentNode.replaceChild(t,e)}else e.parentNode.removeChild(e)},function(e){function t(e){var t=e.ownerDocument.createElement("br");e.appendChild(t)}e.resolveList=function(n,r){if(n.nodeName.match(/^(MENU|UL|OL)$/)){var i=n.ownerDocument,s=i.createDocumentFragment(),o=n.previousElementSibling||n.previousSibling,u,a;if(r)for(o&&"block"!==e.getStyle("display").from(o)&&t(s);a=n.firstElementChild||n.firstChild;){for(i=a.lastChild;o=a.firstChild;)u=(u=o===i)&&"block"!==e.getStyle("display").from(o)&&"BR"!==o.nodeName,s.appendChild(o),u&&t(s);a.parentNode.removeChild(a)}else for(;a=n.firstElementChild||n.firstChild;){if(a.querySelector&&a.querySelector("div, p, ul, ol, menu, blockquote, h1, h2, h3, h4, h5, h6"))for(;o=a.firstChild;)s.appendChild(o);else{for(u=i.createElement("p");o=a.firstChild;)u.appendChild(o);s.appendChild(u)}a.parentNode.removeChild(a)}n.parentNode.replaceChild(s,n)}}}(wysihtml5.dom),function(e){var t=document,n="parent top opener frameElement frames localStorage globalStorage sessionStorage indexedDB".split(" "),r="open close openDialog showModalDialog alert confirm prompt openDatabase postMessage XMLHttpRequest XDomainRequest".split(" "),i=["referrer","write","open","close"];e.dom.Sandbox=Base.extend({constructor:function(t,n){this.callback=t||e.EMPTY_FUNCTION,this.config=e.lang.object({}).merge(n).get(),this.iframe=this._createIframe()},insertInto:function(e){"string"==typeof e&&(e=t.getElementById(e)),e.appendChild(this.iframe)},getIframe:function(){return this.iframe},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var e=this.getIframe();e.parentNode.removeChild(e)},_readyError:function(){throw Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet")},_createIframe:function(){var n=this,r=t.createElement("iframe");return r.className="wysihtml5-sandbox",e.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(r),e.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(r.src="javascript:'<html></html>'"),r.onload=function(){r.onreadystatechange=r.onload=null,n._onLoadIframe(r)},r.onreadystatechange=function(){/loaded|complete/.test(r.readyState)&&(r.onreadystatechange=r.onload=null,n._onLoadIframe(r))},r},_onLoadIframe:function(s){if(e.dom.contains(t.documentElement,s)){var o=this,u=s.contentWindow,f=s.contentWindow.document,l=this._getHtml({charset:t.characterSet||t.charset||"utf-8",stylesheets:this.config.stylesheets});f.open("text/html","replace"),f.write(l),f.close(),this.getWindow=function(){return s.contentWindow},this.getDocument=function(){return s.contentWindow.document},u.onerror=function(e,t,n){throw Error("wysihtml5.Sandbox: "+e,t,n)};if(!e.browser.supportsSandboxedIframes()){var h,l=0;for(h=n.length;l<h;l++)this._unset(u,n[l]);l=0;for(h=r.length;l<h;l++)this._unset(u,r[l],e.EMPTY_FUNCTION);l=0;for(h=i.length;l<h;l++)this._unset(f,i[l]);this._unset(f,"cookie","",!0)}this.loaded=!0,setTimeout(function(){o.callback(o)},0)}},_getHtml:function(t){var n=t.stylesheets,r="",i=0,s;if(n="string"==typeof n?[n]:n)for(s=n.length;i<s;i++)r+='<link rel="stylesheet" href="'+n[i]+'">';return t.stylesheets=r,e.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(t)},_unset:function(t,n,r,i){try{t[n]=r}catch(s){}try{t.__defineGetter__(n,function(){return r})}catch(o){}if(i)try{t.__defineSetter__(n,function(){})}catch(u){}if(!e.browser.crashesWhenDefineProperty(n))try{var a={get:function(){return r}};i&&(a.set=function(){}),Object.defineProperty(t,n,a)}catch(f){}}})}(wysihtml5),function(){var e={className:"class"};wysihtml5.dom.setAttributes=function(t){return{on:function(n){for(var r in t)n.setAttribute(e[r]||r,t[r])}}}}(),wysihtml5.dom.setStyles=function(e){return{on:function(t){t=t.style;if("string"==typeof e)t.cssText+=";"+e;else for(var n in e)"float"===n?(t.cssFloat=e[n],t.styleFloat=e[n]):t[n]=e[n]}}},function(e){e.simulatePlaceholder=function(t,n,r){var i=function(){n.hasPlaceholderSet()&&n.clear(),n.placeholderSet=!1,e.removeClass(n.element,"placeholder")},s=function(){n.isEmpty()&&(n.placeholderSet=!0,n.setValue(r),e.addClass(n.element,"placeholder"))};t.on("set_placeholder",s).on("unset_placeholder",i).on("focus:composer",i).on("paste:composer",i).on("blur:composer",s),s()}}(wysihtml5.dom),function(e){var t=document.documentElement;"textContent"in t?(e.setTextContent=function(e,t){e.textContent=t},e.getTextContent=function(e){return e.textContent}):"innerText"in t?(e.setTextContent=function(e,t){e.innerText=t},e.getTextContent=function(e){return e.innerText}):(e.setTextContent=function(e,t){e.nodeValue=t},e.getTextContent=function(e){return e.nodeValue})}(wysihtml5.dom),wysihtml5.quirks.cleanPastedHTML=function(){var e={"a u":wysihtml5.dom.replaceWithChildNodes};return function(t,n,r){var n=n||e,r=r||t.ownerDocument||document,i="string"==typeof t,s,o,u,a=0,t=i?wysihtml5.dom.getAsDom(t,r):t;for(u in n){s=t.querySelectorAll(u),r=n[u];for(o=s.length;a<o;a++)r(s[a])}return i?t.innerHTML:t}}(),wysihtml5.quirks.ensureProperClearing=function(){var e=function(){var e=this;setTimeout(function(){var t=e.innerHTML.toLowerCase();if("<p>&nbsp;</p>"==t||"<p>&nbsp;</p><p>&nbsp;</p>"==t)e.innerHTML=""},0)};return function(t){wysihtml5.dom.observe(t.element,["cut","keydown"],e)}}(),function(e){e.quirks.getCorrectInnerHTML=function(t){var n=t.innerHTML;if(-1===n.indexOf("%7E"))return n;var t=t.querySelectorAll("[href*='~'], [src*='~']"),r,i,s,o;o=0;for(s=t.length;o<s;o++)r=t[o].href||t[o].src,i=e.lang.string(r).replace("~").by("%7E"),n=e.lang.string(n).replace(i).by(r);return n}}(wysihtml5),function(e){e.quirks.redraw=function(t){e.dom.addClass(t,"wysihtml5-quirks-redraw"),e.dom.removeClass(t,"wysihtml5-quirks-redraw");try{var n=t.ownerDocument;n.execCommand("italic",!1,null),n.execCommand("italic",!1,null)}catch(r){}}}(wysihtml5),function(e){var t=e.dom;e.Selection=Base.extend({constructor:function(e){window.rangy.init(),this.editor=e,this.composer=e.composer,this.doc=this.composer.doc},getBookmark:function(){var e=this.getRange();return e&&e.cloneRange()},setBookmark:function(e){e&&this.setSelection(e)},setBefore:function(e){var t=rangy.createRange(this.doc);return t.setStartBefore(e),t.setEndBefore(e),this.setSelection(t)},setAfter:function(e){var t=rangy.createRange(this.doc);return t.setStartAfter(e),t.setEndAfter(e),this.setSelection(t)},selectNode:function(n,r){var i=rangy.createRange(this.doc),s=n.nodeType===e.ELEMENT_NODE,o="canHaveHTML"in n?n.canHaveHTML:"IMG"!==n.nodeName,u=s?n.innerHTML:n.data,u=""===u||u===e.INVISIBLE_SPACE,a=t.getStyle("display").from(n),a="block"===a||"list-item"===a;if(u&&s&&o&&!r)try{n.innerHTML=e.INVISIBLE_SPACE}catch(f){}o?i.selectNodeContents(n):i.selectNode(n),o&&u&&s?i.collapse(a):o&&u&&(i.setStartAfter(n),i.setEndAfter(n)),this.setSelection(i)},getSelectedNode:function(e){return e&&this.doc.selection&&"Control"===this.doc.selection.type&&(e=this.doc.selection.createRange())&&e.length?e.item(0):(e=this.getSelection(this.doc),e.focusNode===e.anchorNode?e.focusNode:(e=this.getRange(this.doc))?e.commonAncestorContainer:this.doc.body)},executeAndRestore:function(n,r){var i=this.doc.body,s=r&&i.scrollTop,o=r&&i.scrollLeft,u='<span class="_wysihtml5-temp-placeholder">'+e.INVISIBLE_SPACE+"</span>",a=this.getRange(this.doc),f;if(a){e.browser.hasInsertNodeIssue()?this.doc.execCommand("insertHTML",!1,u):(u=a.createContextualFragment(u),a.insertNode(u));try{n(a.startContainer,a.endContainer)}catch(l){setTimeout(function(){throw l},0)}(a=this.doc.querySelector("._wysihtml5-temp-placeholder"))?(u=rangy.createRange(this.doc),f=a.nextSibling,e.browser.hasInsertNodeIssue()&&f&&"BR"===f.nodeName?(f=this.doc.createTextNode(e.INVISIBLE_SPACE),t.insert(f).after(a),u.setStartBefore(f),u.setEndBefore(f)):(u.selectNode(a),u.deleteContents()),this.setSelection(u)):i.focus(),r&&(i.scrollTop=s,i.scrollLeft=o);try{a.parentNode.removeChild(a)}catch(h){}}else n(i,i)},executeAndRestoreSimple:function(e){var t,n,r=this.getRange(),i=this.doc.body,s;if(r){t=r.getNodes([3]),i=t[0]||r.startContainer,s=t[t.length-1]||r.endContainer,t=i===r.startContainer?r.startOffset:0,n=s===r.endContainer?r.endOffset:s.length;try{e(r.startContainer,r.endContainer)}catch(o){setTimeout(function(){throw o},0)}e=rangy.createRange(this.doc);try{e.setStart(i,t)}catch(u){}try{e.setEnd(s,n)}catch(a){}try{this.setSelection(e)}catch(f){}}else e(i,i)},set:function(e,t){var n=rangy.createRange(this.doc);n.setStart(e,t||0),this.setSelection(n)},insertHTML:function(e){var e=rangy.createRange(this.doc).createContextualFragment(e),t=e.lastChild;this.insertNode(e),t&&this.setAfter(t)},insertNode:function(e){var t=this.getRange();t&&t.insertNode(e)},surround:function(e){var t=this.getRange();if(t)try{t.surroundContents(e),this.selectNode(e)}catch(n){e.appendChild(t.extractContents()),t.insertNode(e)}},scrollIntoView:function(){var t=this.doc,n=t.documentElement.scrollHeight>t.documentElement.offsetHeight,r;(r=t._wysihtml5ScrollIntoViewElement)||(r=t.createElement("span"),r.innerHTML=e.INVISIBLE_SPACE),r=t._wysihtml5ScrollIntoViewElement=r;if(n){this.insertNode(r);var n=r,i=0;if(n.parentNode)do i+=n.offsetTop||0,n=n.offsetParent;while(n);n=i,r.parentNode.removeChild(r),n>=t.body.scrollTop+t.documentElement.offsetHeight-5&&(t.body.scrollTop=n)}},selectLine:function(){e.browser.supportsSelectionModify()?this._selectLine_W3C():this.doc.selection&&this._selectLine_MSIE()},_selectLine_W3C:function(){var e=this.doc.defaultView.getSelection();e.modify("extend","left","lineboundary"),e.modify("extend","right","lineboundary")},_selectLine_MSIE:function(){var e=this.doc.selection.createRange(),t=e.boundingTop,n=this.doc.body.scrollWidth,r;if(e.moveToPoint){0===t&&(r=this.doc.createElement("span"),this.insertNode(r),t=r.offsetTop,r.parentNode.removeChild(r)),t+=1;for(r=-10;r<n;r+=2)try{e.moveToPoint(r,t);break}catch(i){}for(r=this.doc.selection.createRange();0<=n;n--)try{r.moveToPoint(n,t);break}catch(s){}e.setEndPoint("EndToEnd",r),e.select()}},getText:function(){var e=this.getSelection();return e?e.toString():""},getNodes:function(e,t){var n=this.getRange();return n?n.getNodes([e],t):[]},getRange:function(){var e=this.getSelection();return e&&e.rangeCount&&e.getRangeAt(0)},getSelection:function(){return rangy.getSelection(this.doc.defaultView||this.doc.parentWindow)},setSelection:function(e){return rangy.getSelection(this.doc.defaultView||this.doc.parentWindow).setSingleRange(e)}})}(wysihtml5),function(e,t){function n(e,n){return t.dom.isCharacterDataNode(e)?0==n?!!e.previousSibling:n==e.length?!!e.nextSibling:!0:0<n&&n<e.childNodes.length}function r(e,n,i){var s;t.dom.isCharacterDataNode(n)&&(0==i?(i=t.dom.getNodeIndex(n),n=n.parentNode):i==n.length?(i=t.dom.getNodeIndex(n)+1,n=n.parentNode):s=t.dom.splitDataNode(n,i));if(!s){s=n.cloneNode(!1),s.id&&s.removeAttribute("id");for(var o;o=n.childNodes[i];)s.appendChild(o);t.dom.insertAfter(s,n)}return n==e?s:r(e,s.parentNode,t.dom.getNodeIndex(s))}function i(t){this.firstTextNode=(this.isElementMerge=t.nodeType==e.ELEMENT_NODE)?t.lastChild:t,this.textNodes=[this.firstTextNode]}function s(e,t,n,r){this.tagNames=e||[o],this.cssClass=t||"",this.similarClassRegExp=n,this.normalize=r,this.applyToAnyTagName=!1}var o="span",u=/\s+/g;i.prototype={doMerge:function(){for(var e=[],t,n,r=0,i=this.textNodes.length;r<i;++r)t=this.textNodes[r],n=t.parentNode,e[r]=t.data,r&&(n.removeChild(t),n.hasChildNodes()||n.parentNode.removeChild(n));return this.firstTextNode.data=e=e.join("")},getLength:function(){for(var e=this.textNodes.length,t=0;e--;)t+=this.textNodes[e].length;return t},toString:function(){for(var e=[],t=0,n=this.textNodes.length;t<n;++t)e[t]="'"+this.textNodes[t].data+"'";return"[Merge("+e.join(",")+")]"}},s.prototype={getAncestorWithClass:function(n){for(var r;n;){if(this.cssClass)if(r=this.cssClass,n.className){var i=n.className.match(this.similarClassRegExp)||[];r=i[i.length-1]===r}else r=!1;else r=!0;if(n.nodeType==e.ELEMENT_NODE&&t.dom.arrayContains(this.tagNames,n.tagName.toLowerCase())&&r)return n;n=n.parentNode}return!1},postApply:function(e,t){for(var n=e[0],r=e[e.length-1],s=[],o,u=n,a=r,f=0,l=r.length,c,h,p=0,d=e.length;p<d;++p)c=e[p],(h=this.getAdjacentMergeableTextNode(c.parentNode,!1))?(o||(o=new i(h),s.push(o)),o.textNodes.push(c),c===n&&(u=o.firstTextNode,f=u.length),c===r&&(a=o.firstTextNode,l=o.getLength())):o=null;if(n=this.getAdjacentMergeableTextNode(r.parentNode,!0))o||(o=new i(r),s.push(o)),o.textNodes.push(n);if(s.length){p=0;for(d=s.length;p<d;++p)s[p].doMerge();t.setStart(u,f),t.setEnd(a,l)}},getAdjacentMergeableTextNode:function(t,n){var r=t.nodeType==e.TEXT_NODE,i=r?t.parentNode:t,s=n?"nextSibling":"previousSibling";if(r){if((r=t[s])&&r.nodeType==e.TEXT_NODE)return r}else if((r=i[s])&&this.areElementsMergeable(t,r))return r[n?"firstChild":"lastChild"];return null},areElementsMergeable:function(e,n){var r;if(r=t.dom.arrayContains(this.tagNames,(e.tagName||"").toLowerCase()))if(r=t.dom.arrayContains(this.tagNames,(n.tagName||"").toLowerCase()))if(r=e.className.replace(u," ")==n.className.replace(u," "))e:if(e.attributes.length!=n.attributes.length)r=!1;else{r=0;for(var i=e.attributes.length,s,o;r<i;++r)if(s=e.attributes[r],o=s.name,"class"!=o&&(o=n.attributes.getNamedItem(o),s.specified!=o.specified||s.specified&&s.nodeValue!==o.nodeValue)){r=!1;break e}r=!0}return r},createContainer:function(e){return e=e.createElement(this.tagNames[0]),this.cssClass&&(e.className=this.cssClass),e},applyToTextNode:function(e){var n=e.parentNode;1==n.childNodes.length&&t.dom.arrayContains(this.tagNames,n.tagName.toLowerCase())?this.cssClass&&(e=this.cssClass,n.className?(n.className&&(n.className=n.className.replace(this.similarClassRegExp,"")),n.className+=" "+e):n.className=e):(n=this.createContainer(t.dom.getDocument(e)),e.parentNode.insertBefore(n,e),n.appendChild(e))},isRemovable:function(n){return t.dom.arrayContains(this.tagNames,n.tagName.toLowerCase())&&e.lang.string(n.className).trim()==this.cssClass},undoToTextNode:function(e,t,i){t.containsNode(i)||(e=t.cloneRange(),e.selectNode(i),e.isPointInRange(t.endContainer,t.endOffset)&&n(t.endContainer,t.endOffset)&&(r(i,t.endContainer,t.endOffset),t.setEndAfter(i)),e.isPointInRange(t.startContainer,t.startOffset)&&n(t.startContainer,t.startOffset)&&(i=r(i,t.startContainer,t.startOffset))),this.similarClassRegExp&&i.className&&(i.className=i.className.replace(this.similarClassRegExp,""));if(this.isRemovable(i)){t=i;for(i=t.parentNode;t.firstChild;)i.insertBefore(t.firstChild,t);i.removeChild(t)}},applyToRange:function(t){var n=t.getNodes([e.TEXT_NODE]);if(!n.length)try{var r=this.createContainer(t.endContainer.ownerDocument);t.surroundContents(r),this.selectNode(t,r);return}catch(i){}t.splitBoundaries(),n=t.getNodes([e.TEXT_NODE]);if(n.length){for(var s=0,o=n.length;s<o;++s)r=n[s],this.getAncestorWithClass(r)||this.applyToTextNode(r);t.setStart(n[0],0),r=n[n.length-1],t.setEnd(r,r.length),this.normalize&&this.postApply(n,t)}},undoToRange:function(t){var n=t.getNodes([e.TEXT_NODE]),r,i;n.length?(t.splitBoundaries(),n=t.getNodes([e.TEXT_NODE])):(n=t.endContainer.ownerDocument.createTextNode(e.INVISIBLE_SPACE),t.insertNode(n),t.selectNode(n),n=[n]);for(var s=0,o=n.length;s<o;++s)r=n[s],(i=this.getAncestorWithClass(r))&&this.undoToTextNode(r,t,i);1==o?this.selectNode(t,n[0]):(t.setStart(n[0],0),r=n[n.length-1],t.setEnd(r,r.length),this.normalize&&this.postApply(n,t))},selectNode:function(t,n){var r=n.nodeType===e.ELEMENT_NODE,i="canHaveHTML"in n?n.canHaveHTML:!0,s=r?n.innerHTML:n.data;if((s=""===s||s===e.INVISIBLE_SPACE)&&r&&i)try{n.innerHTML=e.INVISIBLE_SPACE}catch(o){}t.selectNodeContents(n),s&&r?t.collapse(!1):s&&(t.setStartAfter(n),t.setEndAfter(n))},getTextSelectedByRange:function(e,t){var n=t.cloneRange();n.selectNodeContents(e);var r=n.intersection(t),r=r?r.toString():"";return n.detach(),r},isAppliedToRange:function(t){var n=[],r,i=t.getNodes([e.TEXT_NODE]);if(!i.length)return(r=this.getAncestorWithClass(t.startContainer))?[r]:!1;for(var s=0,o=i.length,u;s<o;++s){u=this.getTextSelectedByRange(i[s],t),r=this.getAncestorWithClass(i[s]);if(""!=u&&!r)return!1;n.push(r)}return n},toggleRange:function(e){this.isAppliedToRange(e)?this.undoToRange(e):this.applyToRange(e)}},e.selection.HTMLApplier=s}(wysihtml5,rangy),wysihtml5.Commands=Base.extend({constructor:function(e){this.editor=e,this.composer=e.composer,this.doc=this.composer.doc},support:function(e){return wysihtml5.browser.supportsCommand(this.doc,e)},exec:function(e,t){var n=wysihtml5.commands[e],r=wysihtml5.lang.array(arguments).get(),i=n&&n.exec,s=null;this.editor.fire("beforecommand:composer");if(i)r.unshift(this.composer),s=i.apply(n,r);else try{s=this.doc.execCommand(e,!1,t)}catch(o){}return this.editor.fire("aftercommand:composer"),s},state:function(e,t){var n=wysihtml5.commands[e],r=wysihtml5.lang.array(arguments).get(),i=n&&n.state;if(i)return r.unshift(this.composer),i.apply(n,r);try{return this.doc.queryCommandState(e)}catch(s){return!1}}}),wysihtml5.commands.bold={exec:function(e,t){return wysihtml5.commands.formatInline.exec(e,t,"b")},state:function(e,t){return wysihtml5.commands.formatInline.state(e,t,"b")}},function(e){var t=e.dom;e.commands.createLink={exec:function(n,r,i){var s=this.state(n,r);if(s)n.selection.executeAndRestore(function(){for(var e=s.length,n=0,r,i,o;n<e;n++)r=s[n],i=t.getParentElement(r,{nodeName:"code"}),o=t.getTextContent(r),o.match(t.autoLink.URL_REG_EXP)&&!i?t.renameElement(r,"code"):t.replaceWithChildNodes(r)});else{var r=i="object"==typeof i?i:{href:i},i=n.doc,o="_wysihtml5-temp-"+ +(new Date),u=0,a,f,l;e.commands.formatInline.exec(n,void 0,"A",o,/non-matching-class/g),a=i.querySelectorAll("A."+o);for(o=a.length;u<o;u++)for(l in f=a[u],f.removeAttribute("class"),r)f.setAttribute(l,r[l]);l=f,1===o&&(o=t.getTextContent(f),u=!!f.querySelector("*"),o=""===o||o===e.INVISIBLE_SPACE,!u&&o&&(t.setTextContent(f,r.text||f.href),r=i.createTextNode(" "),n.selection.setAfter(f),t.insert(r).after(f),l=r)),n.selection.setAfter(l)}},state:function(t,n){return e.commands.formatInline.state(t,n,"A")}}}(wysihtml5),function(e){var t=/wysiwyg-font-size-[0-9a-z\-]+/g;e.commands.fontSize={exec:function(n,r,i){return e.commands.formatInline.exec(n,r,"span","wysiwyg-font-size-"+i,t)},state:function(n,r,i){return e.commands.formatInline.state(n,r,"span","wysiwyg-font-size-"+i,t)},value:function(){}}}(wysihtml5),function(e){var t=/wysiwyg-color-[0-9a-z]+/g;e.commands.foreColor={exec:function(n,r,i){return e.commands.formatInline.exec(n,r,"span","wysiwyg-color-"+i,t)},state:function(n,r,i){return e.commands.formatInline.state(n,r,"span","wysiwyg-color-"+i,t)}}}(wysihtml5),function(e){function t(t){for(t=t.previousSibling;t&&t.nodeType===e.TEXT_NODE&&!e.lang.string(t.data).trim();)t=t.previousSibling;return t}function n(t){for(t=t.nextSibling;t&&t.nodeType===e.TEXT_NODE&&!e.lang.string(t.data).trim();)t=t.nextSibling;return t}function r(e){return"BR"===e.nodeName||"block"===i.getStyle("display").from(e)?!0:!1}var i=e.dom,s="H1 H2 H3 H4 H5 H6 P BLOCKQUOTE DIV".split(" ");e.commands.formatBlock={exec:function(o,u,l,h,p){var v=o.doc,m=this.state(o,u,l,h,p),g=o.config.useLineBreaks,y=g?"DIV":"P",w,l="string"==typeof l?l.toUpperCase():l;if(m)o.selection.executeAndRestoreSimple(function(){p&&(m.className=m.className.replace(p,""));if(!e.lang.string(m.className).trim()&&(g||"P"===l)){var s=m,o=s.ownerDocument,u=n(s),f=t(s);u&&!r(u)&&s.parentNode.insertBefore(o.createElement("br"),u),f&&!r(f)&&s.parentNode.insertBefore(o.createElement("br"),s),i.replaceWithChildNodes(m)}else i.renameElement(m,"P"===l?"DIV":y)});else{if(null===l||e.lang.array(s).contains(l))if(w=o.selection.getSelectedNode(),m=i.getParentElement(w,{nodeName:s})){o.selection.executeAndRestore(function(){l&&(m=i.renameElement(m,l));if(h){var e=m;e.className?(e.className=e.className.replace(p,""),e.className+=" "+h):e.className=h}});return}if(o.commands.support(u)){o=l||y;if(h)var E=i.observe(v,"DOMNodeInserted",function(t){var t=t.target,n;t.nodeType===e.ELEMENT_NODE&&(n=i.getStyle("display").from(t),"inline"!==n.substr(0,6)&&(t.className+=" "+h))});v.execCommand(u,!1,o),E&&E.stop()}else m=v.createElement(l||y),h&&(m.className=h),u=m,o.selection.selectLine(),o.selection.surround(u),v=n(u),E=t(u),v&&"BR"===v.nodeName&&v.parentNode.removeChild(v),E&&"BR"===E.nodeName&&E.parentNode.removeChild(E),(v=u.lastChild)&&"BR"===v.nodeName&&v.parentNode.removeChild(v),o.selection.selectNode(u,e.browser.displaysCaretInEmptyContentEditableCorrectly())}},state:function(e,t,n,r,s){return n="string"==typeof n?n.toUpperCase():n,e=e.selection.getSelectedNode(),i.getParentElement(e,{nodeName:n,className:r,classRegExp:s})}}}(wysihtml5),function(e){function t(t,i,s){var o=t+":"+i;if(!r[o]){var u=r,f=e.selection.HTMLApplier,l=n[t],t=l?[t.toLowerCase(),l.toLowerCase()]:[t.toLowerCase()];u[o]=new f(t,i,s,!0)}return r[o]}var n={strong:"b",em:"i",b:"strong",i:"em"},r={};e.commands.formatInline={exec:function(e,n,r,i,s){n=e.selection.getRange();if(!n)return!1;t(r,i,s).toggleRange(n),e.selection.setSelection(n)},state:function(r,i,s,o,u){var i=r.doc,f=n[s]||s;return!e.dom.hasElementWithTagName(i,s)&&!e.dom.hasElementWithTagName(i,f)||o&&!e.dom.hasElementWithClassName(i,o)?!1:(r=r.selection.getRange(),r?t(s,o,u).isAppliedToRange(r):!1)}}}(wysihtml5),wysihtml5.commands.insertHTML={exec:function(e,t,n){e.commands.support(t)?e.doc.execCommand(t,!1,n):e.selection.insertHTML(n)},state:function(){return!1}},function(e){e.commands.insertImage={exec:function(t,n,r){var r="object"==typeof r?r:{src:r},i=t.doc,n=this.state(t),s;if(n)t.selection.setBefore(n),r=n.parentNode,r.removeChild(n),e.dom.removeEmptyTextNodes(r),"A"===r.nodeName&&!r.firstChild&&(t.selection.setAfter(r),r.parentNode.removeChild(r)),e.quirks.redraw(t.element);else{n=i.createElement("IMG");for(s in r)"className"===s&&(s="class"),n.setAttribute(s,r[s]);t.selection.insertNode(n),e.browser.hasProblemsSettingCaretAfterImg()?(r=i.createTextNode(e.INVISIBLE_SPACE),t.selection.insertNode(r),t.selection.setAfter(r)):t.selection.setAfter(n)}},state:function(t){var n;return e.dom.hasElementWithTagName(t.doc,"IMG")?(n=t.selection.getSelectedNode(),n?"IMG"===n.nodeName?n:n.nodeType!==e.ELEMENT_NODE?!1:(n=t.selection.getText(),(n=e.lang.string(n).trim())?!1:(t=t.selection.getNodes(e.ELEMENT_NODE,function(e){return"IMG"===e.nodeName}),1!==t.length?!1:t[0])):!1):!1}}}(wysihtml5),function(e){var t="<br>"+(e.browser.needsSpaceAfterLineBreak()?" ":"");e.commands.insertLineBreak={exec:function(n,r){n.commands.support(r)?(n.doc.execCommand(r,!1,null),e.browser.autoScrollsToCaret()||n.selection.scrollIntoView()):n.commands.exec("insertHTML",t)},state:function(){return!1}}}(wysihtml5),wysihtml5.commands.insertOrderedList={exec:function(e,t){var n=e.doc,r=e.selection.getSelectedNode(),i=wysihtml5.dom.getParentElement(r,{nodeName:"OL"}),s=wysihtml5.dom.getParentElement(r,{nodeName:"UL"}),r="_wysihtml5-temp-"+(new Date).getTime(),o;!i&&!s&&e.commands.support(t)?n.execCommand(t,!1,null):i?e.selection.executeAndRestore(function(){wysihtml5.dom.resolveList(i,e.config.useLineBreaks)}):s?e.selection.executeAndRestore(function(){wysihtml5.dom.renameElement(s,"ol")}):(e.commands.exec("formatBlock","div",r),o=n.querySelector("."+r),n=""===o.innerHTML||o.innerHTML===wysihtml5.INVISIBLE_SPACE||"<br>"===o.innerHTML,e.selection.executeAndRestore(function(){i=wysihtml5.dom.convertToList(o,"ol")}),n&&e.selection.selectNode(i.querySelector("li"),!0))},state:function(e){return e=e.selection.getSelectedNode(),wysihtml5.dom.getParentElement(e,{nodeName:"OL"})}},wysihtml5.commands.insertUnorderedList={exec:function(e,t){var n=e.doc,r=e.selection.getSelectedNode(),i=wysihtml5.dom.getParentElement(r,{nodeName:"UL"}),s=wysihtml5.dom.getParentElement(r,{nodeName:"OL"}),r="_wysihtml5-temp-"+(new Date).getTime(),o;!i&&!s&&e.commands.support(t)?n.execCommand(t,!1,null):i?e.selection.executeAndRestore(function(){wysihtml5.dom.resolveList(i,e.config.useLineBreaks)}):s?e.selection.executeAndRestore(function(){wysihtml5.dom.renameElement(s,"ul")}):(e.commands.exec("formatBlock","div",r),o=n.querySelector("."+r),n=""===o.innerHTML||o.innerHTML===wysihtml5.INVISIBLE_SPACE||"<br>"===o.innerHTML,e.selection.executeAndRestore(function(){i=wysihtml5.dom.convertToList(o,"ul")}),n&&e.selection.selectNode(i.querySelector("li"),!0))},state:function(e){return e=e.selection.getSelectedNode(),wysihtml5.dom.getParentElement(e,{nodeName:"UL"})}},wysihtml5.commands.italic={exec:function(e,t){return wysihtml5.commands.formatInline.exec(e,t,"i")},state:function(e,t){return wysihtml5.commands.formatInline.state(e,t,"i")}},function(e){var t=/wysiwyg-text-align-[0-9a-z]+/g;e.commands.justifyCenter={exec:function(n){return e.commands.formatBlock.exec(n,"formatBlock",null,"wysiwyg-text-align-center",t)},state:function(n){return e.commands.formatBlock.state(n,"formatBlock",null,"wysiwyg-text-align-center",t)}}}(wysihtml5),function(e){var t=/wysiwyg-text-align-[0-9a-z]+/g;e.commands.justifyLeft={exec:function(n){return e.commands.formatBlock.exec(n,"formatBlock",null,"wysiwyg-text-align-left",t)},state:function(n){return e.commands.formatBlock.state(n,"formatBlock",null,"wysiwyg-text-align-left",t)}}}(wysihtml5),function(e){var t=/wysiwyg-text-align-[0-9a-z]+/g;e.commands.justifyRight={exec:function(n){return e.commands.formatBlock.exec(n,"formatBlock",null,"wysiwyg-text-align-right",t)},state:function(n){return e.commands.formatBlock.state(n,"formatBlock",null,"wysiwyg-text-align-right",t)}}}(wysihtml5),function(e){var t=/wysiwyg-text-align-[0-9a-z]+/g;e.commands.justifyFull={exec:function(n){return e.commands.formatBlock.exec(n,"formatBlock",null,"wysiwyg-text-align-justify",t)},state:function(n){return e.commands.formatBlock.state(n,"formatBlock",null,"wysiwyg-text-align-justify",t)}}}(wysihtml5),wysihtml5.commands.redo={exec:function(e){return e.undoManager.redo()},state:function(){return!1}},wysihtml5.commands.underline={exec:function(e,t){return wysihtml5.commands.formatInline.exec(e,t,"u")},state:function(e,t){return wysihtml5.commands.formatInline.state(e,t,"u")}},wysihtml5.commands.undo={exec:function(e){return e.undoManager.undo()},state:function(){return!1}},function(e){var t='<span id="_wysihtml5-undo" class="_wysihtml5-temp">'+e.INVISIBLE_SPACE+"</span>",n='<span id="_wysihtml5-redo" class="_wysihtml5-temp">'+e.INVISIBLE_SPACE+"</span>",r=e.dom;e.UndoManager=e.lang.Dispatcher.extend({constructor:function(e){this.editor=e,this.composer=e.composer,this.element=this.composer.element,this.position=0,this.historyStr=[],this.historyDom=[],this.transact(),this._observe()},_observe:function(){var i=this,s=this.composer.sandbox.getDocument(),o;r.observe(this.element,"keydown",function(e){if(!(e.altKey||!e.ctrlKey&&!e.metaKey)){var t=e.keyCode,n=90===t&&e.shiftKey||89===t;90===t&&!e.shiftKey?(i.undo(),e.preventDefault()):n&&(i.redo(),e.preventDefault())}}),r.observe(this.element,"keydown",function(e){e=e.keyCode,e!==o&&(o=e,(8===e||46===e)&&i.transact())});if(e.browser.hasUndoInContextMenu()){var u,f,l=function(){for(var e;e=s.querySelector("._wysihtml5-temp");)e.parentNode.removeChild(e);clearInterval(u)};r.observe(this.element,"contextmenu",function(){l(),i.composer.selection.executeAndRestoreSimple(function(){i.element.lastChild&&i.composer.selection.setAfter(i.element.lastChild),s.execCommand("insertHTML",!1,t),s.execCommand("insertHTML",!1,n),s.execCommand("undo",!1,null)}),u=setInterval(function(){s.getElementById("_wysihtml5-redo")?(l(),i.redo()):s.getElementById("_wysihtml5-undo")||(l(),i.undo())},400),f||(f=!0,r.observe(document,"mousedown",l),r.observe(s,["mousedown","paste","cut","copy"],l))})}this.editor.on("newword:composer",function(){i.transact()}).on("beforecommand:composer",function(){i.transact()})},transact:function(){var t=this.historyStr[this.position-1],n=this.composer.getValue();if(n!==t){25<(this.historyStr.length=this.historyDom.length=this.position)&&(this.historyStr.shift(),this.historyDom.shift(),this.position--),this.position++;var r=this.composer.selection.getRange(),t=r.startContainer||this.element,i=r.startOffset||0,s;t.nodeType===e.ELEMENT_NODE?r=t:(r=t.parentNode,s=this.getChildNodeIndex(r,t)),r.setAttribute("data-wysihtml5-selection-offset",i),"undefined"!=typeof s&&r.setAttribute("data-wysihtml5-selection-node",s),s=this.element.cloneNode(!!n),this.historyDom.push(s),this.historyStr.push(n),r.removeAttribute("data-wysihtml5-selection-offset"),r.removeAttribute("data-wysihtml5-selection-node")}},undo:function(){this.transact(),this.undoPossible()&&(this.set(this.historyDom[--this.position-1]),this.editor.fire("undo:composer"))},redo:function(){this.redoPossible()&&(this.set(this.historyDom[++this.position-1]),this.editor.fire("redo:composer"))},undoPossible:function(){return 1<this.position},redoPossible:function(){return this.position<this.historyStr.length},set:function(e){this.element.innerHTML="";for(var t=0,n=e.childNodes,r=e.childNodes.length;t<r;t++)this.element.appendChild(n[t].cloneNode(!0));e.hasAttribute("data-wysihtml5-selection-offset")?(t=e.getAttribute("data-wysihtml5-selection-offset"),n=e.getAttribute("data-wysihtml5-selection-node"),e=this.element):(e=this.element.querySelector("[data-wysihtml5-selection-offset]")||this.element,t=e.getAttribute("data-wysihtml5-selection-offset"),n=e.getAttribute("data-wysihtml5-selection-node"),e.removeAttribute("data-wysihtml5-selection-offset"),e.removeAttribute("data-wysihtml5-selection-node")),null!==n&&(e=this.getChildNodeByIndex(e,+n)),this.composer.selection.set(e,t)},getChildNodeIndex:function(e,t){for(var n=0,r=e.childNodes,i=r.length;n<i;n++)if(r[n]===t)return n},getChildNodeByIndex:function(e,t){return e.childNodes[t]}})}(wysihtml5),wysihtml5.views.View=Base.extend({constructor:function(e,t,n){this.parent=e,this.element=t,this.config=n,this._observeViewChange()},_observeViewChange:function(){var e=this;this.parent.on("beforeload",function(){e.parent.on("change_view",function(t){t===e.name?(e.parent.currentView=e,e.show(),setTimeout(function(){e.focus()},0)):e.hide()})})},focus:function(){if(this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element.focus()}catch(e){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}}),function(e){var t=e.dom,n=e.browser;e.views.Composer=e.views.View.extend({name:"composer",CARET_HACK:"<br>",constructor:function(e,t,n){this.base(e,t,n),this.textarea=this.parent.textarea,this._initSandbox()},clear:function(){this.element.innerHTML=n.displaysCaretInEmptyContentEditableCorrectly()?"":this.CARET_HACK},getValue:function(t){var n=this.isEmpty()?"":e.quirks.getCorrectInnerHTML(this.element);return t&&(n=this.parent.parse(n)),n=e.lang.string(n).replace(e.INVISIBLE_SPACE).by("")},setValue:function(e,t){t&&(e=this.parent.parse(e));try{this.element.innerHTML=e}catch(n){this.element.innerText=e}},show:function(){this.iframe.style.display=this._displayStyle||"",this.textarea.element.disabled||(this.disable(),this.enable())},hide:function(){this._displayStyle=t.getStyle("display").from(this.iframe),"none"===this._displayStyle&&(this._displayStyle=null),this.iframe.style.display="none"},disable:function(){this.parent.fire("disable:composer"),this.element.removeAttribute("contentEditable")},enable:function(){this.parent.fire("enable:composer"),this.element.setAttribute("contentEditable","true")},focus:function(t){e.browser.doesAsyncFocus()&&this.hasPlaceholderSet()&&this.clear(),this.base();var n=this.element.lastChild;t&&n&&("BR"===n.nodeName?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getTextContent:function(){return t.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==this.textarea.element.getAttribute("placeholder")&&this.placeholderSet},isEmpty:function(){var e=this.element.innerHTML.toLowerCase();return""===e||"<br>"===e||"<p></p>"===e||"<p><br></p>"===e||this.hasPlaceholderSet()},_initSandbox:function(){var e=this;this.sandbox=new t.Sandbox(function(){e._create()},{stylesheets:this.config.stylesheets}),this.iframe=this.sandbox.getIframe();var n=this.textarea.element;t.insert(this.iframe).after(n);if(n.form){var r=document.createElement("input");r.type="hidden",r.name="_wysihtml5_mode",r.value=1,t.insert(r).after(n)}},_create:function(){var r=this;this.doc=this.sandbox.getDocument(),this.element=this.doc.body,this.textarea=this.parent.textarea,this.element.innerHTML=this.textarea.getValue(!0),this.selection=new e.Selection(this.parent),this.commands=new e.Commands(this.parent),t.copyAttributes("className spellcheck title lang dir accessKey".split(" ")).from(this.textarea.element).to(this.element),t.addClass(this.element,this.config.composerClassName),this.config.style&&this.style(),this.observe();var i=this.config.name;i&&(t.addClass(this.element,i),t.addClass(this.iframe,i)),this.enable(),this.textarea.element.disabled&&this.disable(),(i="string"==typeof this.config.placeholder?this.config.placeholder:this.textarea.element.getAttribute("placeholder"))&&t.simulatePlaceholder(this.parent,this,i),this.commands.exec("styleWithCSS",!1),this._initAutoLinking(),this._initObjectResizing(),this._initUndoManager(),this._initLineBreaking(),(this.textarea.element.hasAttribute("autofocus")||document.querySelector(":focus")==this.textarea.element)&&!n.isIos()&&setTimeout(function(){r.focus(!0)},100),n.clearsContentEditableCorrectly()||e.quirks.ensureProperClearing(this),this.initSync&&this.config.sync&&this.initSync(),this.textarea.hide(),this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var r=this,i=n.canDisableAutoLinking(),s=n.doesAutoLinkingInContentEditable();i&&this.commands.exec("autoUrlDetect",!1);if(this.config.autoLink){if(!s||s&&i)this.parent.on("newword:composer",function(){t.getTextContent(r.element).match(t.autoLink.URL_REG_EXP)&&r.selection.executeAndRestore(function(e,n){t.autoLink(n.parentNode)})}),t.observe(this.element,"blur",function(){t.autoLink(r.element)});var o=this.sandbox.getDocument().getElementsByTagName("a"),u=t.autoLink.URL_REG_EXP,f=function(n){return n=e.lang.string(t.getTextContent(n)).trim(),"www."===n.substr(0,4)&&(n="http://"+n),n};t.observe(this.element,"keydown",function(e){if(o.length){var e=r.selection.getSelectedNode(e.target.ownerDocument),n=t.getParentElement(e,{nodeName:"A"},4),i;n&&(i=f(n),setTimeout(function(){var e=f(n);e!==i&&e.match(u)&&n.setAttribute("href",e)},0))}})}},_initObjectResizing:function(){this.commands.exec("enableObjectResizing",!0);if(n.supportsEvent("resizeend")){var r=["width","height"],i=r.length,s=this.element;t.observe(s,"resizeend",function(t){var t=t.target||t.srcElement,n=t.style,o=0,u;if("IMG"===t.nodeName){for(;o<i;o++)u=r[o],n[u]&&(t.setAttribute(u,parseInt(n[u],10)),n[u]="");e.quirks.redraw(s)}})}},_initUndoManager:function(){this.undoManager=new e.UndoManager(this.parent)},_initLineBreaking:function(){function r(e){var n=t.getParentElement(e,{nodeName:["P","DIV"]},2);n&&i.selection.executeAndRestore(function(){i.config.useLineBreaks?t.replaceWithChildNodes(n):"P"!==n.nodeName&&t.renameElement(n,"p")})}var i=this,s="LI P H1 H2 H3 H4 H5 H6".split(" "),o=["UL","OL","MENU"];this.config.useLineBreaks||t.observe(this.element,["focus","keydown"],function(){if(i.isEmpty()){var e=i.doc.createElement("P");i.element.innerHTML="",i.element.appendChild(e),n.displaysCaretInEmptyContentEditableCorrectly()?i.selection.selectNode(e,!0):(e.innerHTML="<br>",i.selection.setBefore(e.firstChild))}}),t.observe(this.doc,"keydown",function(n){var u=n.keyCode;if(!n.shiftKey&&(u===e.ENTER_KEY||u===e.BACKSPACE_KEY)){var a=t.getParentElement(i.selection.getSelectedNode(),{nodeName:s},4);a?setTimeout(function(){var n=i.selection.getSelectedNode(),s;if("LI"===a.nodeName){if(!n)return;(s=t.getParentElement(n,{nodeName:o},2))||r(n)}u===e.ENTER_KEY&&a.nodeName.match(/^H[1-6]$/)&&r(n)},0):i.config.useLineBreaks&&u===e.ENTER_KEY&&!e.browser.insertsLineBreaksOnReturn()&&(i.commands.exec("insertLineBreak"),n.preventDefault())}})}})}(wysihtml5),function(e){var t=e.dom,n=document,r=window,i=n.createElement("div"),s="background-color color cursor font-family font-size font-style font-variant font-weight line-height letter-spacing text-align text-decoration text-indent text-rendering word-break word-wrap word-spacing".split(" "),o="background-color border-collapse border-bottom-color border-bottom-style border-bottom-width border-left-color border-left-style border-left-width border-right-color border-right-style border-right-width border-top-color border-top-style border-top-width clear display float margin-bottom margin-left margin-right margin-top outline-color outline-offset outline-width outline-style padding-left padding-right padding-top padding-bottom position top left right bottom z-index vertical-align text-align -webkit-box-sizing -moz-box-sizing -ms-box-sizing box-sizing -webkit-box-shadow -moz-box-shadow -ms-box-shadow box-shadow -webkit-border-top-right-radius -moz-border-radius-topright border-top-right-radius -webkit-border-bottom-right-radius -moz-border-radius-bottomright border-bottom-right-radius -webkit-border-bottom-left-radius -moz-border-radius-bottomleft border-bottom-left-radius -webkit-border-top-left-radius -moz-border-radius-topleft border-top-left-radius width height".split(" "),u=["html                 { height: 100%; }","body                 { height: 100%; padding: 1px 0 0 0; margin: -1px 0 0 0; }","body > p:first-child { margin-top: 0; }","._wysihtml5-temp     { display: none; }",e.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","img:-moz-broken      { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"];e.views.Composer.prototype.style=function(){var l=this,p=n.querySelector(":focus"),v=this.textarea.element,m=v.hasAttribute("placeholder"),g=m&&v.getAttribute("placeholder"),y=v.style.display,w=v.disabled,E;this.focusStylesHost=i.cloneNode(!1),this.blurStylesHost=i.cloneNode(!1),this.disabledStylesHost=i.cloneNode(!1),m&&v.removeAttribute("placeholder"),v===p&&v.blur(),v.disabled=!1,v.style.display=E="none";if(v.getAttribute("rows")&&"auto"===t.getStyle("height").from(v)||v.getAttribute("cols")&&"auto"===t.getStyle("width").from(v))v.style.display=E=y;t.copyStyles(o).from(v).to(this.iframe).andTo(this.blurStylesHost),t.copyStyles(s).from(v).to(this.element).andTo(this.blurStylesHost),t.insertCSS(u).into(this.element.ownerDocument),v.disabled=!0,t.copyStyles(o).from(v).to(this.disabledStylesHost),t.copyStyles(s).from(v).to(this.disabledStylesHost),v.disabled=w,v.style.display=y;if(v.setActive)try{v.setActive()}catch(S){}else{var x=v.style,w=n.documentElement.scrollTop||n.body.scrollTop,T=n.documentElement.scrollLeft||n.body.scrollLeft,x={position:x.position,top:x.top,left:x.left,WebkitUserSelect:x.WebkitUserSelect};t.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(v),v.focus(),t.setStyles(x).on(v),r.scrollTo&&r.scrollTo(T,w)}v.style.display=E,t.copyStyles(o).from(v).to(this.focusStylesHost),t.copyStyles(s).from(v).to(this.focusStylesHost),v.style.display=y,t.copyStyles(["display"]).from(v).to(this.iframe);var N=e.lang.array(o).without(["display"]);return p?p.focus():v.blur(),m&&v.setAttribute("placeholder",g),this.parent.on("focus:composer",function(){t.copyStyles(N).from(l.focusStylesHost).to(l.iframe),t.copyStyles(s).from(l.focusStylesHost).to(l.element)}),this.parent.on("blur:composer",function(){t.copyStyles(N).from(l.blurStylesHost).to(l.iframe),t.copyStyles(s).from(l.blurStylesHost).to(l.element)}),this.parent.observe("disable:composer",function(){t.copyStyles(N).from(l.disabledStylesHost).to(l.iframe),t.copyStyles(s).from(l.disabledStylesHost).to(l.element)}),this.parent.observe("enable:composer",function(){t.copyStyles(N).from(l.blurStylesHost).to(l.iframe),t.copyStyles(s).from(l.blurStylesHost).to(l.element)}),this}}(wysihtml5),function(e){var t=e.dom,n=e.browser,r={66:"bold",73:"italic",85:"underline"};e.views.Composer.prototype.observe=function(){var i=this,s=this.getValue(),o=this.sandbox.getIframe(),u=this.element,f=n.supportsEventsInIframeCorrectly()?u:this.sandbox.getWindow();t.observe(o,"DOMNodeRemoved",function(){clearInterval(l),i.parent.fire("destroy:composer")});var l=setInterval(function(){t.contains(document.documentElement,o)||(clearInterval(l),i.parent.fire("destroy:composer"))},250);t.observe(f,"focus",function(){i.parent.fire("focus").fire("focus:composer"),setTimeout(function(){s=i.getValue()},0)}),t.observe(f,"blur",function(){s!==i.getValue()&&i.parent.fire("change").fire("change:composer"),i.parent.fire("blur").fire("blur:composer")}),t.observe(u,"dragenter",function(){i.parent.fire("unset_placeholder")}),t.observe(u,["drop","paste"],function(){setTimeout(function(){i.parent.fire("paste").fire("paste:composer")},0)}),t.observe(u,"keyup",function(t){t=t.keyCode,(t===e.SPACE_KEY||t===e.ENTER_KEY)&&i.parent.fire("newword:composer")}),this.parent.on("paste:composer",function(){setTimeout(function(){i.parent.fire("newword:composer")},0)}),n.canSelectImagesInContentEditable()||t.observe(u,"mousedown",function(e){var t=e.target;"IMG"===t.nodeName&&(i.selection.selectNode(t),e.preventDefault())}),n.hasHistoryIssue()&&n.supportsSelectionModify()&&t.observe(u,"keydown",function(e){if(e.metaKey||e.ctrlKey){var t=e.keyCode,n=u.ownerDocument.defaultView.getSelection();if(37===t||39===t)37===t&&(n.modify("extend","left","lineboundary"),e.shiftKey||n.collapseToStart()),39===t&&(n.modify("extend","right","lineboundary"),e.shiftKey||n.collapseToEnd()),e.preventDefault()}}),t.observe(u,"keydown",function(e){var t=r[e.keyCode];(e.ctrlKey||e.metaKey)&&!e.altKey&&t&&(i.commands.exec(t),e.preventDefault())}),t.observe(u,"keydown",function(t){var n=i.selection.getSelectedNode(!0),r=t.keyCode;n&&"IMG"===n.nodeName&&(r===e.BACKSPACE_KEY||r===e.DELETE_KEY)&&(r=n.parentNode,r.removeChild(n),"A"===r.nodeName&&!r.firstChild&&r.parentNode.removeChild(r),setTimeout(function(){e.quirks.redraw(u)},0),t.preventDefault())}),n.hasIframeFocusIssue()&&(t.observe(this.iframe,"focus",function(){setTimeout(function(){i.doc.querySelector(":focus")!==i.element&&i.focus()},0)}),t.observe(this.element,"blur",function(){setTimeout(function(){i.selection.getSelection().removeAllRanges()},0)}));var h={IMG:"Image: ",A:"Link: "};t.observe(u,"mouseover",function(e){var e=e.target,t=e.nodeName;("A"===t||"IMG"===t)&&!e.hasAttribute("title")&&(t=h[t]+(e.getAttribute("href")||e.getAttribute("src")),e.setAttribute("title",t))})}}(wysihtml5),function(e){e.views.Synchronizer=Base.extend({constructor:function(e,t,n){this.editor=e,this.textarea=t,this.composer=n,this._observe()},fromComposerToTextarea:function(t){this.textarea.setValue(e.lang.string(this.composer.getValue()).trim(),t)},fromTextareaToComposer:function(e){var t=this.textarea.getValue();t?this.composer.setValue(t,e):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(e){"textarea"===this.editor.currentView.name?this.fromTextareaToComposer(e):this.fromComposerToTextarea(e)},_observe:function(){var t,n=this,r=this.textarea.element.form,i=function(){t=setInterval(function(){n.fromComposerToTextarea()},400)},s=function(){clearInterval(t),t=null};i(),r&&(e.dom.observe(r,"submit",function(){n.sync(!0)}),e.dom.observe(r,"reset",function(){setTimeout(function(){n.fromTextareaToComposer()},0)})),this.editor.on("change_view",function(e){"composer"===e&&!t?(n.fromTextareaToComposer(!0),i()):"textarea"===e&&(n.fromComposerToTextarea(!0),s())}),this.editor.on("destroy:composer",s)}})}(wysihtml5),wysihtml5.views.Textarea=wysihtml5.views.View.extend({name:"textarea",constructor:function(e,t,n){this.base(e,t,n),this._observe()},clear:function(){this.element.value=""},getValue:function(e){var t=this.isEmpty()?"":this.element.value;return e&&(t=this.parent.parse(t)),t},setValue:function(e,t){t&&(e=this.parent.parse(e)),this.element.value=e},hasPlaceholderSet:function(){var e=wysihtml5.browser.supportsPlaceholderAttributeOn(this.element),t=this.element.getAttribute("placeholder")||null,n=this.element.value;return e&&!n||n===t},isEmpty:function(){return!wysihtml5.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var e=this.element,t=this.parent,n={focusin:"focus",focusout:"blur"},r=wysihtml5.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];t.on("beforeload",function(){wysihtml5.dom.observe(e,r,function(e){e=n[e.type]||e.type,t.fire(e).fire(e+":textarea")}),wysihtml5.dom.observe(e,["paste","drop"],function(){setTimeout(function(){t.fire("paste").fire("paste:textarea")},0)})})}}),function(e){var t=e.dom;e.toolbar.Dialog=e.lang.Dispatcher.extend({constructor:function(e,t){this.link=e,this.container=t},_observe:function(){if(!this._observed){var n=this,r=function(e){var t=n._serialize();t==n.elementToChange?n.fire("edit",t):n.fire("save",t),n.hide(),e.preventDefault(),e.stopPropagation()};t.observe(n.link,"click",function(){t.hasClass(n.link,"wysihtml5-command-dialog-opened")&&setTimeout(function(){n.hide()},0)}),t.observe(this.container,"keydown",function(t){var i=t.keyCode;i===e.ENTER_KEY&&r(t),i===e.ESCAPE_KEY&&n.hide()}),t.delegate(this.container,"[data-wysihtml5-dialog-action=save]","click",r),t.delegate(this.container,"[data-wysihtml5-dialog-action=cancel]","click",function(e){n.fire("cancel"),n.hide(),e.preventDefault(),e.stopPropagation()});for(var i=this.container.querySelectorAll("input, select, textarea"),s=0,o=i.length,u=function(){clearInterval(n.interval)};s<o;s++)t.observe(i[s],"change",u);this._observed=!0}},_serialize:function(){for(var e=this.elementToChange||{},t=this.container.querySelectorAll("[data-wysihtml5-dialog-field]"),n=t.length,r=0;r<n;r++)e[t[r].getAttribute("data-wysihtml5-dialog-field")]=t[r].value;return e},_interpolate:function(e){for(var t,n,r=document.querySelector(":focus"),i=this.container.querySelectorAll("[data-wysihtml5-dialog-field]"),s=i.length,o=0;o<s;o++)t=i[o],t!==r&&(!e||"hidden"!==t.type)&&(n=t.getAttribute("data-wysihtml5-dialog-field"),n=this.elementToChange?this.elementToChange[n]||"":t.defaultValue,t.value=n)},show:function(e){if(!t.hasClass(this.link,"wysihtml5-command-dialog-opened")){var n=this,r=this.container.querySelector("input, select, textarea");this.elementToChange=e,this._observe(),this._interpolate(),e&&(this.interval=setInterval(function(){n._interpolate(!0)},500)),t.addClass(this.link,"wysihtml5-command-dialog-opened"),this.container.style.display="",this.fire("show");if(r&&!e)try{r.focus()}catch(i){}}},hide:function(){clearInterval(this.interval),this.elementToChange=null,t.removeClass(this.link,"wysihtml5-command-dialog-opened"),this.container.style.display="none",this.fire("hide")}})}(wysihtml5),function(e){var t=e.dom,n={position:"relative"},r={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1},i={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"},s={"x-webkit-speech":"",speech:""};e.toolbar.Speech=function(o,u){var l=document.createElement("input");if(e.browser.supportsSpeechApiOn(l)){var h=o.editor.textarea.element.getAttribute("lang");h&&(s.lang=h),h=document.createElement("div"),e.lang.object(r).merge({width:u.offsetWidth+"px",height:u.offsetHeight+"px"}),t.insert(l).into(h),t.insert(h).into(u),t.setStyles(i).on(l),t.setAttributes(s).on(l),t.setStyles(r).on(h),t.setStyles(n).on(u),t.observe(l,"onwebkitspeechchange"in l?"webkitspeechchange":"speechchange",function(){o.execCommand("insertText",l.value),l.value=""}),t.observe(l,"click",function(e){t.hasClass(u,"wysihtml5-command-disabled")&&e.preventDefault(),e.stopPropagation()})}else u.style.display="none"}}(wysihtml5),function(e){var t=e.dom;e.toolbar.Toolbar=Base.extend({constructor:function(t,n){this.editor=t,this.container="string"==typeof n?document.getElementById(n):n,this.composer=t.composer,this._getLinks("command"),this._getLinks("action"),this._observe(),this.show();for(var r=this.container.querySelectorAll("[data-wysihtml5-command=insertSpeech]"),i=r.length,s=0;s<i;s++)new e.toolbar.Speech(this,r[s])},_getLinks:function(t){for(var n=this[t+"Links"]=e.lang.array(this.container.querySelectorAll("[data-wysihtml5-"+t+"]")).get(),r=n.length,i=0,s=this[t+"Mapping"]={},o,u,a,f,l;i<r;i++)o=n[i],a=o.getAttribute("data-wysihtml5-"+t),f=o.getAttribute("data-wysihtml5-"+t+"-value"),u=this.container.querySelector("[data-wysihtml5-"+t+"-group='"+a+"']"),l=this._getDialog(o,a),s[a+":"+f]={link:o,group:u,name:a,value:f,dialog:l,state:!1}},_getDialog:function(t,n){var r=this,i=this.container.querySelector("[data-wysihtml5-dialog='"+n+"']"),s,o;return i&&(s=new e.toolbar.Dialog(t,i),s.on("show",function(){o=r.composer.selection.getBookmark(),r.editor.fire("show:dialog",{command:n,dialogContainer:i,commandLink:t})}),s.on("save",function(e){o&&r.composer.selection.setBookmark(o),r._execCommand(n,e),r.editor.fire("save:dialog",{command:n,dialogContainer:i,commandLink:t})}),s.on("cancel",function(){r.editor.focus(!1),r.editor.fire("cancel:dialog",{command:n,dialogContainer:i,commandLink:t})})),s},execCommand:function(e,t){if(!this.commandsDisabled){var n=this.commandMapping[e+":"+t];n&&n.dialog&&!n.state?n.dialog.show():this._execCommand(e,t)}},_execCommand:function(e,t){this.editor.focus(!1),this.composer.commands.exec(e,t),this._updateLinkStates()},execAction:function(e){var t=this.editor;"change_view"===e&&(t.currentView===t.textarea?t.fire("change_view","composer"):t.fire("change_view","textarea"))},_observe:function(){for(var e=this,n=this.editor,r=this.container,i=this.commandLinks.concat(this.actionLinks),s=i.length,o=0;o<s;o++)t.setAttributes({href:"javascript:;",unselectable:"on"}).on(i[o]);t.delegate(r,"[data-wysihtml5-command], [data-wysihtml5-action]","mousedown",function(e){e.preventDefault()}),t.delegate(r,"[data-wysihtml5-command]","click",function(t){var n=this.getAttribute("data-wysihtml5-command"),r=this.getAttribute("data-wysihtml5-command-value");e.execCommand(n,r),t.preventDefault()}),t.delegate(r,"[data-wysihtml5-action]","click",function(t){var n=this.getAttribute("data-wysihtml5-action");e.execAction(n),t.preventDefault()}),n.on("focus:composer",function(){e.bookmark=null,clearInterval(e.interval),e.interval=setInterval(function(){e._updateLinkStates()},500)}),n.on("blur:composer",function(){clearInterval(e.interval)}),n.on("destroy:composer",function(){clearInterval(e.interval)}),n.on("change_view",function(n){setTimeout(function(){e.commandsDisabled="composer"!==n,e._updateLinkStates(),e.commandsDisabled?t.addClass(r,"wysihtml5-commands-disabled"):t.removeClass(r,"wysihtml5-commands-disabled")},0)})},_updateLinkStates:function(){var n=this.commandMapping,r=this.actionMapping,i,s,o;for(i in n)o=n[i],this.commandsDisabled?(s=!1,t.removeClass(o.link,"wysihtml5-command-active"),o.group&&t.removeClass(o.group,"wysihtml5-command-active"),o.dialog&&o.dialog.hide()):(s=this.composer.commands.state(o.name,o.value),e.lang.object(s).isArray()&&(s=1===s.length?s[0]:!0),t.removeClass(o.link,"wysihtml5-command-disabled"),o.group&&t.removeClass(o.group,"wysihtml5-command-disabled")),o.state!==s&&((o.state=s)?(t.addClass(o.link,"wysihtml5-command-active"),o.group&&t.addClass(o.group,"wysihtml5-command-active"),o.dialog&&("object"==typeof s?o.dialog.show(s):o.dialog.hide())):(t.removeClass(o.link,"wysihtml5-command-active"),o.group&&t.removeClass(o.group,"wysihtml5-command-active"),o.dialog&&o.dialog.hide()));for(i in r)n=r[i],"change_view"===n.name&&(n.state=this.editor.currentView===this.editor.textarea,n.state?t.addClass(n.link,"wysihtml5-action-active"):t.removeClass(n.link,"wysihtml5-action-active"))},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}})}(wysihtml5),function(e){var t={name:void 0,style:!0,toolbar:void 0,autoLink:!0,parserRules:{tags:{br:{},span:{},div:{},p:{}},classes:{}},parser:e.dom.parse,composerClassName:"wysihtml5-editor",bodyClassName:"wysihtml5-supported",useLineBreaks:!0,stylesheets:[],placeholderText:void 0,supportTouchDevices:!0};e.Editor=e.lang.Dispatcher.extend({constructor:function(n,r){this.textareaElement="string"==typeof n?document.getElementById(n):n,this.config=e.lang.object({}).merge(t).merge(r).get(),this.currentView=this.textarea=new e.views.Textarea(this,this.textareaElement,this.config),this._isCompatible=e.browser.supported();if(!this._isCompatible||!this.config.supportTouchDevices&&e.browser.isTouchDevice()){var i=this;setTimeout(function(){i.fire("beforeload").fire("load")},0)}else{e.dom.addClass(document.body,this.config.bodyClassName),this.currentView=this.composer=new e.views.Composer(this,this.textareaElement,this.config),"function"==typeof this.config.parser&&this._initParser(),this.on("beforeload",function(){this.synchronizer=new e.views.Synchronizer(this,this.textarea,this.composer),this.config.toolbar&&(this.toolbar=new e.toolbar.Toolbar(this,this.config.toolbar))});try{console.log("Heya! This page is using wysihtml5 for rich text editing. Check out https://github.com/xing/wysihtml5")}catch(s){}}},isCompatible:function(){return this._isCompatible},clear:function(){return this.currentView.clear(),this},getValue:function(e){return this.currentView.getValue(e)},setValue:function(e,t){return this.fire("unset_placeholder"),e?(this.currentView.setValue(e,t),this):this.clear()},focus:function(e){return this.currentView.focus(e),this},disable:function(){return this.currentView.disable(),this},enable:function(){return this.currentView.enable(),this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},parse:function(t){var n=this.config.parser(t,this.config.parserRules,this.composer.sandbox.getDocument(),!0);return"object"==typeof t&&e.quirks.redraw(t),n},_initParser:function(){this.on("paste:composer",function(){var t=this;t.composer.selection.executeAndRestore(function(){e.quirks.cleanPastedHTML(t.composer.element),t.parse(t.composer.element)},!0)})}})}(wysihtml5),define("admin/modules/wysiwyg/commands/insertMedia",["$","admin/modules/WindowPopup","wysihtml5"],function(e,t,n){return{launchWindow:function(e,n,r,i,s,o){s=s||screen.width?(screen.width-n)/2:0,i=i||screen.height?(screen.height-r)/2:0,t.request(e,["width="+n,"height="+r,"top="+i,"left="+s,"scrollbars=yes","location=no","directories=no","status=no","menubar=no","toolbar=no","resizable=no"].join(","),o)},exec:function(t,n,r){try{r=JSON.parse(r)}catch(i){throw"You must pass valid JSON to the insertMedia `command-value` data attribute."}this.launchWindow(r.mediaUrl,1025,600,null,null,function(n){t.selection.insertNode(e(n)[0])})}}}),define("admin/modules/wysiwyg/commands/commands",["wysihtml5","./insertMedia"],function(e,t){e.commands.insertMedia=t}),define("admin/modules/wysiwyg/WysiwygRules",[],function(){return{classes:{"wysiwyg-clear-both":1,"wysiwyg-clear-left":1,"wysiwyg-clear-right":1,"wysiwyg-float-left":1,"wysiwyg-float-right":1,"wysiwyg-text-align-center":1,"wysiwyg-text-align-justify":1,"wysiwyg-text-align-left":1,"wysiwyg-text-align-right":1,arrow:1},tags:{tr:{add_class:{align:"align_text"}},strike:{remove:1},form:{rename_tag:"div"},rt:{rename_tag:"span"},code:{},acronym:{rename_tag:"span"},br:{add_class:{clear:"clear_br"}},details:{rename_tag:"div"},h4:{add_class:{align:"align_text"}},em:{},title:{remove:1},multicol:{rename_tag:"div"},figure:{rename_tag:"div"},xmp:{rename_tag:"span"},small:{rename_tag:"span",set_class:"wysiwyg-font-size-smaller"},area:{remove:1},time:{rename_tag:"span"},dir:{rename_tag:"ul"},bdi:{rename_tag:"span"},command:{remove:1},ul:{},progress:{rename_tag:"span"},dfn:{rename_tag:"span"},iframe:{remove:0,check_attributes:{src:"href",width:"numbers",height:"numbers",frameborder:"numbers",allowfullscreen:"alt"}},figcaption:{rename_tag:"div"},a:{check_attributes:{href:"href"},set_attributes:{rel:"nofollow",target:"_blank"}},img:{check_attributes:{width:"numbers",alt:"alt",title:"alt",src:"src",height:"numbers"},add_class:{align:"align_img"}},rb:{rename_tag:"span"},footer:{rename_tag:"div"},noframes:{remove:1},abbr:{rename_tag:"span"},u:{},bgsound:{remove:1},sup:{rename_tag:"span"},address:{rename_tag:"div"},basefont:{remove:1},nav:{rename_tag:"div"},h1:{add_class:{align:"align_text"}},head:{remove:1},tbody:{add_class:{align:"align_text"}},dd:{rename_tag:"div"},s:{rename_tag:"span"},li:{},td:{check_attributes:{rowspan:"numbers",colspan:"numbers"},add_class:{align:"align_text"}},object:{remove:1},div:{add_class:{align:"align_text"}},option:{rename_tag:"span"},select:{rename_tag:"span"},i:{},track:{remove:1},wbr:{remove:1},fieldset:{rename_tag:"div"},big:{rename_tag:"span",set_class:"wysiwyg-font-size-larger"},button:{rename_tag:"span"},noscript:{remove:1},svg:{remove:1},input:{remove:1},table:{},keygen:{remove:1},h5:{add_class:{align:"align_text"}},meta:{remove:1},map:{rename_tag:"div"},isindex:{remove:1},mark:{rename_tag:"span"},caption:{add_class:{align:"align_text"}},tfoot:{add_class:{align:"align_text"}},base:{remove:1},video:{remove:1},strong:{},canvas:{remove:1},output:{rename_tag:"span"},marquee:{rename_tag:"span"},b:{},q:{check_attributes:{cite:"url"}},applet:{remove:1},span:{},rp:{rename_tag:"span"},spacer:{remove:1},source:{remove:1},aside:{rename_tag:"div"},frame:{remove:1},section:{rename_tag:"div"},body:{rename_tag:"div"},ol:{},nobr:{rename_tag:"span"},html:{rename_tag:"div"},summary:{rename_tag:"span"},"var":{rename_tag:"span"},del:{remove:1},blockquote:{check_attributes:{cite:"url"}},style:{remove:1},device:{remove:1},meter:{rename_tag:"span"},h3:{add_class:{align:"align_text"}},textarea:{rename_tag:"span"},embed:{remove:1},hgroup:{rename_tag:"div"},font:{rename_tag:"span",add_class:{size:"size_font"}},tt:{rename_tag:"span"},noembed:{remove:1},thead:{add_class:{align:"align_text"}},blink:{rename_tag:"span"},plaintext:{rename_tag:"span"},xml:{remove:1},h6:{add_class:{align:"align_text"}},param:{remove:1},th:{check_attributes:{rowspan:"numbers",colspan:"numbers"},add_class:{align:"align_text"}},legend:{rename_tag:"span"},hr:{},label:{rename_tag:"span"},dl:{rename_tag:"div"},kbd:{rename_tag:"span"},listing:{rename_tag:"div"},dt:{rename_tag:"span"},nextid:{remove:1},pre:{},center:{rename_tag:"div",set_class:"wysiwyg-text-align-center"},audio:{remove:1},datalist:{rename_tag:"span"},samp:{rename_tag:"span"},col:{remove:1},article:{rename_tag:"div"},cite:{},link:{remove:1},script:{remove:1},bdo:{rename_tag:"span"},menu:{rename_tag:"ul"},colgroup:{remove:1},ruby:{rename_tag:"span"},h2:{add_class:{align:"align_text"}},ins:{rename_tag:"span"},p:{add_class:{align:"align_text"}},sub:{rename_tag:"span"},comment:{remove:1},frameset:{remove:1},optgroup:{rename_tag:"span"},header:{rename_tag:"div"}}}}),define("admin/modules/wysiwyg/Wysiwyg",["rosy/base/DOMClass","$","wysihtml5","./commands/commands","./WysiwygRules"],function(e,t,n,r,i){var s=0;return e.extend({dom:null,toolbar:null,textarea:null,count:0,init:function(e){this.dom=e,this.toolbar=this.dom.find(".wysiwyg-toolbar"),this.textarea=this.dom.find(".wysiwyg-textarea"),this._initWysihtml5()},_initWysihtml5:function(){var e="wysihtml5-"+ ++s,t=e+"-textarea",r=e+"-toolbar",o;this.toolbar.attr("id",r),this.textarea.attr("id",t),o=new n.Editor(t,{parserRules:i,style:!1,toolbar:r,stylesheets:"/static/css/wysiwyg.css"})}})}),define("admin/modules/OnExit",["require","exports","module","rosy/base/DOMClass","$"],function(e,t,n){var r=e("rosy/base/DOMClass"),i=e("$"),s;return s=r.extend({_isSubmitting:!1,forms:{},init:function(e){},cacheValues:function(){i("form").each(this.proxy(function(e,t){t=i(t);var n=t.data("form-id"),r={};if(!n)return;t.find("[name]").each(function(e,t){t=i(t),r[t.attr("name")]=t.val()}),this.forms[n]=r}))},isDirty:function(){var e=!1;return i("form").each(this.proxy(function(t,n){n=i(n);var r=n.data("form-id"),s=this.forms[r],o;if(!r)return;n.find("[name]").each(function(t,n){n=i(n),o=s[n.attr("name")],o!==undefined&&o!==n.val()&&(e=!0)})})),e},onSubmit:function(e){this._isSubmitting=!0},onUnload:function(e){if(!this._isSubmitting&&this.isDirty())return e&&(e.returnValue="You have unsaved changes"),"You have unsaved changes"}}),new s}),define("admin/modules/Widgets",["require","exports","module","rosy/base/DOMClass","$","$plugin!select2","$plugin!pickadate","./AssetSelect","./ApiSelect","./Formset","./Tabs","./InsertVideo","./InsertImage","./wysiwyg/Wysiwyg","./WidgetEvents","./WindowPopup","./OnExit"],function(e,t,n){var r=e("rosy/base/DOMClass"),i=e("$"),s=e("$plugin!select2"),o=e("$plugin!pickadate"),u=e("./AssetSelect"),a=e("./ApiSelect"),f=e("./Formset"),l=e("./Tabs"),c=e("./InsertVideo"),h=e("./InsertImage"),p=e("./wysiwyg/Wysiwyg"),d=e("./WidgetEvents"),v=e("./WindowPopup"),m=e("./OnExit");return r.extend({init:function(e){this.subscribe(d.RENDER,this._render)},_render:function(e){var t=i(e.data.dom);this._renderSelect(t),this._renderAssetSelect(t),this._renderFormset(t),this._renderApiSelect(t),this._renderDatePicker(t),this._renderWysiwig(t),this._renderTabs(t),this._renderInsertVideo(t),this._renderInsertImage(t),this._handlePopup(t)},_renderWysiwig:function(e){e.find(".widget-wysiwyg").each(function(e,t){var n=new p(i(t))})},_renderDatePicker:function(e){e.find("[data-date-format]").each(function(e,t){t=i(t),t.attr("placeholder",t.data("date-format").toUpperCase()),Modernizr.inputtypes.date||t.pickadate({format:"yyyy-mm-dd",format_submit:!1,month_prev:"w",month_next:"e"})})},_renderSelect:function(e){e.find("select").select2({minimumResultsForSearch:20}),e.find(".widget-tags").select2({tags:[],tokenSeparators:[","]})},_renderAssetSelect:function(e){e.find(".widget-asset").each(function(e,t){var n=new u(i(t))})},_renderFormset:function(e){e.find(".widget-formset").each(function(e,t){var n=new f(i(t))})},_renderApiSelect:function(e){e.find(".api-select").each(function(e,t){var n=new a(i(t))})},_handlePopup:function(e){if(!window.opener)return;e.find(".close-popup").click(function(e,t){window.close()}),e.find(".widget-popup-data").each(function(e,t){v.respond(i(t).data())})},_renderTabs:function(e){e.find(".widget-tabs").each(function(e,t){var n=new l(i(t))})},_renderInsertVideo:function(e){e.find(".widget-insert-video").each(function(e,t){var n=new c({$dom:i(t)})})},_renderInsertImage:function(e){e.find(".widget-insert-image").each(function(e,t){var n=new h({$dom:i(t)})})}})}),define("admin/views/Admin",["./Page","$","$plugin!select2","../modules/Widgets","../modules/WidgetEvents"],function(e,t,n,r,i){return e.extend({widgets:null,init:function(){this.sup(),this.tableDnD(),this.widgets=new r,this.publish(i.RENDER,{dom:document}),this.transitionIn()},tableDnD:function(){t("table").each(function(){var e=t(this).find("tr[draggable]").parents("tbody");e.sortable({stop:function(e,n){var r=t(n.item.context.offsetParent).find(":text");for(var i=0;i<r.length;i++)r[i].value=i+1}})})},update:function(){},transitionIn:function(){this.sup()},transitionOut:function(){this.sup()},destroy:function(){this.sup()}})}),define("admin/Site",["rosy/base/Class","$plugin!ui","./views/Admin"],function(e,t,n){var r=e.extend({initialized:!1,page:null,initialize:function(){this.initialized||(this.initialized=!0,this.page=new n)}});return new r}),require.config({paths:{$:"//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min",CFInstall:"//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min",ChromeFrame:"rosy/modules/google-chrome-frame/ChromeFrame",Cookies:"libs/cookies",Handlebars:"libs/handlebars",async:"libs/plugins/amd/async",gmaps:"libs/gmaps",wysihtml5:"libs/wysihtml5",zynga:"libs/zynga",templates:"../../templates",json:"libs/json3",$plugin:"libs/plugins/amd/jquery-plugin",jsonFile:"libs/plugins/amd/jsonFile",text:"libs/plugins/amd/text",rosy:"../../js/rosy"},waitSeconds:15,shim:{$:{exports:"jQuery"},"zynga/Scroller":{exports:"Scroller",deps:["zynga/Animate"]},wysihtml5:{exports:"wysihtml5"},CFInstall:{exports:"CFInstall"},Handlebars:{exports:"Handlebars"}}});